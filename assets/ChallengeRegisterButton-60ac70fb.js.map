{"version":3,"file":"ChallengeRegisterButton-60ac70fb.js","sources":["../../src/components/ChallengeRegisterButton/ChallengeRegisterButton.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport ExitToAppIcon from '@mui/icons-material/ExitToApp'\nimport { Box } from '@mui/system'\nimport SpinnerButton from '../widgets/SpinnerButton'\nimport { useSynapseContext } from '../../utils'\nimport {\n  useGetCurrentUserProfile,\n  useGetEntityChallenge,\n  useGetUserSubmissionTeamsInfinite,\n} from '../../synapse-queries'\nimport { Challenge, PaginatedIds } from '@sage-bionetworks/synapse-types'\nimport { useGetIsUserMemberOfTeam } from '../../synapse-queries/team/useTeamMembers'\nimport { SynapseClientError } from '../../utils/SynapseClientError'\n\nexport interface ChallengeRegisterButtonProps {\n  projectId: string\n  onChallengeError?: (error: SynapseClientError) => void\n  onJoinClick?: () => void\n  onLeaveClick?: () => void\n}\n\nconst EMPTY_ID = ''\n\nconst ChallengeRegisterButton = ({\n  projectId,\n  onChallengeError,\n  onJoinClick,\n  onLeaveClick,\n}: ChallengeRegisterButtonProps) => {\n  const { accessToken } = useSynapseContext()\n  const [challenge, setChallenge] = useState<Challenge>()\n  const { data: userProfile } = useGetCurrentUserProfile()\n  const [isRegistered, setIsRegistered] = useState<boolean>(false)\n  const [hasSubmissionTeam, setHasSubmissionTeam] = useState<boolean>(false)\n  const [loading, setLoading] = useState<boolean>(true)\n  const [requestError, setRequestError] = useState<SynapseClientError>()\n\n  useEffect(() => {\n    if (requestError && onChallengeError) onChallengeError(requestError)\n  }, [requestError, onChallengeError])\n\n  useGetEntityChallenge(projectId, {\n    enabled: !!accessToken && !challenge,\n    onSettled: (data, error) => {\n      if (data) {\n        setChallenge(data)\n      }\n      if (error) {\n        setLoading(false)\n        setRequestError(error)\n      }\n    },\n  })\n\n  // Verify that user is a member of the participant team\n  useGetIsUserMemberOfTeam(\n    challenge?.participantTeamId ?? EMPTY_ID,\n    userProfile?.ownerId ?? EMPTY_ID,\n    {\n      enabled: !!challenge && !!userProfile,\n      onSettled: (data, error) => {\n        if (data === null) {\n          // User is not a member of the participant team\n          setIsRegistered(false)\n          setLoading(false)\n        }\n        if (data !== null) {\n          // User is a member of the participant team, continue\n          setIsRegistered(true)\n        }\n        if (error) {\n          // Could not determine if user is a member of the participant team\n          setLoading(false)\n          setRequestError(error)\n        }\n      },\n    },\n  )\n\n  useGetUserSubmissionTeamsInfinite(challenge?.id ?? '0', 20, {\n    enabled: !!challenge && !!accessToken,\n    onSettled: (data: PaginatedIds | undefined, error) => {\n      if (data) {\n        setHasSubmissionTeam(data.results.length > 0)\n      }\n      if (error) {\n        setRequestError(error)\n      }\n      setLoading(false)\n    },\n  })\n\n  if (loading) {\n    return <SpinnerButton showSpinner>Loading...</SpinnerButton>\n  }\n\n  return (\n    <Box>\n      {(!isRegistered || !hasSubmissionTeam) && (\n        <SpinnerButton\n          disableElevation={true}\n          variant=\"contained\"\n          onClick={() =>\n            accessToken && onJoinClick ? onJoinClick() : undefined\n          }\n          sx={{\n            color: 'white',\n            backgroundColor: '#109488',\n            fontSize: '1.12em',\n            textTransform: 'none',\n            padding: '4px 18px',\n            fontWeight: 400,\n            ':hover': { color: 'white', backgroundColor: '#109488' },\n            ':active': { color: 'white', backgroundColor: '#109488' },\n            ':visited': { color: 'white', backgroundColor: '#109488' },\n          }}\n        >\n          Register for this Challenge\n        </SpinnerButton>\n      )}\n      {isRegistered && hasSubmissionTeam && (\n        <SpinnerButton\n          disableElevation={true}\n          variant=\"outlined\"\n          endIcon={<ExitToAppIcon />}\n          onClick={() => (onLeaveClick ? onLeaveClick() : undefined)}\n          sx={{\n            borderColor: 'white',\n            color: 'white',\n            fontSize: '1.12em',\n            textTransform: 'none',\n            padding: '4px 18px',\n            fontWeight: 400,\n            ':hover': {\n              color: '#172430',\n              borderColor: '#172430',\n            },\n          }}\n        >\n          Leave Challenge\n        </SpinnerButton>\n      )}\n    </Box>\n  )\n}\n\nexport default ChallengeRegisterButton\n"],"names":["EMPTY_ID","ChallengeRegisterButton","projectId","onChallengeError","onJoinClick","onLeaveClick","accessToken","useSynapseContext","challenge","setChallenge","useState","userProfile","useGetCurrentUserProfile","isRegistered","setIsRegistered","hasSubmissionTeam","setHasSubmissionTeam","loading","setLoading","requestError","setRequestError","useEffect","useGetEntityChallenge","data","error","useGetIsUserMemberOfTeam","useGetUserSubmissionTeamsInfinite","jsx","SpinnerButton","jsxs","Box","ExitToAppIcon"],"mappings":"6fAqBA,MAAAA,EAAA,GAEAC,EAAA,CAAA,CAAiC,UAAAC,EAC/B,iBAAAC,EACA,YAAAC,EACA,aAAAC,CAEF,IAAA,CACE,KAAA,CAAA,YAAAC,GAAAC,IACA,CAAAC,EAAAC,CAAA,EAAAC,EAAA,SAAA,EACA,CAAA,KAAAC,CAAA,EAAAC,EAAA,EACA,CAAAC,EAAAC,CAAA,EAAAJ,EAAA,SAAA,EAAA,EACA,CAAAK,EAAAC,CAAA,EAAAN,EAAA,SAAA,EAAA,EACA,CAAAO,EAAAC,CAAA,EAAAR,EAAA,SAAA,EAAA,EACA,CAAAS,EAAAC,CAAA,EAAAV,EAAA,SAAA,EAyDA,OAvDAW,EAAAA,UAAA,IAAA,CACEF,GAAAhB,GAAsCA,EAAAgB,CAAA,CAA6B,EAAA,CAAAA,EAAAhB,CAAA,CAAA,EAGrEmB,EAAApB,EAAA,CAAiC,QAAA,CAAA,CAAAI,GAAA,CAAAE,EACJ,UAAA,CAAAe,EAAAC,IAAA,CAEzBD,GACEd,EAAAc,CAAA,EAEFC,IACEN,EAAA,EAAA,EACAE,EAAAI,CAAA,EACF,CACF,CAAA,EAIFC,GAAAjB,GAAA,YAAAA,EAAA,oBAAAR,GACkCW,GAAA,YAAAA,EAAA,UAAAX,EACR,CACxB,QAAA,CAAA,CAAAQ,GAAA,CAAA,CAAAG,EAC4B,UAAA,CAAAY,EAAAC,IAAA,CAExBD,IAAA,OAEET,EAAA,EAAA,EACAI,EAAA,EAAA,GAEFK,IAAA,MAEET,EAAA,EAAA,EAEFU,IAEEN,EAAA,EAAA,EACAE,EAAAI,CAAA,EACF,CACF,CACF,EAGFE,GAAAlB,GAAA,YAAAA,EAAA,KAAA,IAAA,GAAA,CAA4D,QAAA,CAAA,CAAAA,GAAA,CAAA,CAAAF,EAChC,UAAA,CAAAiB,EAAAC,IAAA,CAExBD,GACEP,EAAAO,EAAA,QAAA,OAAA,CAAA,EAEFC,GACEJ,EAAAI,CAAA,EAEFN,EAAA,EAAA,CAAgB,CAClB,CAAA,EAGFD,EACEU,EAAAC,EAAA,CAAA,YAAA,GAAA,SAAA,YAAA,CAAA,EAGFC,EAAAC,EAAA,CAAA,SAAA,EAEM,CAAAjB,GAAA,CAAAE,IAAAY,EACAC,EAAC,CAAA,iBAAA,GACmB,QAAA,YACV,QAAA,IAAAtB,GAAAF,EAAAA,EAAA,EAAA,OAEuC,GAAA,CAE3C,MAAA,QACK,gBAAA,UACU,SAAA,SACP,cAAA,OACK,QAAA,WACN,WAAA,IACG,SAAA,CAAA,MAAA,QAAA,gBAAA,SAAA,EAC2C,UAAA,CAAA,MAAA,QAAA,gBAAA,SAAA,EACC,WAAA,CAAA,MAAA,QAAA,gBAAA,SAAA,CACC,EAC3D,SAAA,6BACD,CAAA,EAEDS,GAAAE,GAAAY,EAGAC,EAAC,CAAA,iBAAA,GACmB,QAAA,WACV,QAAAD,EAAAI,EAAA,EAAA,EACgB,QAAA,IAAA1B,EAAAA,EAAA,EAAA,OACwB,GAAA,CAC5C,YAAA,QACW,MAAA,QACN,SAAA,SACG,cAAA,OACK,QAAA,WACN,WAAA,IACG,SAAA,CACF,MAAA,UACD,YAAA,SACM,CACf,EACF,SAAA,iBACD,CAAA,CAED,CAAA,CAAA,CAIR"}