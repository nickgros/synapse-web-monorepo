import{a as r,F as h,j as e}from"./jsx-runtime-095bf462.js";import{r as N}from"./index-8db94870.js";import{a_ as j,a5 as Q,ad as C,u as X,aS as Z,aO as S,ak as ee}from"./SynapseClient-c43c6534.js";import{I as q}from"./IconSvg-5a64efdf.js";import{u as te}from"./useDataAccessSubmission-7363cf70.js";import{l as ae,a as ne}from"./useAccessRequirements-97deb603.js";import"./EntityTypeUtils-9aa47355.js";import"./getEndpoint-ac94413e.js";import{T as E}from"./TextField-49546e5e.js";import{U as le,b as L}from"./UserCard-6a6e23dc.js";import{R as ie}from"./RadioGroup-bf0fed90.js";import{U as se}from"./UserSearchBoxV2-ebe169cb.js";import{F as P}from"./Form-98a3f736.js";import{T as p}from"./Typography-b4a6e0b5.js";import{S as O}from"./Stack-49641969.js";import{B as x}from"./Button-b9be626b.js";import{F as re}from"./FileUpload-759ea4fc.js";import{B as A}from"./Box-fe8ef83e.js";import{D as oe,a as de,b as ce}from"./DialogTitle-cac35fb9.js";import{I as ue}from"./IconButton-d433d837.js";import{D as F}from"./Divider-a55dd0d0.js";import{A as pe}from"./Alert-19607992.js";import{L as me}from"./Link-50e57cb4.js";function D(c){const{accessorChanges:m,onChange:a,isRenewal:f,helpText:g}=c,{data:o}=j(),y=(n,l)=>{l&&a(i=>{if(!i.map(w=>w.userId).includes(l.ownerId)){const w={userId:l.ownerId,type:C.GAIN_ACCESS};i.push(w)}return i})},u=n=>{a(l=>l.filter(i=>i.userId!==n))},d=(n,l)=>{a(i=>{const I=i.findIndex(w=>w.userId===l);return i[I].type=n,i})};return r(h,{children:[r(P.Group,{children:[e(p,{variant:"headline3",sx:{mt:4,mb:2},children:"Data Requesters"}),e(p,{variant:"body1",sx:{mb:1},className:"requester-label",children:g}),e(se,{inputId:"requesters",typeFilter:Q.USERS_ONLY,onChange:y,filterPredicate:n=>!m.map(l=>l.userId).includes(n.ownerId),value:null})]}),e(P.Group,{children:e(O,{gap:1,children:m.map((n,l)=>r("div",{className:"list-items",children:[e(le,{size:"SMALL USER CARD",ownerId:n.userId,showAccountLevelIcon:!0,disableLink:!0,showFullName:!0}),(o==null?void 0:o.ownerId)!==n.userId&&n.type===C.GAIN_ACCESS&&e(x,{"aria-label":"Remove user",variant:"text",sx:{ml:1,px:0},onClick:()=>u(n.userId),children:e(q,{icon:"clear"})}),f&&(o==null?void 0:o.ownerId)!==n.userId&&n.type!==C.GAIN_ACCESS&&e(h,{children:e(ie,{id:`accessor-renewal-${n.userId}`,value:n.type,options:[{label:"Renew",value:C.RENEW_ACCESS},{label:"Revoke",value:C.REVOKE_ACCESS}],onChange:i=>d(i,n.userId)})})]},`accessor-${l}`))})})]})}try{D.displayName="DataAccessRequestAccessorsEditor",D.__docgenInfo={description:"Component that handles adding/removing/revoking accessors for a data access request.",displayName:"DataAccessRequestAccessorsEditor",props:{accessorChanges:{defaultValue:null,description:"",name:"accessorChanges",required:!0,type:{name:"AccessorChange[]"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(updater: (prevValue: AccessorChange[]) => AccessorChange[]) => void"}},isRenewal:{defaultValue:null,description:"",name:"isRenewal",required:!0,type:{name:"boolean"}},helpText:{defaultValue:null,description:"",name:"helpText",required:!0,type:{name:"ReactNode"}}}}}catch{}function U(c){const{fileHandleAssociation:m,fileName:a,...f}=c,{accessToken:g}=X(),o=async()=>{if(!m.fileHandleId||!g)return;const y={requestedFiles:[m],includePreSignedURLs:!0,includeFileHandles:!1,includePreviewPreSignedURLs:!1};try{const d=(await Z(y,g)).requestedFiles[0].preSignedURL;d?window.open(d):console.log("Fail to get file download link")}catch(u){console.log("Fail to get file download link",u)}};return e(x,{...f,onClick:()=>{o()},children:a})}try{U.displayName="DirectDownloadButton",U.__docgenInfo={description:"",displayName:"DirectDownloadButton",props:{children:{defaultValue:null,description:"The content of the component.",name:"children",required:!1,type:{name:"ReactNode"}},classes:{defaultValue:null,description:"Override or extend the styles applied to the component.",name:"classes",required:!1,type:{name:"(Partial<ButtonClasses> & Partial<ClassNameMap<never>>)"}},tabIndex:{defaultValue:{value:"0"},description:"",name:"tabIndex",required:!1,type:{name:"number"}},color:{defaultValue:{value:"'primary'"},description:`The color of the component.
It supports both default and custom theme colors, which can be added as shown in the
[palette customization guide](https://mui.com/material-ui/customization/palette/#adding-new-colors).`,name:"color",required:!1,type:{name:"enum",value:[{value:'"info"'},{value:'"warning"'},{value:'"error"'},{value:'"inherit"'},{value:'"primary"'},{value:'"secondary"'},{value:'"success"'}]}},action:{defaultValue:null,description:"A ref for imperative actions.\nIt currently only supports `focusVisible()` action.",name:"action",required:!1,type:{name:"Ref<ButtonBaseActions>"}},centerRipple:{defaultValue:{value:"false"},description:"If `true`, the ripples are centered.\nThey won't start at the cursor interaction position.",name:"centerRipple",required:!1,type:{name:"boolean"}},disabled:{defaultValue:{value:`false
false`},description:"If `true`, the component is disabled.",name:"disabled",required:!1,type:{name:"boolean"}},disableRipple:{defaultValue:{value:"false"},description:"If `true`, the ripple effect is disabled.\n\n⚠️ Without a ripple there is no styling for :focus-visible by default. Be sure\nto highlight the element by applying separate styles with the `.Mui-focusVisible` class.",name:"disableRipple",required:!1,type:{name:"boolean"}},disableTouchRipple:{defaultValue:{value:"false"},description:"If `true`, the touch ripple effect is disabled.",name:"disableTouchRipple",required:!1,type:{name:"boolean"}},focusRipple:{defaultValue:{value:"false"},description:"If `true`, the base button will have a keyboard focus ripple.",name:"focusRipple",required:!1,type:{name:"boolean"}},focusVisibleClassName:{defaultValue:null,description:`This prop can help identify which element has keyboard focus.
The class name will be applied when the element gains the focus through keyboard interaction.
It's a polyfill for the [CSS :focus-visible selector](https://drafts.csswg.org/selectors-4/#the-focus-visible-pseudo).
The rationale for using this feature [is explained here](https://github.com/WICG/focus-visible/blob/HEAD/explainer.md).
A [polyfill can be used](https://github.com/WICG/focus-visible) to apply a \`focus-visible\` class to other components
if needed.`,name:"focusVisibleClassName",required:!1,type:{name:"string"}},LinkComponent:{defaultValue:{value:"'a'"},description:"The component used to render a link when the `href` prop is provided.",name:"LinkComponent",required:!1,type:{name:"ElementType<any>"}},onFocusVisible:{defaultValue:null,description:"Callback fired when the component is focused with a keyboard.\nWe trigger a `onFocus` callback too.",name:"onFocusVisible",required:!1,type:{name:"FocusEventHandler<any>"}},sx:{defaultValue:null,description:"The system prop that allows defining system overrides as well as additional CSS styles.",name:"sx",required:!1,type:{name:"SxProps<Theme>"}},TouchRippleProps:{defaultValue:null,description:"Props applied to the `TouchRipple` element.",name:"TouchRippleProps",required:!1,type:{name:"Partial<TouchRippleProps>"}},touchRippleRef:{defaultValue:null,description:"A ref that points to the `TouchRipple` element.",name:"touchRippleRef",required:!1,type:{name:"Ref<TouchRippleActions>"}},disableElevation:{defaultValue:{value:"false"},description:"If `true`, no elevation is used.",name:"disableElevation",required:!1,type:{name:"boolean"}},disableFocusRipple:{defaultValue:{value:"false"},description:"If `true`, the  keyboard focus ripple is disabled.",name:"disableFocusRipple",required:!1,type:{name:"boolean"}},endIcon:{defaultValue:null,description:"Element placed after the children.",name:"endIcon",required:!1,type:{name:"ReactNode"}},fullWidth:{defaultValue:{value:"false"},description:"If `true`, the button will take up the full width of its container.",name:"fullWidth",required:!1,type:{name:"boolean"}},href:{defaultValue:null,description:"The URL to link to when the button is clicked.\nIf defined, an `a` element will be used as the root node.",name:"href",required:!1,type:{name:"string"}},size:{defaultValue:{value:"'medium'"},description:"The size of the component.\n`small` is equivalent to the dense button styling.",name:"size",required:!1,type:{name:"enum",value:[{value:'"small"'},{value:'"medium"'},{value:'"large"'}]}},startIcon:{defaultValue:null,description:"Element placed before the children.",name:"startIcon",required:!1,type:{name:"ReactNode"}},variant:{defaultValue:{value:"'text'"},description:"The variant to use.",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"outlined"'},{value:'"contained"'}]}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLButtonElement | null) => void) | RefObject<HTMLButtonElement> | null"}},fileHandleAssociation:{defaultValue:null,description:"",name:"fileHandleAssociation",required:!0,type:{name:"FileHandleAssociation"}},fileName:{defaultValue:null,description:"",name:"fileName",required:!0,type:{name:"string | undefined"}}}}}catch{}function R(c){const{fileHandleAssociations:m=[],uploadCallback:a,id:f,documentName:g,isMultiFileUpload:o=!1,onClearAttachment:y}=c,{data:u}=L({includeFileHandles:!0,includePreSignedURLs:!1,includePreviewPreSignedURLs:!1,requestedFiles:m},{enabled:m.length>0});return r(A,{id:f,display:"flex",flexDirection:o?"column":"row",alignItems:o?"flex-start":"center",justifyContent:"flex-start",gap:2,sx:{my:2},children:[e(re,{id:`${f}-upload`,uploadCallback:a,label:`Upload ${g}`,buttonProps:{variant:"outlined",endIcon:e(q,{icon:"upload",wrap:!1})}}),m.map((d,n)=>{var i;const l=(i=u==null?void 0:u.requestedFiles.find(I=>I.fileHandleId===d.fileHandleId))==null?void 0:i.fileHandle;return r(A,{children:[e(U,{id:`${f}-download-${n}`,variant:"text",endIcon:e(q,{icon:"download",wrap:!1}),color:"primary",fileHandleAssociation:d,fileName:l==null?void 0:l.fileName,sx:{textTransform:"none"}},n),y&&e(x,{className:"clear-x",variant:"text",onClick:()=>y(d.fileHandleId),children:e(q,{icon:"clear"})})]},d.fileHandleId)})]})}try{R.displayName="UploadDocumentField",R.__docgenInfo={description:"",displayName:"UploadDocumentField",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},documentName:{defaultValue:null,description:"",name:"documentName",required:!0,type:{name:"string"}},uploadCallback:{defaultValue:null,description:"",name:"uploadCallback",required:!0,type:{name:"(data: UploadCallbackResp) => void"}},fileHandleAssociations:{defaultValue:null,description:"",name:"fileHandleAssociations",required:!1,type:{name:"FileHandleAssociation[]"}},isMultiFileUpload:{defaultValue:null,description:"",name:"isMultiFileUpload",required:!1,type:{name:"boolean"}},onClearAttachment:{defaultValue:null,description:"",name:"onClearAttachment",required:!1,type:{name:"((fileHandleId: string) => void)"}}}}}catch{}function V(c){var u,d;const{title:m,description:a,fileHandleAssociation:f,downloadButtonText:g}=c,{data:o}=L({requestedFiles:[f],includeFileHandles:!0,includePreSignedURLs:!1,includePreviewPreSignedURLs:!1},{enabled:!!f}),y=(d=(u=o==null?void 0:o.requestedFiles[0])==null?void 0:u.fileHandle)==null?void 0:d.fileName;return r(h,{children:[e(p,{variant:"headline3",sx:{mt:4,mb:2},children:m}),e(p,{variant:"body1",sx:{my:2},children:a}),e(p,{variant:"body1",children:"Download this file:"}),e(p,{variant:"smallText1",sx:{my:.5},children:e("strong",{children:y})}),r(A,{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:2,sx:{backgroundColor:"tertiary.100",p:2.5,my:2},children:[e(U,{variant:"outlined",fileHandleAssociation:f,fileName:g,endIcon:e(q,{icon:"download",wrap:!1}),sx:{whiteSpace:"nowrap",flexShrink:0}}),r(p,{variant:"body1",children:["You must fill out and upload this exact version of the template."," ",e("strong",{children:"No other versions will be accepted."})]})]})]})}try{V.displayName="DocumentTemplate",V.__docgenInfo={description:"",displayName:"DocumentTemplate",props:{title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"ReactNode"}},description:{defaultValue:null,description:"",name:"description",required:!0,type:{name:"ReactNode"}},fileHandleAssociation:{defaultValue:null,description:"",name:"fileHandleAssociation",required:!0,type:{name:"FileHandleAssociation"}},downloadButtonText:{defaultValue:null,description:"",name:"downloadButtonText",required:!0,type:{name:"string"}}}}}catch{}function B(c){const{onSubmissionCreated:m,managedACTAccessRequirement:a,entityId:f,researchProjectId:g,onCancel:o}=c,{data:y}=j(),[u,d]=N.useState(),[n,l]=N.useState();ae(String(a.id),{enabled:!!y,staleTime:1/0,select:t=>{const s=t.concreteType==="org.sagebionetworks.repo.model.dataaccess.Renewal",v={userId:y.ownerId,type:s?C.RENEW_ACCESS:C.GAIN_ACCESS};t.accessorChanges?t.accessorChanges=[v,...t.accessorChanges]:t.accessorChanges=[v];const b=new Set;return t.accessorChanges=t.accessorChanges.filter(k=>b.has(k.userId)?!1:b.add(k.userId)),t.researchProjectId=g,t},onSuccess:t=>{d(void 0),l(t)},onError:t=>{d({key:"error",message:t.reason})}});const i=(n==null?void 0:n.concreteType)==="org.sagebionetworks.repo.model.dataaccess.Renewal";function I(t){console.log("RequestDataAccessStep2: Error updating form",t),d({key:"error",message:H(t.reason)})}const{mutate:w}=te({onSuccess:()=>{m()},onError:I}),{mutateAsync:G}=ne({onError:I});async function M(){if(n){const t=await G(n);w({request:{requestId:t.id,requestEtag:t.etag,subjectId:f,subjectType:ee.ENTITY},accessRequirementId:String(a.id)})}}const H=(t="")=>r(h,{children:[e("strong",{children:"Sorry, there is an error in submitting your request."}),e("br",{}),t]}),W=t=>{l(s=>({...s,accessorChanges:[...t(s.accessorChanges||[])]}))},z=t=>{l(s=>{var v;return s&&{...s,attachments:(v=s.attachments)==null?void 0:v.filter(b=>b!==t)}})},T=(t,s)=>{if(t.resp&&t.success){const v=t.resp;l(s==="attachments"?b=>({...b,attachments:[...b.attachments||[],v.fileHandleId]}):b=>({...b,[s]:v.fileHandleId}))}else!t.success&&t.error&&(console.log("RequestDataAccessStep2: Error uploading the file",t.error),d({key:"error",message:H(t.error.reason)}))},_=(t,s)=>{const v=t.target.value;l(b=>({...b,[s]:v}))},Y=()=>{let t="",s="";return a.isCertifiedUserRequired&&a.isValidatedProfileRequired?(t="https://help.synapse.org/docs/User-Types.2007072795.html",s="All data requesters must be certified users and have a validated user profile."):a.isCertifiedUserRequired?(t="https://help.synapse.org/docs/User-Types.2007072795.html#UserAccountTiers-CertifiedUsers",s="All data requesters must be a certified user."):a.isValidatedProfileRequired&&(t="https://help.synapse.org/docs/User-Types.2007072795.html#UserAccountTiers-ValidatedUsers",s="All data requesters must have a validated user profile."),t&&s?r(h,{children:[a.isDUCRequired?r(h,{children:["This list should match those listed on your DUC.",e("br",{})]}):"",s," ",e(me,{href:t,target:"_blank",rel:"noreferrer",children:"Learn more"})]}):e(h,{})},$=n!=null&&n.ducFileHandleId?[{fileHandleId:n==null?void 0:n.ducFileHandleId,associateObjectType:S.AccessRequirementAttachment,associateObjectId:String(a.id)}]:[],K=n!=null&&n.irbFileHandleId?[{fileHandleId:n.irbFileHandleId,associateObjectType:S.AccessRequirementAttachment,associateObjectId:String(a.id)}]:[],J=((n==null?void 0:n.attachments)||[]).map(t=>({fileHandleId:t,associateObjectType:S.AccessRequirementAttachment,associateObjectId:String(a.id)}))??[];return r(h,{children:[e(oe,{children:r(O,{direction:"row",alignItems:"center",gap:"5px",children:["Request Access",e(A,{sx:{flexGrow:1}}),e(ue,{onClick:c.onHide,children:e(q,{icon:"close",wrap:!1,sx:{color:"grey.700"}})})]})}),e(de,{children:r(A,{component:"form",sx:{minHeight:"475px"},onSubmit:t=>t.preventDefault(),children:[e(p,{variant:"body1",sx:{mb:2},children:"Please provide the information below to submit the request for access."}),n&&e(D,{accessorChanges:n.accessorChanges||[],onChange:W,isRenewal:i,helpText:e(Y,{})}),((a==null?void 0:a.isDUCRequired)||(a==null?void 0:a.isIRBApprovalRequired)||(a==null?void 0:a.areOtherAttachmentsRequired)||i)&&e(F,{sx:{my:4}}),(a==null?void 0:a.isDUCRequired)&&r(h,{children:[(a==null?void 0:a.ducTemplateFileHandleId)&&e(V,{title:"Download DUC Template",description:"As a first step, you will need to download the most current version of the Data Use Certificate.",fileHandleAssociation:{fileHandleId:a.ducTemplateFileHandleId,associateObjectType:S.AccessRequirementAttachment,associateObjectId:String(a.id)},downloadButtonText:"Download DUC Template"}),e(p,{variant:"headline3",sx:{mt:4,mb:2},children:"Fill out and upload a Data Use Certificate"}),e(p,{variant:"body1",sx:{my:2},children:"You must download and fill out a Data Use Certificate (DUC). Be sure to upload the completed DUC below once you've completed it."}),r(p,{variant:"body1",component:"ol",children:[e("li",{children:"Download the DUC template file."}),e("li",{children:"Fill out the DUC template, following the instructions in the file."}),e("li",{children:"Upload the completed certificate using the button below:"})]}),e(R,{id:"duc",uploadCallback:t=>T(t,"ducFileHandleId"),documentName:"Data Use Certificate",fileHandleAssociations:$}),((a==null?void 0:a.isIRBApprovalRequired)||(a==null?void 0:a.areOtherAttachmentsRequired)||i)&&e(F,{sx:{my:4}})]}),(a==null?void 0:a.isIRBApprovalRequired)&&r(h,{children:[e(p,{variant:"headline3",sx:{my:2},children:"IRB Approval"}),e(p,{variant:"body1",sx:{my:2},children:"Upload a signed IRB letter on institutional letterhead. The letter must include the names of all the datasets requested, as well as the names of the data requesters above. Use the button below to upload the document."}),e(R,{id:"irb",documentName:"IRB Approval Letter",uploadCallback:t=>T(t,"irbFileHandleId"),fileHandleAssociations:K}),((a==null?void 0:a.areOtherAttachmentsRequired)||i)&&e(F,{sx:{my:4}})]}),(a==null?void 0:a.areOtherAttachmentsRequired)&&r(h,{children:[e(p,{variant:"headline3",sx:{my:2},children:"Upload other required documents"}),e(p,{variant:"body1",sx:{my:2},children:"You must upload other required documents. Please review the instructions to gain data access to determine which documents must also be uploaded."}),e(R,{id:"file-attachment",documentName:"Attachment",uploadCallback:t=>T(t,"attachments"),isMultiFileUpload:!0,fileHandleAssociations:J,onClearAttachment:z}),i&&e(F,{sx:{my:4}})]}),i&&r(h,{children:[e(E,{id:"publications",label:"Publication(s)",multiline:!0,rows:3,value:n==null?void 0:n.publication,onChange:t=>_(t,"publication")}),e(E,{id:"summaryOfUse",label:"Summary of use",value:n==null?void 0:n.summaryOfUse,multiline:!0,rows:3,onChange:t=>_(t,"summaryOfUse")})]}),u&&e(pe,{severity:u.key,children:u.message})]})}),e(ce,{children:r(h,{children:[e(x,{variant:"outlined",onClick:()=>{n&&o(n)},children:"Cancel"}),e(x,{variant:"contained",onClick:()=>{M()},children:"Submit"})]})})]})}try{B.displayName="DataAccessRequestAccessorsFilesForm",B.__docgenInfo={description:`Step 2 of the Data Access Request/Renewal flow prompts the user to
- Manage the list of accessors, i.e. Synapse users who will gain, renew, or lose access
- Download and upload documents required by the Access Requirement
- If a renewal, provide publications and a summary of use statement.

The component expects a researchProjectId, which should reference complete researchProject created in Step 1.
The user may click a "Submit" button, which will save the request and issue a data access submission that references
the requestId created/updated in this component.`,displayName:"DataAccessRequestAccessorsFilesForm",props:{entityId:{defaultValue:null,description:"The ID of the entity of interest. This corresponds to the subjectId of the {@link CreateSubmissionRequest }",name:"entityId",required:!0,type:{name:"string"}},managedACTAccessRequirement:{defaultValue:null,description:"",name:"managedACTAccessRequirement",required:!0,type:{name:"ManagedACTAccessRequirement"}},onSubmissionCreated:{defaultValue:null,description:"",name:"onSubmissionCreated",required:!0,type:{name:"() => void"}},researchProjectId:{defaultValue:null,description:"",name:"researchProjectId",required:!0,type:{name:"string"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},onCancel:{defaultValue:null,description:"",name:"onCancel",required:!0,type:{name:"(modifiedDataAccessRequest: Request | Renewal) => void"}}}}}catch{}export{B as D};
//# sourceMappingURL=DataAccessRequestAccessorsFilesForm-4be57a8a.js.map
