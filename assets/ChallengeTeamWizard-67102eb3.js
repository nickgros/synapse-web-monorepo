import{a as _,j as e,F as v}from"./jsx-runtime-9dc53467.js";import{r as n}from"./index-76fb7be0.js";import{S as pe}from"./StepperDialog-39c072d8.js";import{C as fe}from"./CreateChallengeTeam-71f1993a.js";import{f as he}from"./DateFormatter-4ac10a57.js";import{d as ge}from"./dayjs.min-f79c4412.js";import{a as Te}from"./RadioGroup-bfe7e0a4.js";import{d as Ee}from"./Search-b46373ca.js";import{B as $}from"./Box-551bafc7.js";import{b as Ce}from"./InputLabel-fd013c0b.js";import"./OrientationBanner-a1ca5cdb.js";import{g as Se,B as _e}from"./getEndpoint-ac94413e.js";import{h as B,m as z,n as X,l as ye,y as be,by as Me,bz as Re}from"./ApplicationSessionManager-9bd355c2.js";import{L as Ie}from"./react-router-dom-9f08d849.js";import{B as C}from"./Box-8faf86fd.js";import{D as Ne}from"./DataGrid-2e5ee55e.js";import{d as xe}from"./AddCircleTwoTone-b7ecfece.js";import{c as ve}from"./Stack-4eda368b.js";import{T as L}from"./Typography-1d068b0b.js";import{B as Le}from"./Button-33299b2c.js";import{a as Z}from"./useTeam-cd9bd7b4.js";import{S as ee}from"./LoadingScreen-21cf5616.js";import{M as ae}from"./Alert-c3fe2b05.js";import{M as Ae}from"./TextField-259737a9.js";import{A as Oe}from"./SynapseConstants-eb00dc31.js";import{u as qe}from"./useGetEntityChallenge-08d71bc8.js";import{u as we}from"./useGetUserTeams-9accdd19.js";import{b as Ue}from"./useTeamMembers-f704f6dc.js";const Fe=ve(),Ge=Fe;function Je(a,i){const{accessToken:l,keyFactory:r}=B();return z({...i,queryKey:r.getTeamListQueryKey(a.sort().join()),queryFn:()=>X.getTeamList(a,l)})}function ke(a,i){const{accessToken:l,keyFactory:r}=B();return z({...i,queryKey:r.getChallengeTeamListQueryKey(a),queryFn:()=>X.getAllChallengeTeams(l,a)})}function k(a){const{value:i,rowCount:l,onChange:r}=a,m=l>5?"calc(100% - 8px)":"100%";return _($,{sx:{p:"4px 4px",display:"flex",flexGrow:1,width:m,border:"1px solid #F2F2F2","& .Mui-focused":{border:"none",boxShadow:"none"}},children:[e($,{sx:{margin:"0px 0 -4px 8px"},"aria-label":"search",children:e(Ee,{sx:{color:"#878E95"}})}),e(Ce,{value:i,onChange:r,sx:{"& .MuiInputBase-input":{p:"1px 8px"},ml:1,flex:1,backgroundColor:"white"},placeholder:"Search all teams",inputProps:{"aria-label":"search all teams"}})]})}try{k.displayName="ChallengeTeamSearch",k.__docgenInfo={description:"",displayName:"ChallengeTeamSearch",props:{rowCount:{defaultValue:null,description:"",name:"rowCount",required:!0,type:{name:"number"}},value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(event: ChangeEvent<HTMLInputElement>) => void"}}}}}catch{}const Ve=a=>({id:a.id,name:a.name,created:he(ge(a.createdOn),"MM/DD/YY"),description:a.description});function V(a){const{challengeId:i,onSelectTeam:l,selectedTeamId:r}=a,{data:m,isLoading:y}=ke(i),[T,d]=n.useState(""),c=(m==null?void 0:m.map(s=>s.teamId))??[],{data:p,isLoading:u}=Je(c,{enabled:!!c.length}),o=n.useMemo(()=>{const s=T.toLowerCase(),M=(p==null?void 0:p.list.filter(E=>E.canPublicJoin||E.canRequestMembership!==!1))??[];let S=M;return s.length&&(S=M.filter(E=>{var I;return E.name.toLowerCase().includes(s)||((I=E.description)==null?void 0:I.toLowerCase().includes(s))})),S.map(E=>Ve(E))},[T,p==null?void 0:p.list]),b=y||u,A=n.useMemo(()=>[{field:"radiobutton",headerName:"",width:25,sortable:!1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:({row:s})=>e(Te,{value:s.id,checked:String(s.id)===r,onChange:M=>{l(M)},label:""})},{field:"name",headerName:"Team Name",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:({row:s})=>e(Ie,{to:{pathname:`${Se(_e.PORTAL_ENDPOINT)}/#!Team:${s.id}`},target:"_blank",children:s.name})},{field:"created",headerName:"Created On",width:100,filterable:!1,hideable:!1,disableColumnMenu:!0},{field:"description",headerName:"Description",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0}],[l,r]);return _(C,{sx:{height:220},children:[!b&&e(k,{value:T,onChange:s=>d(s.target.value),rowCount:o.length}),e(Ne,{loading:b,rows:o,columns:A,rowCount:5,hideFooter:!0,density:"compact",sx:{border:"none",height:"100%","& .MuiDataGrid-columnHeader":{backgroundColor:"#F1F3F5"},"& .Mui-odd":{backgroundColor:"#FBFBFC"},".MuiDataGrid-columnHeaderTitleContainer":{justifyContent:"space-between"},".radio":{display:"flex",alignItems:"center",height:"100%"}},getRowClassName:s=>s.indexRelativeToCurrentPage%2===0?"Mui-even":"Mui-odd"})]})}try{V.displayName="ChallengeTeamTable",V.__docgenInfo={description:"",displayName:"ChallengeTeamTable",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},selectedTeamId:{defaultValue:null,description:"",name:"selectedTeamId",required:!1,type:{name:"string"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(teamId?: string | undefined) => void"}}}}}catch{}const He='To participate in a challenge, you need to create a new Team or join an existing one.   By default, the participant who creates a team is the "Team Captain" and has the ability to invite and remove members.   All team members will need a Synapse account so that they can login and accept the team invitation.',H=({challengeId:a,onCreateTeam:i,selectedTeamId:l,onSelectTeam:r})=>_(Ge,{spacing:2,children:[e(L,{variant:"body1",sx:{lineHeight:"20px"},children:He}),e(C,{sx:{height:270},children:e(V,{challengeId:a,selectedTeamId:l,onSelectTeam:r})}),e(C,{children:e(Le,{color:"primary",variant:"contained",onClick:i,startIcon:e(xe,{}),children:"Create New Team"})})]});try{H.displayName="SelectChallengeTeam",H.__docgenInfo={description:"",displayName:"SelectChallengeTeam",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},onCreateTeam:{defaultValue:null,description:"",name:"onCreateTeam",required:!0,type:{name:"() => void"}},selectedTeamId:{defaultValue:null,description:"",name:"selectedTeamId",required:!1,type:{name:"string"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(teamId?: string | undefined) => void"}}}}}catch{}const Q=({createdNewTeam:a,teamId:i})=>{const{data:l,status:r,error:m}=Z(i,{enabled:!!i});return i?r==="pending"?e(C,{display:"flex",flexDirection:"column",gap:1,children:e(ee,{})}):r==="error"?e(ae,{severity:"error",children:m.message}):_(v,{children:[_(L,{variant:"body1",sx:{lineHeight:"20px"},children:["You have successfully ",a?"created":"joined"," team"," ",e("b",{children:l.name})," and have been added to this challenge."]}),a&&e(C,{children:"Invited team members will be automatically registered for the challenge as soon as they accept the team member invitation."})]}):null};try{Q.displayName="RegistrationSuccessful",Q.__docgenInfo={description:"",displayName:"RegistrationSuccessful",props:{createdNewTeam:{defaultValue:null,description:"",name:"createdNewTeam",required:!0,type:{name:"boolean"}},teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string | undefined"}}}}}catch{}const Y=({teamId:a,joinMessageChange:i})=>{const[l,r]=n.useState(""),{data:m,status:y,error:T}=Z(a,{enabled:!!a});if(!a)return null;const d=c=>{const p=c.target.value;r(p),i(p)};return y==="pending"?e(C,{display:"flex",flexDirection:"column",gap:1,children:e(ee,{})}):y==="error"?e(ae,{severity:"error",children:T.message}):_(v,{children:[_(L,{variant:"body1",sx:{lineHeight:"20px"},children:["The following message will be sent to the Team Manager(s) of the"," ",e("strong",{children:m.name})," team."]}),e(C,{children:e("strong",{children:"Your Message to Team Managers(s)"})}),e(C,{children:e(Ae,{id:"membershipRequestMessage",value:l,fullWidth:!0,multiline:!0,rows:4,autoFocus:!0,onChange:d})})]})};try{Y.displayName="JoinRequestForm",Y.__docgenInfo={description:"",displayName:"JoinRequestForm",props:{teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string | undefined"}},joinMessageChange:{defaultValue:null,description:"",name:"joinMessageChange",required:!0,type:{name:"(msg: string) => void"}}}}}catch{}const R={SELECT_YOUR_CHALLENGE_TEAM:{id:"SELECT_YOUR_CHALLENGE_TEAM",title:"Select Your Challenge Team",nextStep:"JOIN_REQUEST_FORM",nextEnabled:!1},JOIN_REQUEST_FORM:{id:"JOIN_REQUEST_FORM",title:"Request Team Membership",previousStep:"SELECT_YOUR_CHALLENGE_TEAM",confirmStep:"JOIN_REQUEST_SENT",confirmButtonText:"Send Request",confirmEnabled:!0},JOIN_REQUEST_SENT:{id:"JOIN_REQUEST_SENT",title:"Request Sent",confirmButtonText:"Close",confirmEnabled:!0},CREATE_NEW_TEAM:{id:"CREATE_NEW_TEAM",title:"Create Team",confirmStep:"REGISTRATION_SUCCESSFUL",confirmButtonText:"Finish Registration",confirmEnabled:!1,previousStep:"SELECT_YOUR_CHALLENGE_TEAM"},REGISTRATION_SUCCESSFUL:{id:"REGISTRATION_SUCCESSFUL",title:"Registration Successful!"}},J="",K=({projectId:a,isShowingModal:i=!1,onClose:l})=>{const{accessToken:r,keyFactory:m}=B(),[y,T]=n.useState(!0),[d,c]=n.useState(R.SELECT_YOUR_CHALLENGE_TEAM),[p,u]=n.useState(),[o,b]=n.useState(),[A,s]=n.useState(!1),[M,S]=n.useState(!1),[E,I]=n.useState(!1),te=ye(),[N,re]=n.useState({}),[ne,se]=n.useState(""),O=n.useRef(null),{data:f}=be(),{data:h}=qe(a),{data:q,error:j}=we((h==null?void 0:h.id)??J,1);n.useEffect(()=>{if(q){const t=q.results.length>0;t&&(u("Error: You are already a member of a registered submission team for this Challenge."),I(t)),T(!1)}j&&(u("Error: Could not determine if you are already registered for this Challenge."),T(!1))},[q,j]);const{data:x,error:w}=Ue(o??J,(f==null?void 0:f.ownerId)??J,{enabled:!!o&&!!f});n.useEffect(()=>{x&&re(t=>({...t,[x.teamId]:x}))},[x]),n.useEffect(()=>{w&&u(w.reason)},[w]);const D=()=>{if(o&&o in N){const{canJoin:t,membershipApprovalRequired:g,isMember:F,hasOpenInvitation:G,hasOpenRequest:me}=N[o];if(F)return{canJoin:!1,errorMessage:"You are already a member of this team."};if(me)return{canJoin:!1,errorMessage:"Your previous request to join this team is pending review."};if(G||t||g)return{canJoin:!0,needsApproval:g,errorMessage:void 0}}return{canJoin:!1}};n.useEffect(()=>{!!f&&f.ownerId===Oe.toString()&&(T(!1),u("Please login to continue."))},[r,f,a,h]),n.useEffect(()=>{if(o&&o in N&&d.id==="SELECT_YOUR_CHALLENGE_TEAM"){const{canJoin:t,errorMessage:g}=D();if(t){d.nextEnabled||c({...d,nextEnabled:!0});return}d.nextEnabled&&c({...d,nextEnabled:!1}),g&&u(g)}},[N,o,d]);const ie=t=>{u(void 0),b(t)},oe=(t=o)=>{!t||!f||!r||(S(!0),u(void 0),Me(t,f.ownerId,r).then(()=>{h&&te.invalidateQueries({queryKey:m.getSubmissionTeamsQueryKey(h==null?void 0:h.id)}),U("REGISTRATION_SUCCESSFUL")}).catch(g=>{u(`Error joining team: ${g.reason}`)}).finally(()=>{S(!1)}))},le=async()=>{f&&o&&(S(!0),c({...d,nextEnabled:!1}),u(void 0),await Re({teamId:o,userId:f.ownerId,message:ne},r).then(()=>{c(R.JOIN_REQUEST_SENT)}).catch(t=>{console.error({err:t}),u(`Error requesting membership: ${t.reason}`)}).finally(()=>{S(!1)}))},P=()=>{u(void 0),s(!1),b(void 0),c({...d,nextEnabled:!1}),l()},W={CREATE_NEW_TEAM:()=>{O.current&&O.current.submit()},JOIN_REQUEST_FORM:le,JOIN_REQUEST_SENT:()=>{P()}},de=n.useCallback(t=>{c(g=>({...g,confirmEnabled:t}))},[]),ue=()=>{switch(d.id){case"SELECT_YOUR_CHALLENGE_TEAM":return r&&h&&!E?e(H,{challengeId:h.id,onCreateTeam:()=>U("CREATE_NEW_TEAM"),selectedTeamId:o,onSelectTeam:t=>{ie(t)}}):e(v,{});case"JOIN_REQUEST_FORM":return e(Y,{teamId:o,joinMessageChange:se});case"JOIN_REQUEST_SENT":return e(L,{variant:"body1",sx:{lineHeight:"20px"},children:"Team Manager(s) have received your request. Check your Synapse email address for status of your request."});case"REGISTRATION_SUCCESSFUL":return e(Q,{createdNewTeam:A,teamId:o});case"CREATE_NEW_TEAM":return e(fe,{ref:O,challengeId:h.id,onCanSubmitChange:de,onFinished:t=>{s(!0),b(t),c(R.REGISTRATION_SUCCESSFUL)}});default:return e(v,{})}};function U(t){if(!t||!R[t])return;u(void 0);const{canJoin:g,errorMessage:F,needsApproval:G}=D();switch(t){case"SELECT_YOUR_CHALLENGE_TEAM":s(!1);break;case"JOIN_REQUEST_FORM":if(g){if(!G)return oe()}else return u(F);break}c(R[t])}const ce=W[d.id]?W[d.id]:()=>{};return e(pe,{errorMessage:p,onCancel:P,onStepChange:U,open:i,onConfirm:()=>{ce()},confirming:M,step:d,content:ue(),loading:y})};try{K.displayName="ChallengeTeamWizard",K.__docgenInfo={description:"",displayName:"ChallengeTeamWizard",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}},isShowingModal:{defaultValue:{value:"false"},description:"",name:"isShowingModal",required:!1,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}export{K as C};
