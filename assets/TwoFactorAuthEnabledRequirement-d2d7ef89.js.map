{"version":3,"file":"TwoFactorAuthEnabledRequirement-d2d7ef89.js","sources":["../../src/components/AccessRequirementList/RequirementItem/TwoFactorAuthEnabledRequirement.tsx"],"sourcesContent":["import React from 'react'\nimport { ButtonProps, Typography } from '@mui/material'\nimport {\n  BackendDestinationEnum,\n  getEndpoint,\n} from '../../../utils/functions/getEndpoint'\nimport { useSynapseContext } from '../../../utils/context/SynapseContext'\nimport { TWO_FACTOR_DOCS_LINK } from '../../Authentication/TwoFactorEnrollmentForm'\nimport { useGetTwoFactorEnrollmentStatus } from '../../../synapse-queries/auth/useTwoFactorEnrollment'\nimport RequirementItem, { RequirementItemProps } from './RequirementItem'\nimport { TwoFactorAuthStatus } from '@sage-bionetworks/synapse-types'\nimport { RequirementItemStatus } from '../AccessApprovalCheckMark'\n\nconst TWO_FACTOR_ENROLLMENT_LINK = `${getEndpoint(\n  BackendDestinationEnum.PORTAL_ENDPOINT,\n)}#!TwoFactorAuth:Enroll`\n\nfunction getState(\n  isSignedIn: boolean,\n  isLoading: boolean,\n  status?: TwoFactorAuthStatus['status'],\n): RequirementItemStatus {\n  if (!isSignedIn) {\n    return RequirementItemStatus.LOCKED\n  }\n  if (isLoading) {\n    return RequirementItemStatus.LOADING\n  }\n  return status === 'ENABLED'\n    ? RequirementItemStatus.COMPLETE\n    : RequirementItemStatus.LOCKED\n}\n\n/**\n * Displays a data access request requirement that prompts the user to enable two-factor authentication.\n */\nexport default function TwoFactorAuthEnabledRequirement() {\n  const { accessToken } = useSynapseContext()\n\n  const isSignedIn = !!accessToken\n\n  const { data: twoFactorAuthStatus, isLoading } =\n    useGetTwoFactorEnrollmentStatus({\n      enabled: isSignedIn,\n      // If required, we send the user to a new tab to complete 2FA enrollment\n      // Refetch on window focus so the enrollment state is immediately updated when they return to this tab\n      refetchOnWindowFocus: true,\n      // Refetch won't happen unless staleTime is less than the amount of time since last fetch. 5sec seems reasonable\n      staleTime: 5000,\n    })\n\n  const actions: RequirementItemProps['actions'] =\n    twoFactorAuthStatus?.status === 'DISABLED'\n      ? [\n          {\n            variant: 'outlined',\n            href: TWO_FACTOR_ENROLLMENT_LINK,\n            target: '_blank',\n            rel: 'noopener noreferrer',\n            children: 'Activate 2FA (opens a new tab)',\n          } as ButtonProps,\n          {\n            variant: 'text',\n            href: TWO_FACTOR_DOCS_LINK,\n            target: '_blank',\n            rel: 'noopener noreferrer',\n            children: '2FA Documentation',\n          } as ButtonProps,\n        ]\n      : undefined\n\n  return (\n    <RequirementItem\n      status={getState(isSignedIn, isLoading, twoFactorAuthStatus?.status)}\n      actions={actions}\n    >\n      <Typography variant={'body1'}>\n        You must have Two-factor Authentication (2FA) active on your Synapse\n        account in order to download the requested files\n      </Typography>\n    </RequirementItem>\n  )\n}\n"],"names":["TWO_FACTOR_ENROLLMENT_LINK","getEndpoint","BackendDestinationEnum","getState","isSignedIn","isLoading","status","RequirementItemStatus","TwoFactorAuthEnabledRequirement","accessToken","useSynapseContext","twoFactorAuthStatus","useGetTwoFactorEnrollmentStatus","actions","TWO_FACTOR_DOCS_LINK","jsx","RequirementItem","Typography"],"mappings":"qTAaA,MAAAA,EAAA,GAAAC,EAAsCC,EAAA,eAEtC,0BAEA,SAAAC,EAAAC,EAAAC,EAAAC,EAAA,CAKE,OAAAF,EAGAC,EACEE,EAAA,QAEFD,IAAA,UAAAC,EAAA,SAAAA,EAAA,OALEA,EAAA,MAQJ,CAKA,SAAAC,GAAA,CACE,KAAA,CAAA,YAAAC,GAAAC,IAEAN,EAAA,CAAA,CAAAK,EAEA,CAAA,KAAAE,EAAA,UAAAN,CAAA,EAAAO,EAAA,CACkC,QAAAR,EACrB,qBAAA,GAGa,UAAA,GAEX,CAAA,EAGfS,GAAAF,GAAA,YAAAA,EAAA,UAAA,WAAA,CAEM,CACE,QAAA,WACW,KAAAX,EACH,OAAA,SACE,IAAA,sBACH,SAAA,gCACK,EACZ,CACA,QAAA,OACW,KAAAc,EACH,OAAA,SACE,IAAA,sBACH,SAAA,mBACK,CACZ,EAAA,OAIR,OAAAC,EACEC,EAAC,CAAA,OAAAb,EAAAC,EAAAC,EAAAM,GAAA,YAAAA,EAAA,MAAA,EACoE,QAAAE,EACnE,SAAAE,EAAAE,EAAA,CAAA,QAAA,QAAA,SAAA,wHAAA,CAKA,CAAA,CAGN"}