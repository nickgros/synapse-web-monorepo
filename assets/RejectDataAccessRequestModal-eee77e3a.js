import{a as m,j as e,F as q}from"./jsx-runtime-9dc53467.js";import{R as _,r as C}from"./index-76fb7be0.js";import{I as L}from"./IconSvg-b2c8dc9b.js";import{G as P}from"./SynapseClient-7700f4cc.js";import{S as Q}from"./index-3a31b023.js";import"./getEndpoint-ac94413e.js";import{R as J,B as V}from"./SynapseConstants-c93e8ee4.js";import{u as X}from"./useDataAccessSubmission-b054fc1c.js";import{a as z}from"./useGetQueryResultBundle-948ec3bc.js";import{S as K}from"./immutable.es-400ccb6d.js";import{S as $}from"./LoadingScreen-ed61dd72.js";import{F as H}from"./FullWidthAlert-77167a31.js";import{d as Z}from"./ToastMessage-9aa3d9c5.js";import{M as ee}from"./Dialog-4b9f6058.js";import{D as te}from"./DialogTitle-c06d2eca.js";import{S as w}from"./Stack-eb200119.js";import{B as N}from"./Box-737945d6.js";import{I as oe}from"./IconButton-30f6f351.js";import{D as se,a as re}from"./DialogContent-c6186c64.js";import{B as T}from"./Button-a2b8b546.js";import{T as f}from"./Typography-62cfc992.js";import{F as ne}from"./InputLabel-060c2cf9.js";import{M as ae}from"./TextField-4b8d3337.js";import{C as ie}from"./_getTag-dcd38d76.js";import{F as ce,C as le}from"./FormControlLabel-825bc21f.js";const k="category",de="category email prompt",ue="rejection reason",me="email text",fe=`Thank you for submitting your data access request.
`,pe=`
If you have questions, do not respond to this email address. Instead, reply to:
act@sagebionetworks.org`;function he(l){const{category:p,rows:d,selectedRowIds:n,setSelectedRowIds:s,rejectionReasonFormTextIndex:i}=l,[c,h]=_.useState(!1);return m(q,{children:[m(f,{variant:"body1",onClick:()=>h(!c),sx:{fontWeight:700,cursor:"pointer",my:1},children:[e(L,{icon:c?"expandMore":"chevronRight",sx:{color:"grey.700"},wrap:!1}),p]}),e(ie,{in:c,children:e(w,{sx:{ml:3},children:(d??[]).map(a=>e(ce,{control:e(le,{checked:n.has(a.rowId),size:"small",onChange:u=>{u.target.checked?s(n.add(a.rowId)):s(n.remove(a.rowId))}}),label:e(f,{variant:"smallText1",children:a.values[i]})},a.rowId))})})]})}function ye(l){var E,y;const{tableQuery:p,selectedRowIds:d,setSelectedRowIds:n}=l,{data:s,isLoading:i,error:c}=p,h=(E=s==null?void 0:s.queryResult)==null?void 0:E.queryResults.headers.findIndex(r=>r.name.toLowerCase()===k),a=(y=s==null?void 0:s.queryResult)==null?void 0:y.queryResults.headers.findIndex(r=>r.name.toLowerCase()===ue),u=s&&s.queryResult&&s.queryResult.queryResults.rows.reduce((r,x)=>{const o=x.values[h];return r[o]=[...r[o]||[],x],r},{});return m(q,{children:[e(f,{variant:"headline3",gutterBottom:!0,children:"Reasons for rejecting"}),e(f,{variant:"body1",gutterBottom:!0,children:"You may wish to reject the user's data access request for a specific reason. The list below contains some common rejection reasons. You will have a chance to edit the response before submitting it, including adding any rejection reason(s) not listed here."}),i&&e(w,{sx:{my:2},children:e($,{size:30})}),c&&e(P,{error:c}),u&&e(ne,{children:Object.keys(u).map(r=>e(he,{category:r,rows:u[r],selectedRowIds:d,setSelectedRowIds:n,rejectionReasonFormTextIndex:a},r))}),e(f,{variant:"headline3",sx:{mt:1},gutterBottom:!0,children:"We’ll generate a response email message based on your selections."}),e(f,{variant:"body1",gutterBottom:!0,children:"If your reasons for rejecting are not shown here, that’s okay! You can edit the complete text of the message on the next screen before sending it."})]})}function Re(l){const{emailText:p,setEmailText:d}=l;return m(q,{children:[e(f,{variant:"headline3",gutterBottom:!0,children:"Edit the text of the rejection message"}),e(f,{variant:"body1",gutterBottom:!0,children:"This message will be sent to the data requester. You may edit it, or add custom text to the message."}),e(ae,{multiline:!0,fullWidth:!0,rows:15,value:p,onChange:n=>{d(n.target.value)}})]})}function B(l){var M,v,j;const{open:p,tableId:d=J,onClose:n,submissionId:s}=l,[i,c]=_.useState(1),[h,a]=_.useState(null),[u,E]=C.useState(""),[y,r]=C.useState(K()),x=z({entityId:d,query:{sql:`SELECT * FROM ${d}`},partMask:V,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest"}),{data:o}=x,F=(M=o==null?void 0:o.queryResult)==null?void 0:M.queryResults.headers.findIndex(t=>t.name.toLowerCase()===k),D=(v=o==null?void 0:o.queryResult)==null?void 0:v.queryResults.headers.findIndex(t=>t.name.toLowerCase()===de),O=(j=o==null?void 0:o.queryResult)==null?void 0:j.queryResults.headers.findIndex(t=>t.name.toLowerCase()===me),S=o&&o.queryResult&&y.reduce((t,R)=>{const I=o.queryResult.queryResults.rows.find(W=>W.rowId===R),g=I.values[F],Y=I.values[D],A=I.values[O];return t[g]?t[g].reasons=[...t[g].reasons,A]:t[g]={sectionText:Y,reasons:[A]},t},{}),b=S&&fe+Object.keys(S).reduce((t,R)=>{const I=S[R].sectionText;t+=`
`+I+`
`;for(const g of S[R].reasons)t+=`
* `+g+`
`;return t},"")+pe;C.useEffect(()=>{b&&E(b)},[y]);const{mutate:G}=X();function U(t){G({submissionId:s.toString(),newState:Q.REJECTED,rejectedReason:t},{onSuccess:()=>{a(null),Z("Submission rejected and message sent to requester","info"),n()},onError:R=>{a(R)}})}return m(ee,{open:p,onClose:n,maxWidth:"md",fullWidth:!0,children:[e(te,{children:m(w,{direction:"row",alignItems:"center",gap:"5px",children:["Reject Request?",e(N,{sx:{flexGrow:1}}),e(oe,{onClick:n,children:e(L,{icon:"close",wrap:!1,sx:{color:"grey.700"}})})]})}),m(se,{children:[i===1&&e(ye,{tableQuery:x,selectedRowIds:y,setSelectedRowIds:r}),i===2&&e(Re,{emailText:u,setEmailText:E}),h&&e(H,{variant:"danger",description:h.reason,isGlobal:!1})]}),m(re,{children:[i===2&&e(T,{variant:"outlined",onClick:()=>c(1),children:"Back"}),e(N,{sx:{flexGrow:1}}),e(T,{variant:"outlined",onClick:n,children:"Cancel"}),i===1&&e(T,{variant:"contained",onClick:()=>c(2),children:"Generate Email"}),i===2&&e(T,{variant:"contained",onClick:()=>{U(u)},children:"Reject and Notify Requester"})]})]})}try{B.displayName="RejectDataAccessRequestModal",B.__docgenInfo={description:`Modal component presented to a data access submission reviewer when they decide to reject a request.
The modal contains a form for selecting rejection reasons and a text field for editing the rejection message.
After crafting a message, the user can reject the submission and send the message to the requester.`,displayName:"RejectDataAccessRequestModal",props:{submissionId:{defaultValue:null,description:"",name:"submissionId",required:!0,type:{name:"string | number"}},tableId:{defaultValue:null,description:"",name:"tableId",required:!1,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}export{B as R};
