{"version":3,"file":"accessRequirementHandlers-904bd03c.js","sources":["../../mocks/msw/handlers/wikiHandlers.ts","../../mocks/msw/handlers/accessRequirementHandlers.ts"],"sourcesContent":["import { rest } from 'msw'\nimport { ACCESS_REQUIREMENT_WIKI_PAGE } from '../../../src/utils/APIConstants'\nimport { WikiPage } from '@sage-bionetworks/synapse-types'\nimport { SynapseApiResponse } from '../handlers'\nimport { mockWikiPages } from '../../mockWiki'\n\nexport const getWikiHandlers = (backendOrigin: string) => [\n  rest.get(\n    `${backendOrigin}${ACCESS_REQUIREMENT_WIKI_PAGE(':arId', ':wikiId')}`,\n    async (req, res, ctx) => {\n      let status = 404\n      let response: SynapseApiResponse<WikiPage> = {\n        reason: `Mock Service worker could not find a wiki page with ID ${req.params.wikiId}`,\n      }\n\n      const wikiPage = mockWikiPages.find(wp => wp.id === req.params.wikiId)\n      if (wikiPage) {\n        response = wikiPage\n        status = 200\n      }\n      return res(ctx.status(status), ctx.json(response))\n    },\n  ),\n]\n","import { rest } from 'msw'\nimport {\n  ACCESS_REQUIREMENT_BY_ID,\n  ACCESS_REQUIREMENT_STATUS,\n  ACCESS_REQUIREMENT_WIKI_PAGE_KEY,\n  ENTITY_ACCESS_REQUIREMENTS,\n} from '../../../src/utils/APIConstants'\nimport { MOCK_REPO_ORIGIN } from '../../../src/utils/functions/getEndpoint'\nimport {\n  AccessRequirement,\n  AccessRequirementStatus,\n  ObjectType,\n  PaginatedResults,\n  SubmissionState,\n  WikiPageKey,\n} from '@sage-bionetworks/synapse-types'\nimport { SynapseApiResponse } from '../handlers'\nimport {\n  mockAccessRequirements,\n  mockAccessRequirementWikiPageKeys,\n} from '../../mockAccessRequirements'\nimport { mockApprovedSubmission } from '../../dataaccess/MockSubmission'\nimport { MOCK_FILE_ENTITY_ID } from '../../entity/mockFileEntity'\n\nexport const getAccessRequirementHandlers = (backendOrigin: string) => [\n  rest.get(\n    `${backendOrigin}${ACCESS_REQUIREMENT_BY_ID(':id')}`,\n\n    async (req, res, ctx) => {\n      let status = 404\n      let response: SynapseApiResponse<AccessRequirement> = {\n        reason: `Mock Service worker could not find an access requirement with ID ${req.params.id}`,\n      }\n      const ar = mockAccessRequirements.find(\n        ar => ar.id.toString() === req.params.id,\n      )\n\n      if (ar) {\n        response = ar\n        status = 200\n      }\n\n      return res(ctx.status(status), ctx.json(response))\n    },\n  ),\n  rest.get(\n    `${backendOrigin}${ACCESS_REQUIREMENT_WIKI_PAGE_KEY(':id')}`,\n    async (req, res, ctx) => {\n      let status = 404\n      let response: SynapseApiResponse<WikiPageKey> = {\n        reason: `Mock Service worker could not find an access requirement wiki page key with AR ID ${req.params.id}`,\n      }\n      const wikiPageKey = mockAccessRequirementWikiPageKeys.find(\n        wpk =>\n          (wpk.ownerObjectType === ObjectType.ACCESS_REQUIREMENT &&\n            wpk.ownerObjectId.toString()) === req.params.id,\n      )\n\n      if (wikiPageKey) {\n        response = wikiPageKey\n        status = 200\n      }\n\n      return res(ctx.status(status), ctx.json(response))\n    },\n  ),\n]\nexport const getAccessRequirementEntityBindingHandlers = (\n  backendOrigin: string,\n  entityId = ':entityId',\n  accessRequirements: AccessRequirement[] = mockAccessRequirements,\n) => [\n  rest.get(\n    `${MOCK_REPO_ORIGIN}${ENTITY_ACCESS_REQUIREMENTS(entityId)}`,\n\n    async (req, res, ctx) => {\n      let status = 200\n      let response: PaginatedResults<AccessRequirement> = {\n        results: accessRequirements,\n        totalNumberOfResults: accessRequirements.length,\n      }\n      return res(ctx.status(status), ctx.json(response))\n    },\n  ),\n]\n\nexport const getAccessRequirementStatusHandlers = (\n  backendOrigin: string,\n  arStatus: Record<string, AccessRequirementStatus> = {},\n) => [\n  rest.get(\n    `${backendOrigin}${ACCESS_REQUIREMENT_STATUS(':id')}`,\n\n    async (req, res, ctx) => {\n      let response: AccessRequirementStatus | undefined\n      const accessRequirement = mockAccessRequirements.find(\n        accessRequirement => req.params.id === accessRequirement.id.toString(),\n      )\n      if (req.params.id in arStatus) {\n        response = arStatus[req.params.id]\n      }\n      if (!response) {\n        const isManagedACTAR =\n          accessRequirement.concreteType ===\n          'org.sagebionetworks.repo.model.ManagedACTAccessRequirement'\n        response = {\n          accessRequirementId: req.params.id as string,\n          concreteType: isManagedACTAR\n            ? 'org.sagebionetworks.repo.model.dataaccess.ManagedACTAccessRequirementStatus'\n            : 'org.sagebionetworks.repo.model.dataaccess.BasicAccessRequirementStatus',\n          isApproved: true,\n          currentSubmissionStatus: isManagedACTAR\n            ? {\n                submissionId: mockApprovedSubmission.id,\n                submittedBy: mockApprovedSubmission.submittedBy,\n                modifiedOn: mockApprovedSubmission.modifiedOn,\n                state: SubmissionState.APPROVED,\n              }\n            : undefined,\n        }\n      }\n      const status = response ? 200 : 404\n      return res(ctx.status(status), ctx.json(response))\n    },\n  ),\n]\n"],"names":["getWikiHandlers","backendOrigin","rest","ACCESS_REQUIREMENT_WIKI_PAGE","req","res","ctx","status","response","wikiPage","mockWikiPages","wp","getAccessRequirementHandlers","ACCESS_REQUIREMENT_BY_ID","ar","mockAccessRequirements","ACCESS_REQUIREMENT_WIKI_PAGE_KEY","wikiPageKey","mockAccessRequirementWikiPageKeys","wpk","ObjectType","getAccessRequirementEntityBindingHandlers","entityId","accessRequirements","MOCK_REPO_ORIGIN","ENTITY_ACCESS_REQUIREMENTS","getAccessRequirementStatusHandlers","arStatus","ACCESS_REQUIREMENT_STATUS","accessRequirement","isManagedACTAR","mockApprovedSubmission","SubmissionState"],"mappings":"4UAMa,MAAAA,EAAmBC,GAA0B,CACxDC,EAAAA,KAAK,IACH,GAAGD,IAAgBE,EAA6B,QAAS,SAAS,IAClE,MAAOC,EAAKC,EAAKC,IAAQ,CACvB,IAAIC,EAAS,IACTC,EAAyC,CAC3C,OAAQ,0DAA0DJ,EAAI,OAAO,QAAA,EAGzE,MAAAK,EAAWC,EAAc,KAAKC,GAAMA,EAAG,KAAOP,EAAI,OAAO,MAAM,EACrE,OAAIK,IACSD,EAAAC,EACFF,EAAA,KAEJF,EAAIC,EAAI,OAAOC,CAAM,EAAGD,EAAI,KAAKE,CAAQ,CAAC,CACnD,CACF,CACF,ECCaI,EAAgCX,GAA0B,CACrEC,EAAAA,KAAK,IACH,GAAGD,IAAgBY,EAAyB,KAAK,IAEjD,MAAOT,EAAKC,EAAKC,IAAQ,CACvB,IAAIC,EAAS,IACTC,EAAkD,CACpD,OAAQ,oEAAoEJ,EAAI,OAAO,IAAA,EAEzF,MAAMU,EAAKC,EAAuB,KAChCD,GAAMA,EAAG,GAAG,SAAS,IAAMV,EAAI,OAAO,EAAA,EAGxC,OAAIU,IACSN,EAAAM,EACFP,EAAA,KAGJF,EAAIC,EAAI,OAAOC,CAAM,EAAGD,EAAI,KAAKE,CAAQ,CAAC,CACnD,CACF,EACAN,EAAAA,KAAK,IACH,GAAGD,IAAgBe,EAAiC,KAAK,IACzD,MAAOZ,EAAKC,EAAKC,IAAQ,CACvB,IAAIC,EAAS,IACTC,EAA4C,CAC9C,OAAQ,qFAAqFJ,EAAI,OAAO,IAAA,EAE1G,MAAMa,EAAcC,EAAkC,KACpDC,IACGA,EAAI,kBAAoBC,EAAW,oBAClCD,EAAI,cAAc,SAAA,KAAgBf,EAAI,OAAO,EAAA,EAGnD,OAAIa,IACST,EAAAS,EACFV,EAAA,KAGJF,EAAIC,EAAI,OAAOC,CAAM,EAAGD,EAAI,KAAKE,CAAQ,CAAC,CACnD,CACF,CACF,EACaa,EAA4C,CACvDpB,EACAqB,EAAW,YACXC,EAA0CR,IACvC,CACHb,EAAAA,KAAK,IACH,GAAGsB,IAAmBC,EAA2BH,CAAQ,IAEzD,MAAOlB,EAAKC,EAAKC,IAAQ,CACvB,IAAIC,EAAS,IACTC,EAAgD,CAClD,QAASe,EACT,qBAAsBA,EAAmB,MAAA,EAEpC,OAAAlB,EAAIC,EAAI,OAAOC,CAAM,EAAGD,EAAI,KAAKE,CAAQ,CAAC,CACnD,CACF,CACF,EAEakB,EAAqC,CAChDzB,EACA0B,EAAoD,KACjD,CACHzB,EAAAA,KAAK,IACH,GAAGD,IAAgB2B,EAA0B,KAAK,IAElD,MAAOxB,EAAKC,EAAKC,IAAQ,CACnB,IAAAE,EACJ,MAAMqB,EAAoBd,EAAuB,KAC/Cc,GAAqBzB,EAAI,OAAO,KAAOyB,EAAkB,GAAG,SAAS,CAAA,EAKvE,GAHIzB,EAAI,OAAO,MAAMuB,IACRnB,EAAAmB,EAASvB,EAAI,OAAO,EAAE,GAE/B,CAACI,EAAU,CACP,MAAAsB,EACJD,EAAkB,eAClB,6DACSrB,EAAA,CACT,oBAAqBJ,EAAI,OAAO,GAChC,aAAc0B,EACV,8EACA,yEACJ,WAAY,GACZ,wBAAyBA,EACrB,CACE,aAAcC,EAAuB,GACrC,YAAaA,EAAuB,YACpC,WAAYA,EAAuB,WACnC,MAAOC,EAAgB,QAEzB,EAAA,MAAA,EAGF,MAAAzB,EAASC,EAAW,IAAM,IACzB,OAAAH,EAAIC,EAAI,OAAOC,CAAM,EAAGD,EAAI,KAAKE,CAAQ,CAAC,CACnD,CACF,CACF"}