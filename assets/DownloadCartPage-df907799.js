import{a,j as e,F as C}from"./jsx-runtime-9dc53467.js";import{r as s}from"./index-76fb7be0.js";import{h as L,D as re,bk as X,n as ee,Y as le,$ as oe,V as se,bu as ce,bv as de,x as me}from"./ApplicationSessionManager-9bd355c2.js";import{D as q}from"./index-01eb1463.js";import"./OrientationBanner-a1ca5cdb.js";import{P as ue}from"./getEndpoint-ac94413e.js";import{b as pe,c as he,u as fe}from"./useDownloadList-28fa77c1.js";import{u as ae}from"./index-e4fc7078.js";import{d as M}from"./dayjs.min-f79c4412.js";import{S as ge}from"./Sort-77fc2c95.js";import{I as w,D as ye}from"./IconSvg-a7217c47.js";import{T as x}from"./SynapseTableConstants-5f56c39f.js";import"./SkeletonButton-007d85cd.js";import{a2 as we,O as be,a3 as ve,a4 as Se,H as Q,P as Ne,a5 as De}from"./HelpPopover-f7b3f4de.js";import{S as ke}from"./SkeletonTable-fdb2ca5b.js";import{d as J}from"./ToastMessage-313b7aae.js";import{B as Ce}from"./LoadingScreen-21cf5616.js";import{l as Ie}from"./timezone-f53425a4.js";import{a as Fe}from"./UserBadge-97c51812.js";import{D as E}from"./Dropdown-212ebba7.js";import{T as Pe}from"./Table-87b372d4.js";import{M as F}from"./Tooltip-801f2a9c.js";import{p as z}from"./pluralize-9f2b9a2f.js";import{L as _e}from"./ActionRequiredCard-4e42716d.js";import{B as ie}from"./Box-8faf86fd.js";import{F as ne}from"./FullWidthAlert-706fe840.js";import{M as Ae}from"./TextField-259737a9.js";import{I as Te}from"./InputAdornment-13f7f90b.js";import{B as _}from"./Button-33299b2c.js";import{T as P}from"./Typography-1d068b0b.js";const Ee="TESTING_TRASH_BTN_CLASS";M.extend(Ie);function H(r){const{filesStatistics:c,refetchStatistics:t}=r,{accessToken:d}=L(),m=re(),{ref:h,inView:o}=ae(),[u,y]=s.useState(!1),[l,f]=s.useState(void 0),[v,n]=s.useState(void 0),{data:p,status:g,isFetchingNextPage:b,isLoading:S,hasNextPage:N,fetchNextPage:O,isError:Y,error:B,refetch:A}=pe(l,v);s.useEffect(()=>{A&&A()},[c,A]),s.useEffect(()=>{Y&&B&&m(B)},[Y,B,m]);const T=(p==null?void 0:p.pages.flatMap(i=>i.page))??[];s.useEffect(()=>{g==="success"&&!b&&N&&O&&(o||u)?O():!N&&u&&(()=>{const k=T.map(I=>`${I.fileEntityId}.${I.versionNumber}`).join(`
`);navigator.clipboard.writeText(k).then(()=>{J("Successfully copied to clipboard")}),y(!1)})()},[g,b,N,O,o,u,T]);const R=i=>i?i=="eligibleForPackaging"?"Only Eligible":"Only Ineligible":"All",Z=async(i,k,I)=>{try{await ee.removeItemFromDownloadListV2(i,d),J(`${k} has been removed from your list.`,"success",{title:I}),A(),t()}catch(V){console.error(V)}},D=({columnSortBy:i})=>e("span",{children:f&&e(ge,{role:"button",style:{height:"20px"},active:(l==null?void 0:l.field)===i,direction:(l==null?void 0:l.field)===i?l.direction==="DESC"?q.DESC:q.ASC:q.DESC,onClick:()=>{const k=i===(l==null?void 0:l.field)?l.direction==="ASC"?"DESC":"ASC":"DESC";f({field:i,direction:k})}})}),te=[void 0,"eligibleForPackaging","ineligibleForPackaging"];return a("div",{className:"bootstrap-4-backport",children:[e(Ce,{show:u}),a("div",{className:"filterFilesContainer",children:[e("span",{className:"filterFilesByText",children:"Filter Files By"}),a(E,{children:[e(E.Toggle,{variant:"gray-primary-500",id:"dropdown-basic",children:R(v)}),e(E.Menu,{role:"menu",children:te.map(i=>e(E.Item,{role:"menuitem",onClick:()=>{n(i)},children:R(i)},`${R(i)}-filter-option`))})]})]}),T.length>0&&e(C,{children:a(Pe,{striped:!0,responsive:!0,className:"DownloadListTableV2",children:[e("thead",{children:a("tr",{children:[e("th",{}),a("th",{children:["Name",e(D,{columnSortBy:"fileName"})]}),a("th",{children:["Size",e(D,{columnSortBy:"fileSize"})]}),a("th",{children:["SynID",e(we,{size:"small",onCopy:()=>{y(!0)}}),e(D,{columnSortBy:"synId"})]}),a("th",{children:["Project",e(D,{columnSortBy:"projectName"})]}),a("th",{children:["Added On",e(D,{columnSortBy:"addedOn"})]}),a("th",{children:["Created By",e(D,{columnSortBy:"createdBy"})]}),a("th",{children:["Created On",e(D,{columnSortBy:"createdOn"})]}),e("th",{className:"stickyColumn",children:"Actions"})]})}),a("tbody",{children:[T.map(i=>{if(i){const k=M(i.addedOn).format("L LT"),I=M(i.createdOn).format("L LT");return a("tr",{children:[a("td",{className:i.isEligibleForPackaging?"":"ineligibleForPackagingTd",children:[i.isEligibleForPackaging&&e(F,{title:"Eligible for packaging",enterNextDelay:x,placement:"right",children:e("span",{className:"eligibileIcon",children:e(w,{wrap:!1,icon:"packagableFile"})})}),!i.isEligibleForPackaging&&e(F,{title:"This file is ineligible for Web packaging because it is >100MB, or it is an external link, or it is not stored on Synapse native storage",enterNextDelay:x,placement:"right",children:e("span",{className:"ineligibileIcon",children:e(w,{wrap:!1,icon:"warningOutlined"})})})]}),e("td",{children:e("a",{target:"_blank",rel:"noopener noreferrer",href:`${ue.PORTAL}#!Synapse:${i.fileEntityId}.${i.versionNumber}`,children:i.fileName})}),e("td",{children:i.fileSizeBytes&&X(i.fileSizeBytes)}),e("td",{children:`${i.fileEntityId}${i.versionNumber?`.${i.versionNumber}`:""}`}),e("td",{children:i.projectName}),e("td",{children:k}),e("td",{children:e(Fe,{userId:i.createdBy})}),e("td",{children:I}),e("td",{className:"stickyColumn",children:a("div",{className:"actionsContainer",children:[e("span",{className:"downloadItem",children:e(be,{entityId:i.fileEntityId,entityVersionNumber:i.versionNumber,displayFileName:!1,onClickCallback:V=>{V||Z({fileEntityId:i.fileEntityId,versionNumber:i.versionNumber},i.fileName,"File Downloaded")}})}),e("span",{className:"programmaticAccessItem",children:e(ve,{entityId:i.fileEntityId,version:i.versionNumber})}),e(F,{title:"Remove from Download Cart",placement:"left",enterNextDelay:x,children:e("span",{className:"removeItem",children:e("button",{className:Ee,onClick:()=>{Z({fileEntityId:i.fileEntityId,versionNumber:i.versionNumber},i.fileName,"File Removed")},children:e(w,{icon:"removeCircle"})})})})]})})]},i.fileEntityId)}else return!1}),e("tr",{ref:h})]})]})}),S&&e(ke,{numCols:5,numRows:3})]})}try{H.displayName="DownloadListTable",H.__docgenInfo={description:"",displayName:"DownloadListTable",props:{filesStatistics:{defaultValue:null,description:"",name:"filesStatistics",required:!0,type:{name:"FilesStatisticsResponse"}},refetchStatistics:{defaultValue:null,description:"",name:"refetchStatistics",required:!0,type:{name:"() => Promise<any>"}}}}}catch{}function $(r){const{accessToken:c}=L(),t=new le({defaultOptions:{queries:{staleTime:50*1e3,retry:!1}}});return c?e(oe,{client:t,children:e(se,{children:r.filesStatistics&&e(H,{...r})})}):e(C,{})}try{$.displayName="AvailableForDownloadTable",$.__docgenInfo={description:`Table of the files added to the Download Cart that are currently available for download.
Note that this creates it's own QueryClient, so it's cache does not persist if you remount.`,displayName:"AvailableForDownloadTable",props:{filesStatistics:{defaultValue:null,description:"",name:"filesStatistics",required:!0,type:{name:"FilesStatisticsResponse"}},refetchStatistics:{defaultValue:null,description:"",name:"refetchStatistics",required:!0,type:{name:"() => Promise<any>"}}}}}catch{}function G(r){const{numFiles:c,numPackagableFiles:t,numBytes:d}=r,m=c-t,h=c===0,o=h?"SRC-inactive":"SRC-primary-text-color";return a("span",{className:"DownloadDetailsV2",children:[e("span",{className:"item",children:!h&&a(C,{children:[c.toLocaleString()," ",z("File",c)]})}),a("span",{className:"item",children:[e("span",{className:o,children:e(w,{wrap:!1,icon:"packagableFile"})}),!h&&a(C,{children:[t.toLocaleString()," ",z("File",t)," eligible for packaging"]})]}),d>0&&e(F,{title:"This is the total size of all files in the Download Cart that are available to download.",enterNextDelay:x,placement:"top",children:e("span",{className:"item",children:X(d)})}),m>0&&a("span",{className:"item",children:[e("span",{className:"SRC-warning-color",children:e(w,{icon:"warningOutlined"})}),!h&&a(C,{children:[m.toLocaleString()," ",z("File",m)," ineligible for packaging"]})]})]})}try{G.displayName="DownloadDetails",G.__docgenInfo={description:"",displayName:"DownloadDetails",props:{numFiles:{defaultValue:null,description:"",name:"numFiles",required:!0,type:{name:"number"}},numPackagableFiles:{defaultValue:null,description:"",name:"numPackagableFiles",required:!0,type:{name:"number"}},numBytes:{defaultValue:null,description:"",name:"numBytes",required:!0,type:{name:"number"}}}}}catch{}function W(r){const{numFiles:c,numPackagableFiles:t,numBytes:d}=r;return e("div",{children:e(G,{numFiles:c,numPackagableFiles:t,numBytes:d})})}try{W.displayName="DownloadListStats",W.__docgenInfo={description:"",displayName:"DownloadListStats",props:{numFiles:{defaultValue:null,description:"",name:"numFiles",required:!0,type:{name:"number"}},numPackagableFiles:{defaultValue:null,description:"",name:"numPackagableFiles",required:!0,type:{name:"number"}},numBytes:{defaultValue:null,description:"",name:"numBytes",required:!0,type:{name:"number"}}}}}catch{}const U=r=>{const{ref:c,inView:t}=ae(),{data:d,status:m,isLoading:h,hasNextPage:o,isFetchingNextPage:u,fetchNextPage:y}=he({throwOnError:!0});s.useEffect(()=>{m==="success"&&!u&&o&&y&&t&&y()},[m,o,u,y,t]);const l=(d==null?void 0:d.pages.flatMap(f=>f.page))??[];return e(C,{children:a(ie,{sx:{pt:5},display:"flex",flexDirection:"column",gap:3,children:[l.map((f,v)=>f?e(Se,{action:f.action,count:f.count,onViewSharingSettingsClicked:r.onViewSharingSettingsClicked},v):!1),l.length>0&&e("div",{ref:c}),h&&e(_e,{})]})})};try{U.displayName="DownloadListActionsRequired",U.__docgenInfo={description:"",displayName:"DownloadListActionsRequired",props:{onViewSharingSettingsClicked:{defaultValue:null,description:'Invoked when a user clicks "View Sharing Settings" for a set of files that require the Download permission',name:"onViewSharingSettingsClicked",required:!1,type:{name:"((benefactorId: string) => void)"}}}}}catch{}const xe="Please provide a package file name and try again.",j=r=>{const{accessToken:c}=L(),[t,d]=s.useState(!1),[m,h]=s.useState(""),[o,u]=s.useState(),[y,l]=s.useState(void 0),{onPackageCreation:f}=r,v=async p=>{if(p.preventDefault(),!m){u({message:xe,variant:"danger"});return}d(!0);try{const g=`${m}.zip`,b=await ce(g,c);l(b);const{resultFileHandleId:S}=b;try{window.location.href=await de(S,c),h(""),l(void 0),f()}catch(N){console.error("Err on getFileHandleByIdURL = ",N)}}catch(g){u({message:g.reason,variant:"danger"})}finally{d(!1)}};return a(C,{children:[e("div",{className:"CreatePackageV2",children:a("div",{className:"createPackageStep",children:[e("span",{className:"createPackageTitle",children:"Create your Download Package"}),e("span",{className:"createPackageDescription",children:"Name your download package and select Download Package to get started."}),!t&&!y&&a(ie,{display:"flex",alignItems:"stretch",children:[e(Ae,{onChange:p=>{h(p.target.value)},type:"text",placeholder:"PackageName",sx:{width:"233px"},InputProps:{endAdornment:e(Te,{position:"end",children:".zip"})}}),e(_,{variant:"contained",color:"primary",onClick:p=>{v(p)},sx:{marginLeft:"20px"},disabled:!m,children:"Download Package"})]}),t&&a("div",{className:"creatingPackage",children:[e("span",{className:"spinner"}),e("span",{style:{marginLeft:5},children:"Creating package..."})]})]})}),e(ne,{show:!!o,variant:o!=null&&o.variant?o.variant:"success",description:o==null?void 0:o.message,autoCloseAfterDelayInSeconds:10,onClose:()=>{u(void 0)}})]})};try{j.displayName="CreatePackageV2",j.__docgenInfo={description:"",displayName:"CreatePackageV2",props:{onPackageCreation:{defaultValue:null,description:"",name:"onPackageCreation",required:!0,type:{name:"() => void"}}}}}catch{}const Le=`${De}
dl_list_file_entities = syn.get_download_list()`,Oe="synapse get-download-list",K=r=>{const{accessToken:c}=L(),[t,d]=s.useState(0),[m,h]=s.useState(!1),[o,u]=s.useState(!1),[y,l]=s.useState(!1),[f,v]=s.useState(),{data:n,isLoading:p,isError:g,error:b,refetch:S}=fe();if(s.useEffect(()=>{g&&b&&v(b)},[g,b]),s.useEffect(()=>{n&&n.numberOfFilesRequiringAction==0&&d(1)},[n]),f)return e(me,{error:f});const N=async()=>{await ee.clearDownloadListV2(c),S()};return a("div",{className:"DownloadCartPage",children:[e("div",{children:a("div",{className:"pageHeader",children:[a("div",{className:"grid",children:[e("h3",{className:"pageHeaderTitle",children:"Your Download Cart"}),e(F,{title:"Immediately removes all items from your download cart",enterNextDelay:300,placement:"right",children:e(_,{onClick:()=>{N()},variant:"text",color:"primary",startIcon:e(ye,{}),children:"Clear Your Download Cart"})})]}),e(P,{className:"description",variant:"body1",children:"You may find your added files in the tabs below. Any files which require actions before download can be found in the Access Actions Required tab, while any that can be downloaded now can be found in the Download List tab."})]})}),e("div",{className:"tabs-container",children:e("div",{className:"container",children:a("ul",{className:"nav nav-tabs",children:[e("li",{className:`nav-item ${t==0?"active":""}`,"aria-selected":t==0,children:a("button",{onClick:()=>d(0),children:["Access Actions Required",!g&&!p&&n&&e("span",{className:"fileCount",children:n.totalNumberOfFiles-n.numberOfFilesAvailableForDownload})]})}),e("li",{className:`nav-item ${t==1?"active":""}`,"aria-selected":t==1,children:a("button",{onClick:()=>d(1),children:["Download List",!g&&!p&&n&&e("span",{className:"fileCount",children:n.numberOfFilesAvailableForDownload})]})})]})})}),t==0&&!g&&!p&&n&&a("div",{children:[n.numberOfFilesRequiringAction>0&&e("div",{children:e("div",{className:"actionsRequiredContainer container",children:e(U,{...r})})}),n.numberOfFilesRequiringAction===0&&e("div",{className:"placeholder",children:e("div",{children:"No actions are currently required."})})]}),t==1&&!g&&!p&&n&&a("div",{children:[n.numberOfFilesAvailableForDownload>0&&a("div",{className:"DownloadListTabContent",children:[e("div",{className:"subSectionOverviewContainer",children:a("div",{className:"subSectionOverview container",children:[a("div",{children:[a("div",{className:"headlineWithHelp",children:[a(P,{variant:"headline3",sx:{mb:2},children:[e(w,{icon:"packagableFile"})," Web Download (.ZIP Packages)"]}),e(Q,{markdownText:"This will allow you to create a .zip file that contains eligible files. Files greater that 100 MB, external links, or files which are not stored on Synapse native storage are ineligible. In most cases, ineligible files can be downloaded individually. External links will require navigation to an external site, which may require a separate login process.",helpUrl:"https://help.synapse.org/docs/Downloading-Data-From-the-Synapse-UI.2004254837.html"})]}),e(P,{variant:"body1",component:"div",sx:{mb:2},children:a("ul",{children:[e("li",{children:"Eligible files will be added to .ZIP packages of up to 1GB in size"}),e("li",{children:"If you have more than 1GB, you can create multiple packages"}),e("li",{children:"Will only include files which are hosted on Synapse native storage"}),e("li",{children:"Packages include a CSV manifest that contains file annotations and other information for each file"})]})}),n.numberOfFilesAvailableForDownloadAndEligibleForPackaging>0&&e(_,{variant:"contained",onClick:()=>{h(!0)},startIcon:e(w,{icon:"download",wrap:!1}),children:"Download As .Zip Packages"}),n.numberOfFilesAvailableForDownloadAndEligibleForPackaging==0&&e(F,{title:"You cannot create a .zip package because there are no eligible files.",enterNextDelay:300,placement:"top",children:e("span",{children:e(_,{variant:"contained",disabled:!0,startIcon:e(w,{icon:"download",wrap:!1}),children:"Download As .Zip Packages"})})})]}),a("div",{children:[a("div",{className:"headlineWithHelp",children:[a(P,{variant:"headline3",sx:{mb:2},children:[e(w,{icon:"code"})," Programmatic Download"]}),e(Q,{markdownText:"This will provide syntax which you can enter into your programmatic client. It is suitable for large files (>100 MB), for packages > 1GB, and for files which aren’t stored on Synapse native storage (e.g. in a special AWS S3 or Google Cloud bucket).  External links will require navigation to an external site, which may require a separate login process.",helpUrl:"https://help.synapse.org/docs/Downloading-Data-Programmatically.2003796248.html"})]}),e(P,{variant:"body1",component:"div",sx:{mb:2},children:a("ul",{children:[e("li",{children:"Requires installation of a programmatic client (R, Python, CLI)"}),e("li",{children:"No limit to the file size or the size of the package that can be downloaded"}),e("li",{children:"Will include files which are hosted on and off Synapse native storage"}),e("li",{children:"Packages include a CSV manifest that contains file annotations and other information for each file"})]})}),e(_,{variant:"contained",onClick:()=>{u(!0)},startIcon:e(w,{icon:"code",wrap:!1}),children:"Create Programmatic Package"})]})]})}),a("div",{className:"availableForDownloadTableContainer container",children:[m&&e(j,{onPackageCreation:()=>{l(!0),S()}}),e(W,{numBytes:n.sumOfFileSizesAvailableForDownload,numPackagableFiles:n.numberOfFilesAvailableForDownloadAndEligibleForPackaging,numFiles:n.numberOfFilesAvailableForDownload}),S&&e($,{filesStatistics:n,refetchStatistics:S})]})]}),n.numberOfFilesAvailableForDownload===0&&e("div",{className:"placeholder",children:e("div",{children:"Your Download Cart is currently empty."})})]}),e(ne,{show:y,variant:"success",title:"Package Created",description:"A package has been created with eligible files. The items contained in this .zip file have been removed from your list. If your package is over 1GB, you will need to create multiple packages.",autoCloseAfterDelayInSeconds:10,onClose:()=>{l(!1)}}),o&&e(Ne,{show:!0,onClose:()=>u(!1),title:"Download Programmatically",pythonCode:Le,cliCode:Oe})]})};try{K.displayName="DownloadCartPage",K.__docgenInfo={description:"Show the Download Cart page.",displayName:"DownloadCartPage",props:{onViewSharingSettingsClicked:{defaultValue:null,description:'Invoked when a user clicks "View Sharing Settings" for a set of files that require the Download permission',name:"onViewSharingSettingsClicked",required:!1,type:{name:"((benefactorId: string) => void)"}}}}}catch{}export{K as D};
