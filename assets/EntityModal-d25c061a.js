import{j as e,a as i,F as R}from"./jsx-runtime-9dc53467.js";import{r as h}from"./index-76fb7be0.js";import{h as Q,T as X,t as A,v as S,bf as Y,bg as ee,bh as te,V as ae}from"./ApplicationSessionManager-9bd355c2.js";import{g as q,B as L}from"./getEndpoint-ac94413e.js";import{u as k,b as ne,C as oe}from"./HelpPopover-f7b3f4de.js";import{d as ie}from"./ToastMessage-313b7aae.js";import{u as se,a as re,S as le}from"./SchemaDrivenAnnotationEditor-a015adad.js";import"./OrientationBanner-a1ca5cdb.js";import{d as de}from"./useEntity-96ca7b35.js";import"./SkeletonButton-007d85cd.js";import{S as ce}from"./SkeletonTable-fdb2ca5b.js";import{d as g}from"./dayjs.min-f79c4412.js";import{F as me}from"./FullWidthAlert-706fe840.js";import{f as v}from"./DateFormatter-4ac10a57.js";import{g as ue,u as _e,a as pe}from"./useUploadDestination-d639de45.js";import{a as O}from"./UserBadge-97c51812.js";import{B as M}from"./Button-33299b2c.js";import{S as he}from"./Skeleton-131bd473.js";import{n as ye}from"./noop-cb277961.js";import{M as fe}from"./Tooltip-801f2a9c.js";function Te(n){if(!/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/.test(n))return!1;const r=new Date(n);return r instanceof Date&&!isNaN(r.getTime())&&r.toISOString()===n}function B(n){return typeof n=="number"||typeof n=="boolean"?n.toString():Te(n)?v(g(n)):n}function I(n){const{entityId:r}=n,[t,T]=h.useState(!1),{isInExperimentalMode:d}=Q(),{data:c,isLoading:b,refetch:y}=de(r,!0),l=c==null?void 0:c.entityMetadata,a=c==null?void 0:c.annotations,{data:p}=se(r,{enabled:d}),{data:f,refetch:u}=re(r,{enabled:d&&!!p}),s=d&&!!p,m=!!l&&!!f&&g(l.modifiedOn).diff(g(f.validatedOn))>0,N=h.useCallback(async()=>{T(!0);const _=[y(),u()];await Promise.allSettled(_),T(!1)},[y,u]);return b||t?e(ce,{numRows:3,numCols:2}):i(R,{children:[l&&a&&X(a)?i("div",{className:"placeholder",children:["This"," ",A(S(l.concreteType))," ","has no annotations."]}):null,e("table",{className:"AnnotationsTable",children:i("tbody",{children:[a&&Object.keys(a).map(_=>i("tr",{className:"AnnotationsTable__Row",children:[e("td",{className:"AnnotationsTable__Row__Key",children:_}),e("td",{className:"AnnotationsTable__Row__Value",children:Array.isArray(a[_])?a[_].map(B).join(", "):B(a[_])})]},_)),s?i("tr",{className:"AnnotationsTable__Row",children:[e("td",{className:"AnnotationsTable__Row__Key Schema",children:"Validation Schema"}),e("td",{className:"AnnotationsTable__Row__Value",children:e("a",{href:`${q(L.REPO_ENDPOINT)}/repo/v1/schema/type/registered/${p.jsonSchemaVersionInfo.$id}`,target:"_blank",rel:"noopener noreferrer",children:p.jsonSchemaVersionInfo.schemaName})})]}):null]})}),l&&s&&m&&e(me,{variant:"warning",description:`This ${A(S(l.concreteType))} has changed since it has been last validated. If this ${A(S(l.concreteType))} is expected to have annotations derived from the Validation Schema, they may not yet be visible.`,primaryButtonConfig:{text:"Reload Annotations",onClick:()=>{N()}},isGlobal:!1})]})}try{I.displayName="AnnotationsTable",I.__docgenInfo={description:"",displayName:"AnnotationsTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const V=({entityId:n,versionNumber:r})=>{var a,p,f,u,s,m,N;const{data:t}=k(n,r),T=t&&Y(t.entity),d=t?ue(t):void 0,c=(a=t==null?void 0:t.entity)==null?void 0:a.parentId,b=d==null?void 0:d.storageLocationId,{data:y}=_e(c,b,{enabled:c!==void 0&&b!=null});let l;return d&&(l=pe(d,y)),t?e("table",{className:"MetadataTable",children:i("tbody",{children:[i("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Name"}),e("td",{className:"MetadataTable__Row__Value",children:(p=t.entity)==null?void 0:p.name})]}),i("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Type"}),e("td",{className:"MetadataTable__Row__Value",children:A(t.entityType)})]}),i("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Synapse ID"}),e("td",{className:"MetadataTable__Row__Value",children:(f=t.entity)==null?void 0:f.id})]}),T&&i("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Version"}),e("td",{className:"MetadataTable__Row__Value",children:ee(t.entity)})]}),l&&i("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Storage"}),e("td",{className:"MetadataTable__Row__Value",children:l})]}),i("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:" Last Modified By"}),i("td",{className:"MetadataTable__Row__Value",children:[e(O,{userId:(u=t.entity)==null?void 0:u.modifiedBy})," at"," ",v(g((s=t.entity)==null?void 0:s.modifiedOn))]})]}),i("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Created By"}),i("td",{className:"MetadataTable__Row__Value",children:[e(O,{userId:(m=t.entity)==null?void 0:m.createdBy})," at"," ",v(g((N=t.entity)==null?void 0:N.createdOn))]})]})]})}):null};try{V.displayName="MetadataTable",V.__docgenInfo={description:"",displayName:"MetadataTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const be=["METADATA","ANNOTATIONS"];function D(n){const{entityId:r,versionNumber:t,show:T,onClose:d,initialTab:c="METADATA",showTabs:b=!0,onEditModeChanged:y=ye}=n,l=h.useRef(null),[a,p]=h.useState(c),[f,u]=h.useState(!1),[s,m]=h.useState(!1),[N,_]=h.useState(()=>m(!1));h.useEffect(()=>(y(s),()=>{y(!1)}),[s,y]);const{data:o}=k(r,t),x=o&&o.permissions.canEdit,E=o&&te(o.entityType),C=E&&o.entity.isLatestVersion,K=a==="METADATA"&&o&&!window.location.href.includes(r),$=i(M,{variant:"contained",onClick:()=>window.open(`${q(L.PORTAL_ENDPOINT)}#!Synapse:${r}`,"_blank","noopener"),children:["Open"," ",o?A(o==null?void 0:o.entityType):""]}),j=a==="ANNOTATIONS"&&s,P=e(M,{variant:"contained",onClick:()=>{l.current.formElement.current.requestSubmit()},children:"Save Annotations"}),F=a==="ANNOTATIONS"&&s,G=e(M,{variant:"outlined",onClick:()=>{_(()=>()=>m(!1)),u(!0)},children:"Cancel"}),U=x&&a==="ANNOTATIONS"&&!s,W=e(fe,{title:E&&!C?"Annotations can only be edited on the latest version":void 0,children:e(M,{variant:"contained",disabled:E&&!C,onClick:()=>{m(!0)},children:"Edit"})}),H=i(R,{children:[b&&!s?e("div",{className:"Tabs",children:be.map(w=>e("div",{className:"Tab",role:"tab",onClick:z=>{z.stopPropagation(),p(w)},"aria-selected":w===a,children:w},w))}):null,e("div",{style:a==="ANNOTATIONS"?{}:{display:"none"},children:s?e(ae,{children:e(le,{entityId:r,formRef:l,hideActions:!0,onSuccess:()=>{ie("Annotations successfully updated.","success"),m(!1)},onCancel:()=>m(!1)})}):e(I,{entityId:r,versionNumber:t})}),e("div",{style:a==="METADATA"?{}:{display:"none"},children:e(V,{entityId:r,versionNumber:t})})]}),J=e(oe,{open:f,title:"Unsaved Changes",content:"Any unsaved changes will be lost. Are you sure you want to close the editor?",onCancel:()=>{u(!1)},onConfirm:()=>{u(!1),N()}}),Z=h.useMemo(()=>{if(o!=null&&o.entity.name){if(a==="ANNOTATIONS")return`${s?"Edit ":""}Annotations for ${o.entity.name}`}else return e(he,{width:"40%"});return o.entity.name},[a,o==null?void 0:o.entity.name,s]);return e(ne,{className:"EntityMetadata",open:T,onCancel:()=>{s?(u(!0),_(()=>()=>{m(!1),d()})):d()},maxWidth:s?"md":"sm",title:Z,content:H,actions:i(R,{children:[J,F&&G,j&&P,U&&W,K&&$]})})}try{D.displayName="EntityModal",D.__docgenInfo={description:"",displayName:"EntityModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},initialTab:{defaultValue:null,description:"",name:"initialTab",required:!1,type:{name:"enum",value:[{value:'"METADATA"'},{value:'"ANNOTATIONS"'}]}},showTabs:{defaultValue:null,description:"",name:"showTabs",required:!1,type:{name:"boolean"}},onEditModeChanged:{defaultValue:null,description:"",name:"onEditModeChanged",required:!1,type:{name:"((isInEditMode: boolean) => void)"}}}}}catch{}export{D as E};
