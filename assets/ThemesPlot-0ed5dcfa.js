import{j as n,a as m,F as Y}from"./jsx-runtime-095bf462.js";import{r as P}from"./index-8db94870.js";import{E as I}from"./ElementWithTooltip-0e6d77c4.js";import{u as U}from"./unCamelCase-16efb97c.js";import{o as G}from"./SynapseConstants-351603e3.js";import"./getEndpoint-ac94413e.js";import{u as W,b7 as j}from"./SynapseClient-a57981a2.js";import{r as D}from"./SqlFunctions-e9b055be.js";import{c as F,P as z}from"./factory-837f2467.js";import{l as f}from"./lodash.default-7805d6b3.js";import{l as H}from"./LoadingScreen-7013a393.js";const J=F(z);function K(a,t){const e=f.cloneDeep(a);if(!t)return e;t.backgroundColor&&(e.plot_bgcolor=t.backgroundColor),e.yaxis.showticklabels=!1,e.xaxis.range=[-5,t.maxValue+30],e.xaxis.visible=t.isXAxis,e.showlegend=t.isLegend,e.margin={t:0,b:t.isXAxis?50:0,l:0,r:0,pad:15};let l=30;return t.isLegend&&(l=35,e.margin.pad=0,e.xaxis={visible:!1,zeroline:!1,showgrid:!1,showline:!1,range:[0,1]},e.yaxis={visible:!1,showline:!1}),t.isXAxis&&(e.yaxis={visible:!1,showgrid:!1,showline:!1},l=50),e.height=l,e}function Z(a,t){const e=new Array(a.length);return t.forEach(l=>{const o=a.indexOf(l.y);e[o]=l.x}),e}function O(a,t,e,l){const o=e===void 0,d=f.uniq(a.map(u=>u.group)),r=[],c=["y-down","triangle-up","cross-thin-open","triangle-up-open-dot","star-square-open","diamond-x"];return d.forEach((u,s)=>{r.push({type:"scatter",x:o?[-10]:Z(e,a.filter(h=>h.group===u)),y:e,text:[u],hovertemplate:"%{x} %{text}<extra></extra>",mode:"markers",name:u,marker:{color:t.markerFill,line:{color:t.markerLine,width:1},symbol:l?l[u]:c[s],size:t.markerSize}})}),r}const b=({plotData:a,optionsConfig:t,layoutConfig:e,label:l,id:o,xMax:d,style:r={width:"100%",height:"100%"},markerSymbols:c,plotStyle:u={markerFill:"#515359",markerLine:"#515359",markerSize:9,backgroundColor:"transparent"},onClick:s,isLegend:h=!1,isXAxis:_=!1})=>{const T=l?[l]:void 0;return n(J,{layout:K(e,{isLegend:h,isXAxis:_,maxValue:d,backgroundColor:u.backgroundColor}),style:r,data:O(a,u,T,c),config:t,onClick:v=>s?s(v):f.noop},`dotPlot_${o}`)};try{b.displayName="DotPlot",b.__docgenInfo={description:"",displayName:"DotPlot",props:{plotData:{defaultValue:null,description:"",name:"plotData",required:!0,type:{name:"GraphItem[]"}},layoutConfig:{defaultValue:null,description:"",name:"layoutConfig",required:!0,type:{name:"Partial<Layout>"}},optionsConfig:{defaultValue:null,description:"",name:"optionsConfig",required:!0,type:{name:"Partial<Config>"}},label:{defaultValue:null,description:"",name:"label",required:!1,type:{name:"string"}},style:{defaultValue:{value:"{ width: '100%', height: '100%' }"},description:"",name:"style",required:!1,type:{name:"CSSProperties"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},isLegend:{defaultValue:{value:"false"},description:"",name:"isLegend",required:!1,type:{name:"boolean"}},isXAxis:{defaultValue:{value:"false"},description:"",name:"isXAxis",required:!1,type:{name:"boolean"}},xMax:{defaultValue:null,description:"",name:"xMax",required:!1,type:{name:"number"}},plotStyle:{defaultValue:{value:`{
    markerFill: '#515359',
    markerLine: '#515359',
    markerSize: 9,
    backgroundColor: 'transparent',
  }`},description:"",name:"plotStyle",required:!1,type:{name:"PlotStyle"}},markerSymbols:{defaultValue:null,description:"",name:"markerSymbols",required:!1,type:{name:"Dictionary"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((e: Readonly<PlotMouseEvent>) => void)"}}}}}catch{}const ee=F(z);function te(a,t,e){t&&(a=a.filter(r=>r.y===t));const l=f.uniq(a.map(r=>r.group)).sort(),o=[],d=["(28,118,175,1)","rgba(91,176,181,1)"];return l.forEach((r,c)=>{const u=a.filter(s=>s.group===r);o.push({x:u.map(s=>s.x),y:u.map(s=>s.y),name:r,orientation:"h",marker:{color:e?e[r]:d[c],width:1},text:[r],hovertemplate:"%{x} %{text}<extra></extra>",textposition:"none",type:"bar"})}),o}function ae(a,{isTop:t,maxValue:e,backgroundColor:l}){const o=f.cloneDeep(a);return o.xaxis={visible:!1,range:[0,e]},l&&(o.plot_bgcolor=l,o.paper_bgcolor=l),t||(o.hoverlabel={font:{size:10}}),o.showlegend=!1,o.height=t?40:20,o}const k=({plotData:a,optionsConfig:t,isTop:e,layoutConfig:l,label:o,xMax:d,colors:r,plotStyle:c={backgroundColor:"transparent"},style:u={width:"100%",height:"100%"},onClick:s})=>n(ee,{style:u,layout:ae(l,{isTop:e,maxValue:d,backgroundColor:c.backgroundColor}),config:t,data:te(a,o,r),onClick:h=>s?s(h):f.noop});try{k.displayName="BarPlot",k.__docgenInfo={description:"",displayName:"BarPlot",props:{isTop:{defaultValue:null,description:"",name:"isTop",required:!0,type:{name:"boolean"}},style:{defaultValue:{value:"{ width: '100%', height: '100%' }"},description:"",name:"style",required:!1,type:{name:"CSSProperties"}},plotData:{defaultValue:null,description:"",name:"plotData",required:!0,type:{name:"GraphItem[]"}},layoutConfig:{defaultValue:null,description:"",name:"layoutConfig",required:!0,type:{name:"Partial<Layout>"}},optionsConfig:{defaultValue:null,description:"",name:"optionsConfig",required:!0,type:{name:"Partial<Config>"}},label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},xMax:{defaultValue:null,description:"",name:"xMax",required:!0,type:{name:"number"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"Dictionary"}},plotStyle:{defaultValue:{value:"{ backgroundColor: 'transparent' }"},description:"",name:"plotStyle",required:!1,type:{name:"PlotStyle"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((event: Readonly<PlotMouseEvent>) => void)"}}}}}catch{}const x={displayModeBar:!1,responsive:!0,scrollZoom:!1,editable:!1,autosizable:!0},oe={delayShow:0,place:"right",type:"light",effect:"solid",border:!0},V={showlegend:!0,dragmode:!1,legend:{font:{size:11},y:1.1,xanchor:"right",x:1,orientation:"h"},xaxis:{visible:!0,fixedrange:!0,zeroline:!1,showgrid:!1,showline:!0,linecolor:"#ddd",autotick:!0,ticks:"outside",tickcolor:"#ddd"},yaxis:{fixedrange:!0,zeroline:!1,gridcolor:"#ddd",automargin:!0},margin:{pad:20},hovermode:"closest"},E={barmode:"stack",showlegend:!1,dragmode:!1,hovermode:"closest",yaxis:{visible:!1,fixedrange:!0},margin:{l:0,r:0,b:0,t:0,pad:0}};function S(a,{xField:t,yField:e,groupField:l,entityId:o,whereClause:d,infoField:r}){const c=`SELECT ${t} as "x", ${e} as "y", ${r?r+' as "info", ':""} ${l} as "group"
                 FROM ${o} ${d?" WHERE "+d:""}`;return j({concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:G,entityId:o,query:{sql:c}},a).then(s=>s.queryResult.queryResults)}function L(a,t){const e=a.reduce((o,d)=>(o[d[t]]=(d[t]in o?Number(o[d[t]]):0)+Number(d.x),o),{}),l=[];for(const o in e)l.push({[t]:o,count:e[o]});return l}const $=(a,t)=>{const e=a.points[0].data;let l=e.y[0],o=e.name;return t&&([l,o]=[o,l]),{facetValue:l,type:o,event:a.event}},le=(a,t)=>n("div",{className:"ThemesPlot__barPlotLegend",children:t.map((e,l)=>m("div",{style:{float:"left"},children:[n("div",{className:"ThemesPlot__barPlotLegend__label",style:{backgroundColor:`${a?a[e]:"transparent"}`}},"topBar_label"),n("div",{className:"ThemesPlot__barPlotLegend__graph",children:e},"topBar_graph")," "]},`topBar_${l}`))}),R=(a,t)=>{for(const e in a)a[e]=a[e].replace(",1)",`, ${t})`).replace(",1.0)",`, ${t})`);return a},re=(a,t)=>f.first(a.filter(e=>e.y===t).map(e=>e.info));function A({dotPlot:a,topBarPlot:t,sideBarPlot:e,tooltipProps:l=oe,onPointClick:o,dotPlotYAxisLabel:d="Research Themes"}){const{accessToken:r}=W(),[c,u]=P.useState(!1),[s,h]=P.useState([]),[_,T]=P.useState([]),[v,Q]=P.useState([]);P.useEffect(()=>{const i=S(r,a),y=S(r,t),g=S(r,e);return Promise.all([i,y,g]).then(p=>{h(D(p[0].headers,p[0].rows)),T(D(p[1].headers,p[1].rows)),Q(D(p[2].headers,p[2].rows)),u(!0)}).catch(p=>{throw p}),()=>{}},[r,a,t,e]);let w=[],N=[],q=0,B=0,M=[],C=[];return c&&(C=L(v,"y"),w=C.sort((i,y)=>y.count-i.count).map(i=>i.y),B=Math.max(...C.map(i=>i.count)),q=Math.max(...s.map(i=>Number(i.x))),M=f.orderBy(L(_,"y"),["y"]),N=f.orderBy(L(_,"group"),["group"]).map(i=>i.group)),m(Y,{children:[!c&&H,c&&m("div",{className:"ThemesPlot",children:[n("div",{className:"ThemesPlot__dotPlotLegend",children:n(b,{id:"head",plotData:s,isLegend:!0,markerSymbols:a.markerSymbols,style:{width:"100%",height:"100%"},layoutConfig:V,optionsConfig:{...x,responsive:!0,staticPlot:!0},plotStyle:{...a.plotStyle,backgroundColor:"transparent"}})}),t.colors&&le(t.colors,N),M.map((i,y)=>m("div",{className:"ThemesPlot__topBarPlot",children:[m("div",{className:"ThemesPlot__topBarPlot__label",children:[i.count,"Â ",U(i.y)]}),n("div",{className:"ThemesPlot__topBarPlot__plot",children:n(k,{style:{width:"100%",height:"100%"},layoutConfig:f.cloneDeep(E),optionsConfig:{...x},plotData:_,isTop:!0,label:i.y,xMax:i.count,onClick:g=>o($(g,!0)),colors:y%2===0?t.colors:R({...t.colors},"1")})})]},`topBarDiv_${y}`)),m("div",{style:{display:"flex",position:"relative"},children:[n("div",{className:"ThemesPlot__dotPlotYLabel",children:d}),m("div",{className:"ThemesPlot__dotPlot",children:[w.map((i,y)=>{var g,p;return m("div",{className:"ThemesPlot__dotPlot__row",style:{backgroundColor:(g=a.plotStyle)==null?void 0:g.backgroundColor},children:[n("div",{className:"ThemesPlot__dotPlot__barColumn",children:n(I,{tooltipText:`${re(s,i)} `,tooltipVisualProps:l,callbackFn:()=>f.noop,children:m("div",{children:[n("span",{className:"ThemesPlot__dotPlot__themeLabel",children:i}),n("br",{}),m("span",{className:"ThemesPlot__dotPlot__countLabel",children:[C[y].count," ",e.countLabel]}),n("br",{}),n(k,{style:{width:"100%"},layoutConfig:E,optionsConfig:x,plotData:v,isTop:!1,xMax:B,label:i,colors:R({...t.colors},"1")})]})})}),n("div",{className:"ThemesPlot__dotPlot__dotPlotColumn",children:n("div",{style:{width:"100%",backgroundColor:(p=a.plotStyle)==null?void 0:p.backgroundColor},children:n(b,{id:`${y}`,onClick:X=>o($(X,!1)),plotData:s,plotStyle:a.plotStyle,markerSymbols:a.markerSymbols,xMax:q,label:i,layoutConfig:V,optionsConfig:{...x,responsive:!1}})})})]},`plotDiv_${+y}`)}),m("div",{className:"ThemesPlot__dotPlot__row",children:[n("div",{className:"ThemesPlot__dotPlot__barColumn",style:{textAlign:"right"},children:"VOLUME:"}),n("div",{className:"ThemesPlot__dotPlot__dotPlotColumn",style:{marginTop:"0px"},children:n(b,{id:"footer",plotData:s,isXAxis:!0,xMax:q,layoutConfig:V,optionsConfig:{...x,responsive:!1}})})]})]})]}),n("div",{})]})]})}try{A.displayName="ThemesPlot",A.__docgenInfo={description:"",displayName:"ThemesPlot",props:{onPointClick:{defaultValue:null,description:"",name:"onPointClick",required:!0,type:{name:"({ facetValue, type, event }: ClickCallbackParams) => void"}},dotPlot:{defaultValue:null,description:"",name:"dotPlot",required:!0,type:{name:"PlotProps"}},topBarPlot:{defaultValue:null,description:"",name:"topBarPlot",required:!0,type:{name:"PlotProps"}},sideBarPlot:{defaultValue:null,description:"",name:"sideBarPlot",required:!0,type:{name:"PlotProps"}},tooltipProps:{defaultValue:{value:`{
  delayShow: 0,
  place: 'right',
  type: 'light',
  effect: 'solid',
  border: true,
}`},description:"",name:"tooltipProps",required:!1,type:{name:"TooltipVisualProps"}},dotPlotYAxisLabel:{defaultValue:{value:"Research Themes"},description:"",name:"dotPlotYAxisLabel",required:!1,type:{name:"string"}}}}}catch{}export{A as T};
//# sourceMappingURL=ThemesPlot-0ed5dcfa.js.map
