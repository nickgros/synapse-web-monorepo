import{a as m,j as e,F as q}from"./jsx-runtime-095bf462.js";import{R as _,r as C}from"./index-8db94870.js";import{I as B}from"./IconSvg-0d658098.js";import{E as P,f as Q,af as J}from"./SynapseClient-2be0d786.js";import"./getEndpoint-ac94413e.js";import{R as V,b as X}from"./SynapseConstants-442c550d.js";import{a as z}from"./useDataAccessSubmission-185e9bf4.js";import{a as K}from"./useGetQueryResultBundle-e4bb6acd.js";import{S as $}from"./immutable.es-400ccb6d.js";import{S as H}from"./LoadingScreen-5786dec8.js";import{F as Z}from"./FullWidthAlert-7e419f2a.js";import{d as ee}from"./ToastMessage-cdf61efe.js";import{D as te,a as oe,b as se,c as re}from"./DialogTitle-41c5a17f.js";import{S as b}from"./Stack-f7ee2fdc.js";import{B as N}from"./Box-891dc3c7.js";import{I as ne}from"./IconButton-1e0dd4f6.js";import{B as T}from"./Button-d3d5b3a8.js";import{T as f}from"./Typography-c5b8eeae.js";import{F as ae}from"./InputLabel-e8578cb2.js";import{T as ie}from"./TextField-46d1fd36.js";import{F as ce,C as le}from"./FormControlLabel-efd88e37.js";const k="category",de="category email prompt",ue="rejection reason",me="email text",fe=`Thank you for submitting your data access request.
`,he=`
If you have questions, do not respond to this email address. Instead, reply to:
act@sagebionetworks.org`;function pe(l){const{category:h,rows:d,selectedRowIds:n,setSelectedRowIds:s,rejectionReasonFormTextIndex:i}=l,[c,p]=_.useState(!1);return m(q,{children:[m(f,{variant:"body1",onClick:()=>p(!c),sx:{fontWeight:700,cursor:"pointer",my:1},children:[e(B,{icon:c?"expandMore":"chevronRight",sx:{color:"grey.700"},wrap:!1}),h]}),e(J,{in:c,children:e(b,{sx:{ml:3},children:(d??[]).map(a=>e(ce,{control:e(le,{checked:n.has(a.rowId),size:"small",onChange:u=>{u.target.checked?s(n.add(a.rowId)):s(n.remove(a.rowId))}}),label:e(f,{variant:"smallText1",children:a.values[i]})},a.rowId))})})]})}function ye(l){var E,y;const{tableQuery:h,selectedRowIds:d,setSelectedRowIds:n}=l,{data:s,isLoading:i,error:c}=h,p=(E=s==null?void 0:s.queryResult)==null?void 0:E.queryResults.headers.findIndex(r=>r.name.toLowerCase()===k),a=(y=s==null?void 0:s.queryResult)==null?void 0:y.queryResults.headers.findIndex(r=>r.name.toLowerCase()===ue),u=s&&s.queryResult&&s.queryResult.queryResults.rows.reduce((r,x)=>{const o=x.values[p];return r[o]=[...r[o]||[],x],r},{});return m(q,{children:[e(f,{variant:"headline3",gutterBottom:!0,children:"Reasons for rejecting"}),e(f,{variant:"body1",gutterBottom:!0,children:"You may wish to reject the user's data access request for a specific reason. The list below contains some common rejection reasons. You will have a chance to edit the response before submitting it, including adding any rejection reason(s) not listed here."}),i&&e(b,{sx:{my:2},children:e(H,{size:30})}),c&&e(P,{error:c}),u&&e(ae,{children:Object.keys(u).map(r=>e(pe,{category:r,rows:u[r],selectedRowIds:d,setSelectedRowIds:n,rejectionReasonFormTextIndex:a},r))}),e(f,{variant:"headline3",sx:{mt:1},gutterBottom:!0,children:"We’ll generate a response email message based on your selections."}),e(f,{variant:"body1",gutterBottom:!0,children:"If your reasons for rejecting are not shown here, that’s okay! You can edit the complete text of the message on the next screen before sending it."})]})}function Re(l){const{emailText:h,setEmailText:d}=l;return m(q,{children:[e(f,{variant:"headline3",gutterBottom:!0,children:"Edit the text of the rejection message"}),e(f,{variant:"body1",gutterBottom:!0,children:"This message will be sent to the data requester. You may edit it, or add custom text to the message."}),e(ie,{multiline:!0,fullWidth:!0,rows:15,value:h,onChange:n=>{d(n.target.value)}})]})}function L(l){var v,j,A;const{open:h,tableId:d=V,onClose:n,submissionId:s}=l,[i,c]=_.useState(1),[p,a]=_.useState(null),[u,E]=C.useState(""),[y,r]=C.useState($()),x=K({entityId:d,query:{sql:`SELECT * FROM ${d}`},partMask:X,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest"}),{data:o}=x,F=(v=o==null?void 0:o.queryResult)==null?void 0:v.queryResults.headers.findIndex(t=>t.name.toLowerCase()===k),D=(j=o==null?void 0:o.queryResult)==null?void 0:j.queryResults.headers.findIndex(t=>t.name.toLowerCase()===de),O=(A=o==null?void 0:o.queryResult)==null?void 0:A.queryResults.headers.findIndex(t=>t.name.toLowerCase()===me),S=o&&o.queryResult&&y.reduce((t,R)=>{const I=o.queryResult.queryResults.rows.find(W=>W.rowId===R),g=I.values[F],Y=I.values[D],M=I.values[O];return t[g]?t[g].reasons=[...t[g].reasons,M]:t[g]={sectionText:Y,reasons:[M]},t},{}),w=S&&fe+Object.keys(S).reduce((t,R)=>{const I=S[R].sectionText;t+=`
`+I+`
`;for(const g of S[R].reasons)t+=`
* `+g+`
`;return t},"")+he;C.useEffect(()=>{w&&E(w)},[y]);const{mutate:U}=z();function G(t){U({submissionId:s.toString(),newState:Q.REJECTED,rejectedReason:t},{onSuccess:()=>{a(null),ee("Submission rejected and message sent to requester","info"),n()},onError:R=>{a(R)}})}return m(te,{open:h,onClose:n,maxWidth:"md",fullWidth:!0,children:[e(oe,{children:m(b,{direction:"row",alignItems:"center",gap:"5px",children:["Reject Request?",e(N,{sx:{flexGrow:1}}),e(ne,{onClick:n,children:e(B,{icon:"close",wrap:!1,sx:{color:"grey.700"}})})]})}),m(se,{children:[i===1&&e(ye,{tableQuery:x,selectedRowIds:y,setSelectedRowIds:r}),i===2&&e(Re,{emailText:u,setEmailText:E}),p&&e(Z,{variant:"danger",description:p.reason,isGlobal:!1})]}),m(re,{children:[i===2&&e(T,{variant:"outlined",onClick:()=>c(1),children:"Back"}),e(N,{sx:{flexGrow:1}}),e(T,{variant:"outlined",onClick:n,children:"Cancel"}),i===1&&e(T,{variant:"contained",onClick:()=>c(2),children:"Generate Email"}),i===2&&e(T,{variant:"contained",onClick:()=>{G(u)},children:"Reject and Notify Requester"})]})]})}try{L.displayName="RejectDataAccessRequestModal",L.__docgenInfo={description:`Modal component presented to a data access submission reviewer when they decide to reject a request.
The modal contains a form for selecting rejection reasons and a text field for editing the rejection message.
After crafting a message, the user can reject the submission and send the message to the requester.`,displayName:"RejectDataAccessRequestModal",props:{submissionId:{defaultValue:null,description:"",name:"submissionId",required:!0,type:{name:"string | number"}},tableId:{defaultValue:null,description:"",name:"tableId",required:!1,type:{name:"string"}},open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}export{L as R};
//# sourceMappingURL=RejectDataAccessRequestModal-c11a3ad1.js.map
