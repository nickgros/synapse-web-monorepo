{"version":3,"file":"mockRejectionReasonsTableQueryResultBundle-80014a9d.js","sources":["../../mocks/msw/handlers/tableQueryHandlers.ts","../../mocks/query/mockRejectionReasonsTableQueryResultBundle.ts"],"sourcesContent":["import { cloneDeep, uniqueId } from 'lodash-es'\nimport { rest } from 'msw'\nimport {\n  ASYNCHRONOUS_JOB_TOKEN,\n  TABLE_QUERY_ASYNC_GET,\n  TABLE_QUERY_ASYNC_START,\n} from '../../../src/utils/APIConstants'\nimport {\n  BackendDestinationEnum,\n  getEndpoint,\n} from '../../../src/utils/functions/getEndpoint'\nimport {\n  BUNDLE_MASK_LAST_UPDATED_ON,\n  BUNDLE_MASK_QUERY_COLUMN_MODELS,\n  BUNDLE_MASK_QUERY_COUNT,\n  BUNDLE_MASK_QUERY_FACETS,\n  BUNDLE_MASK_QUERY_MAX_ROWS_PER_PAGE,\n  BUNDLE_MASK_QUERY_RESULTS,\n  BUNDLE_MASK_QUERY_SELECT_COLUMNS,\n  BUNDLE_MASK_SUM_FILES_SIZE_BYTES,\n} from '../../../src/utils/SynapseConstants'\nimport {\n  AsynchronousJobStatus,\n  AsyncJobId,\n  QueryBundleRequest,\n  QueryResultBundle,\n} from '@sage-bionetworks/synapse-types'\n\nconst BIT_TO_FIELD_MAP: Record<number, keyof QueryResultBundle> = {\n  [BUNDLE_MASK_QUERY_RESULTS]: 'queryResult',\n  [BUNDLE_MASK_QUERY_COUNT]: 'queryCount',\n  [BUNDLE_MASK_QUERY_SELECT_COLUMNS]: 'selectColumns',\n  [BUNDLE_MASK_QUERY_MAX_ROWS_PER_PAGE]: 'maxRowsPerPage',\n  [BUNDLE_MASK_QUERY_COLUMN_MODELS]: 'columnModels',\n  [BUNDLE_MASK_QUERY_FACETS]: 'facets',\n  [BUNDLE_MASK_SUM_FILES_SIZE_BYTES]: 'sumFileSizes',\n  [BUNDLE_MASK_LAST_UPDATED_ON]: 'lastUpdatedOn',\n}\n\nfunction removeBundleFieldsUsingMask(\n  queryResultBundle: QueryResultBundle,\n  partMask: number,\n): QueryResultBundle {\n  const result = cloneDeep(queryResultBundle)\n  Object.entries(BIT_TO_FIELD_MAP).forEach(([bit, field]) => {\n    if ((partMask & parseInt(bit)) === 0) {\n      delete result[field]\n    }\n  })\n  return result\n}\n\nexport function getHandlersForTableQuery(\n  response: QueryResultBundle,\n  backendOrigin = getEndpoint(BackendDestinationEnum.REPO_ENDPOINT),\n) {\n  const asyncJobId = uniqueId()\n  let queryBundleRequest: QueryBundleRequest | undefined\n\n  return [\n    rest.post(\n      `${backendOrigin}${TABLE_QUERY_ASYNC_START(':id')}`,\n      async (req, res, ctx) => {\n        queryBundleRequest = req.body as QueryBundleRequest\n        return res(\n          ctx.status(201),\n          ctx.json<AsyncJobId>({\n            token: asyncJobId,\n          }),\n        )\n      },\n    ),\n\n    rest.get(\n      `${backendOrigin}${ASYNCHRONOUS_JOB_TOKEN(asyncJobId)}`,\n      async (req, res, ctx) => {\n        const resultBundle = removeBundleFieldsUsingMask(\n          response,\n          queryBundleRequest!.partMask,\n        )\n\n        return res(\n          ctx.status(201),\n          ctx.json<\n            AsynchronousJobStatus<QueryBundleRequest, QueryResultBundle>\n          >({\n            jobState: 'COMPLETE',\n            jobCanceling: false,\n            requestBody: queryBundleRequest!,\n            etag: '00000000-0000-0000-0000-000000000000',\n            jobId: asyncJobId,\n            responseBody: resultBundle,\n            startedByUserId: 0,\n            startedOn: '',\n            changedOn: '',\n            progressMessage: '',\n            progressCurrent: 100,\n            progressTotal: 100,\n            exception: '',\n            errorMessage: '',\n            errorDetails: '',\n            runtimeMS: 100,\n          }),\n        )\n      },\n    ),\n\n    rest.get(\n      `${backendOrigin}${TABLE_QUERY_ASYNC_GET(':id', asyncJobId)}`,\n      async (req, res, ctx) => {\n        const resultBundle = removeBundleFieldsUsingMask(\n          response,\n          queryBundleRequest!.partMask,\n        )\n\n        return res(ctx.status(201), ctx.json<QueryResultBundle>(resultBundle))\n      },\n    ),\n  ]\n}\n","import { QueryResultBundle } from '@sage-bionetworks/synapse-types'\n\n/**\n * Mock data for the RejectDataAccessRequestModal\n */\nconst mockRejectionReasons: QueryResultBundle = {\n  concreteType: 'org.sagebionetworks.repo.model.table.QueryResultBundle',\n  queryResult: {\n    concreteType: 'org.sagebionetworks.repo.model.table.QueryResult',\n    queryResults: {\n      concreteType: 'org.sagebionetworks.repo.model.table.RowSet',\n      tableId: 'syn50683097',\n      etag: 'DEFAULT',\n      headers: [\n        { name: 'Category', columnType: 'STRING', id: '189246' },\n        {\n          name: 'Category Email Prompt',\n          columnType: 'LARGETEXT',\n          id: '189249',\n        },\n        { name: 'Rejection Reason', columnType: 'STRING', id: '189247' },\n        { name: 'Email Text', columnType: 'LARGETEXT', id: '189248' },\n      ],\n      rows: [\n        {\n          rowId: 1,\n          versionNumber: 0,\n          values: [\n            'Issue with the Intended Data Use Statement',\n            'The information you provided on the electronic data access request tool is incomplete or requires more information. Please address the following:',\n            'The user did not provide the first and last name of the Project Lead',\n            'Provide the first and last name of your Project Lead.',\n          ],\n        },\n        {\n          rowId: 2,\n          versionNumber: 0,\n          values: [\n            'Issue with the Intended Data Use Statement',\n            'The information you provided on the electronic data access request tool is incomplete or requires more information. Please address the following:',\n            'The user did not provide the full, unabbreviated name of their institution',\n            'Provide the full, unabbreviated name of your institution.',\n          ],\n        },\n        {\n          rowId: 3,\n          versionNumber: 0,\n          values: [\n            'Issue with the Intended Data Use Statement',\n            'The information you provided on the electronic data access request tool is incomplete or requires more information. Please address the following:',\n            'The user did not provide enough information in their Intended Data Use (IDU) statement',\n            'Please add more information to your Intended Data Use statement. Your Intended Data Use statement should address the following points: What do you want to do? Why are you doing it? How do you want to do it?',\n          ],\n        },\n        {\n          rowId: 4,\n          versionNumber: 0,\n          values: [\n            'Issue with Documentation',\n            'To access this data, please provide complete and/or current documentation. The following items are incomplete or need to be updated:',\n            'The user submitted the wrong version of the DUC',\n            'You have submitted an older version of the data use certificate (DUC). Please download and execute the updated version of the DUC. The current version is embedded in the electronic data access request tool.',\n          ],\n        },\n        {\n          rowId: 5,\n          versionNumber: 0,\n          values: [\n            'Issue with Documentation',\n            'To access this data, please provide complete and/or current documentation. The following items are incomplete or need to be updated:',\n            'The DUC is not signed by the signing official',\n            'Please complete your data use certificate (DUC) with your signing official\\u2019s details, including signature and date. (This should be an institutional representative with signing authority, e.g., Department Head).',\n          ],\n        },\n        {\n          rowId: 6,\n          versionNumber: 0,\n          values: [\n            'Issue with Documentation',\n            'To access this data, please provide complete and/or current documentation. The following items are incomplete or need to be updated:',\n            'The DUC is missing the PI\\u2019s details and/or signature',\n            'Please complete your data use certificate (DUC) with your Principal Investigator\\u2019s details, including signature and date',\n          ],\n        },\n        {\n          rowId: 7,\n          versionNumber: 0,\n          values: [\n            'Issue with Documentation',\n            'To access this data, please provide complete and/or current documentation. The following items are incomplete or need to be updated:',\n            'The user did not provide the correct Synapse IDs for their team',\n            'Please provide the correct Synapse usernames of the members of your research team (these must match exactly between the DUC and the electronic data access request tool).',\n          ],\n        },\n        {\n          rowId: 8,\n          versionNumber: 0,\n          values: [\n            'Issue with Documentation',\n            'To access this data, please provide complete and/or current documentation. The following items are incomplete or need to be updated:',\n            'The user\\u2019s team did not sign the DUC',\n            'Please ensure all members of your research team sign and date the data use certificate (DUC).',\n          ],\n        },\n        {\n          rowId: 9,\n          versionNumber: 0,\n          values: [\n            'Issue with Documentation',\n            'To access this data, please provide complete and/or current documentation. The following items are incomplete or need to be updated:',\n            'The user did not submit the applicable IRB / IEC / ERC approval for their research',\n            'Please submit the applicable ethics committee approval letter (IRB/IEC/ERC) that indicates approval for your research using this dataset.',\n          ],\n        },\n        {\n          rowId: 10,\n          versionNumber: 0,\n          values: [\n            'Other Issue',\n            'Please note the following with your access request:',\n            'Other',\n            null,\n          ],\n        },\n      ],\n    },\n  },\n  maxRowsPerPage: 314,\n}\n\nexport default mockRejectionReasons\n"],"names":["BIT_TO_FIELD_MAP","BUNDLE_MASK_QUERY_RESULTS","BUNDLE_MASK_QUERY_COUNT","BUNDLE_MASK_QUERY_SELECT_COLUMNS","BUNDLE_MASK_QUERY_MAX_ROWS_PER_PAGE","BUNDLE_MASK_QUERY_COLUMN_MODELS","BUNDLE_MASK_QUERY_FACETS","BUNDLE_MASK_SUM_FILES_SIZE_BYTES","BUNDLE_MASK_LAST_UPDATED_ON","removeBundleFieldsUsingMask","queryResultBundle","partMask","result","cloneDeep","bit","field","getHandlersForTableQuery","response","backendOrigin","getEndpoint","BackendDestinationEnum","asyncJobId","uniqueId","queryBundleRequest","rest","TABLE_QUERY_ASYNC_START","req","res","ctx","ASYNCHRONOUS_JOB_TOKEN","resultBundle","TABLE_QUERY_ASYNC_GET","mockRejectionReasons"],"mappings":"yVA4BA,MAAMA,EAA4D,CAChE,CAACC,CAAyB,EAAG,cAC7B,CAACC,CAAuB,EAAG,aAC3B,CAACC,CAAgC,EAAG,gBACpC,CAACC,CAAmC,EAAG,iBACvC,CAACC,CAA+B,EAAG,eACnC,CAACC,CAAwB,EAAG,SAC5B,CAACC,CAAgC,EAAG,eACpC,CAACC,CAA2B,EAAG,eACjC,EAEA,SAASC,EACPC,EACAC,EACmB,CACb,MAAAC,EAASC,EAAUH,CAAiB,EACnC,cAAA,QAAQV,CAAgB,EAAE,QAAQ,CAAC,CAACc,EAAKC,CAAK,IAAM,CACpDJ,EAAW,SAASG,CAAG,GAC1B,OAAOF,EAAOG,CAAK,CACrB,CACD,EACMH,CACT,CAEO,SAASI,EACdC,EACAC,EAAgBC,EAAYC,EAAuB,aAAa,EAChE,CACA,MAAMC,EAAaC,IACf,IAAAC,EAEG,MAAA,CACLC,EAAAA,KAAK,KACH,GAAGN,IAAgBO,EAAwB,KAAK,IAChD,MAAOC,EAAKC,EAAKC,KACfL,EAAqBG,EAAI,KAClBC,EACLC,EAAI,OAAO,GAAG,EACdA,EAAI,KAAiB,CACnB,MAAOP,CAAA,CACR,CAAA,EAGP,EAEAG,EAAAA,KAAK,IACH,GAAGN,IAAgBW,EAAuBR,CAAU,IACpD,MAAOK,EAAKC,EAAKC,IAAQ,CACvB,MAAME,EAAerB,EACnBQ,EACAM,EAAoB,QAAA,EAGf,OAAAI,EACLC,EAAI,OAAO,GAAG,EACdA,EAAI,KAEF,CACA,SAAU,WACV,aAAc,GACd,YAAaL,EACb,KAAM,uCACN,MAAOF,EACP,aAAcS,EACd,gBAAiB,EACjB,UAAW,GACX,UAAW,GACX,gBAAiB,GACjB,gBAAiB,IACjB,cAAe,IACf,UAAW,GACX,aAAc,GACd,aAAc,GACd,UAAW,GAAA,CACZ,CAAA,CAEL,CACF,EAEAN,EAAAA,KAAK,IACH,GAAGN,IAAgBa,EAAsB,MAAOV,CAAU,IAC1D,MAAOK,EAAKC,EAAKC,IAAQ,CACvB,MAAME,EAAerB,EACnBQ,EACAM,EAAoB,QAAA,EAGf,OAAAI,EAAIC,EAAI,OAAO,GAAG,EAAGA,EAAI,KAAwBE,CAAY,CAAC,CACvE,CACF,CAAA,CAEJ,CClHA,MAAME,EAA0C,CAC9C,aAAc,yDACd,YAAa,CACX,aAAc,mDACd,aAAc,CACZ,aAAc,8CACd,QAAS,cACT,KAAM,UACN,QAAS,CACP,CAAE,KAAM,WAAY,WAAY,SAAU,GAAI,QAAS,EACvD,CACE,KAAM,wBACN,WAAY,YACZ,GAAI,QACN,EACA,CAAE,KAAM,mBAAoB,WAAY,SAAU,GAAI,QAAS,EAC/D,CAAE,KAAM,aAAc,WAAY,YAAa,GAAI,QAAS,CAC9D,EACA,KAAM,CACJ,CACE,MAAO,EACP,cAAe,EACf,OAAQ,CACN,6CACA,oJACA,uEACA,uDACF,CACF,EACA,CACE,MAAO,EACP,cAAe,EACf,OAAQ,CACN,6CACA,oJACA,6EACA,2DACF,CACF,EACA,CACE,MAAO,EACP,cAAe,EACf,OAAQ,CACN,6CACA,oJACA,yFACA,gNACF,CACF,EACA,CACE,MAAO,EACP,cAAe,EACf,OAAQ,CACN,2BACA,uIACA,kDACA,gNACF,CACF,EACA,CACE,MAAO,EACP,cAAe,EACf,OAAQ,CACN,2BACA,uIACA,gDACA,qNACF,CACF,EACA,CACE,MAAO,EACP,cAAe,EACf,OAAQ,CACN,2BACA,uIACA,uDACA,0HACF,CACF,EACA,CACE,MAAO,EACP,cAAe,EACf,OAAQ,CACN,2BACA,uIACA,kEACA,2KACF,CACF,EACA,CACE,MAAO,EACP,cAAe,EACf,OAAQ,CACN,2BACA,uIACA,uCACA,+FACF,CACF,EACA,CACE,MAAO,EACP,cAAe,EACf,OAAQ,CACN,2BACA,uIACA,qFACA,2IACF,CACF,EACA,CACE,MAAO,GACP,cAAe,EACf,OAAQ,CACN,cACA,sDACA,QACA,IACF,CACF,CACF,CACF,CACF,EACA,eAAgB,GAClB"}