import{j as t,a as u,F as G}from"./jsx-runtime-9dc53467.js";import{r as d,R as fe}from"./index-76fb7be0.js";import{h as te,n as q,x as ne,bV as _e,bW as Ae,bX as ke,bY as Oe}from"./ApplicationSessionManager-9bd355c2.js";import"./getEndpoint-ac94413e.js";import"./OrientationBanner-a1ca5cdb.js";import{a as Ve,C as de}from"./CreatedOnByUserDiv-f1e5aff5.js";import{W as Ee}from"./WarningDialog-1e7b7d7f.js";import{I as ae,C as Me}from"./IconSvg-a7217c47.js";import{R as S}from"./Row-e0dc9f69.js";import{C as E}from"./Col-9c69cc00.js";import{a as f,b as W,F as $}from"./Form-8a372d67.js";import{M as re}from"./Alert-c3fe2b05.js";import{B as D}from"./Button-33299b2c.js";import{D as g}from"./Dropdown-212ebba7.js";import{d as b}from"./dayjs.min-f79c4412.js";import{I as ue}from"./IconButton-f820fa46.js";import{c as qe}from"./createSvgIcon-396e3e24.js";import{g as ge,c as Be}from"./_commonjsHelpers-de833af9.js";import{u as Fe}from"./timezone-f53425a4.js";import{D as ce}from"./DateTimePicker-9becfd50.js";import{u as Pe}from"./ThemesPlot-b390026d.js";const Ue=qe(t("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddBox"),Se=e=>{const[n,r]=d.useState(e);return{list:n,handleListChange:s=>l=>{const m=[...n];m[s]=l,r(m)},handleListRemove:s=>()=>{const l=n.filter((m,h)=>s!==h);r(l)},appendToList:(...s)=>{const l=[...n];l.push(...s),r(l)},setList:r}},Y=({evaluationId:e,entityId:n,onDeleteSuccess:r,onSaveSuccess:a})=>{if(e&&n)throw new Error("please use either evaluationId or entityId but not both");const{accessToken:i}=te(),[o,s]=d.useState(),[l,m]=d.useState(!1);d.useEffect(()=>{o&&m(!1)},[o]);const[h,y]=d.useState(""),[_,C]=d.useState(""),[A,w]=d.useState(""),[I,k]=d.useState(""),[p,O]=d.useState({contentSource:n});d.useEffect(()=>{y(p.name??""),C(p.description??""),w(p.submissionInstructionsMessage??""),k(p.submissionReceiptMessage??"")},[p]),d.useEffect(()=>{e&&(s(void 0),q.getEvaluation(e,i).then(c=>{O(c)}).catch(c=>s(c)))},[e,i]);const V=()=>{s(void 0),m(!1);const c={...p,name:h,description:_,submissionInstructionsMessage:A,submissionReceiptMessage:I};(c.id?q.updateEvaluation(c,i):q.createEvaluation(c,i)).then(x=>{O(x),m(!0),a&&a(x.id)}).catch(x=>s(x))},T=p!=null&&p.id?()=>{s(void 0),q.deleteEvaluation(p.id,i).then(r).catch(c=>s(c))}:void 0;return t("div",{className:"bootstrap-4-backport",children:u("div",{className:"evaluation-editor",children:[u(S,{children:[t(E,{children:u("h4",{children:[p.id?"Edit":"Create"," Evaluation Queue"]})}),t(E,{children:t(je,{onClick:V,onDelete:T})})]}),u(f,{children:[u(f.Group,{children:[t(f.Label,{htmlFor:"evaluation-name",children:"Name"}),t(f.Control,{id:"evaluation-name",type:"text",value:h,onChange:c=>y(c.target.value)})]}),u(f.Group,{children:[t(f.Label,{htmlFor:"evaluation-description",children:"Description"}),t(f.Control,{id:"evaluation-description",as:"textarea",value:_,rows:2,onChange:c=>C(c.target.value)})]}),u(f.Group,{children:[t(f.Label,{htmlFor:"evaluation-submissioninstructions",children:"Submission Instructions"}),t(f.Control,{as:"textarea",id:"evaluation-submissioninstructions",value:A,rows:2,onChange:c=>w(c.target.value)})]}),u(f.Group,{children:[t(f.Label,{htmlFor:"evaluation-receiptmessage",children:"Submission Receipt Message"}),t(f.Control,{id:"evaluation-receiptmessage",type:"text",value:I,onChange:c=>k(c.target.value)})]}),(p==null?void 0:p.createdOn)&&t(Ve,{userId:p.ownerId,date:new Date(p.createdOn)}),o&&t(ne,{error:o}),l&&t(re,{className:"save-success-alert",severity:"success",onClose:()=>m(!1),sx:{marginBottom:"20px"},children:"Successfully saved."}),t("div",{className:"d-flex justify-content-end",children:t(D,{variant:"contained",color:"primary",className:"save-button",onClick:V,children:"Save"})})]})]})})},je=({onClick:e,onDelete:n})=>{const[r,a]=d.useState(!1);return u(G,{children:[n&&t(Ee,{title:"Delete Evaluation Queue",content:"Are you sure you want to delete this Evaluation Queue?",open:r,confirmButtonText:"Delete",onConfirm:()=>{n(),a(!1)},onConfirmCallbackArgs:[],onCancel:()=>{a(!1)},confirmButtonColor:"error"}),u(g,{className:"float-right",children:[t(g.Toggle,{variant:"link",className:"dropdown-no-caret",children:t(ae,{icon:"verticalEllipsis"})}),u(g.Menu,{alignRight:!0,children:[t(g.Item,{role:"menuitem",onClick:e,children:"Save"}),n&&u(G,{children:[t(g.Divider,{}),t(g.Item,{role:"menuitem",onClick:()=>a(!0),children:"Delete"})]})]})]})]})};try{Y.displayName="EvaluationEditor",Y.__docgenInfo={description:"Edits basic properties of an Evaluation",displayName:"EvaluationEditor",props:{evaluationId:{defaultValue:null,description:"Use if UPDATING an existing Evaluation. Id of the evaluation to edit",name:"evaluationId",required:!1,type:{name:"string"}},entityId:{defaultValue:null,description:"Use if CREATING a new Evaluation. Id of the Entity that will be associated with the Evaluation",name:"entityId",required:!1,type:{name:"string"}},onDeleteSuccess:{defaultValue:null,description:"Callback after successful deletion of the Evaluation",name:"onDeleteSuccess",required:!0,type:{name:"() => void"}},onSaveSuccess:{defaultValue:null,description:"Callback after successful save of the Evaluation",name:"onSaveSuccess",required:!1,type:{name:"((evaluationId: string) => void)"}}}}}catch{}const ye={DAILY:"Daily Limit",WEEKLY:"Weekly Limit",MONTHLY:"Monthly Limit"},K=({limitInput:e,allSelectedTypes:n,onChange:r})=>u(fe.Fragment,{children:[u(W,{className:"limit-type",children:[t("label",{children:"Limit Type"}),t($,{as:"select",custom:!0,value:e.type,onChange:a=>{r({type:a.target.value,maxSubmissionString:e.maxSubmissionString})},children:Object.entries(ye).map(([a,i])=>t("option",{value:a,disabled:n.has(a)&&a!==e.type,children:i},a))})]}),u(W,{className:"limit-input",children:[t("label",{children:"Maximum Submissions"}),t($,{type:"text",pattern:"[0-9]*",value:e.maxSubmissionString,onChange:a=>{r({type:e.type,maxSubmissionString:a.target.value})}})]})]});try{K.displayName="EvaluationRoundLimitOptions",K.__docgenInfo={description:"",displayName:"EvaluationRoundLimitOptions",props:{limitInput:{defaultValue:null,description:"",name:"limitInput",required:!0,type:{name:"EvaluationRoundLimitInput"}},allSelectedTypes:{defaultValue:null,description:"",name:"allSelectedTypes",required:!0,type:{name:"Set<EvaluationRoundLimitType>"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(limitInput: EvaluationRoundLimitInput) => void"}}}}}catch{}const be=Object.keys(ye),Ge=e=>be.find(n=>!e.has(n)),Q=({limitInputs:e,handleChange:n,handleDeleteLimit:r,onAddNewLimit:a})=>{const i=new Set(e.map(s=>s.type)),o=d.useCallback(()=>{a({type:Ge(i),maxSubmissionString:""})},[a,i]);return d.useEffect(()=>{e.length===0&&o()},[e,o]),t("div",{"data-testid":"EvaluationRoundLimitOptionsList",className:"advanced-limits-grid",children:e.map((s,l)=>u(fe.Fragment,{children:[t(K,{limitInput:s,allSelectedTypes:i,onChange:n(l)}),t(ue,{color:"primary","aria-label":"Remove",className:"remove-button",onClick:r(l),children:t(Me,{})}),l===e.length-1&&e.length<be.length&&t(ue,{color:"primary","aria-label":"Add",onClick:o,className:"add-button",children:t(Ue,{})})]},s.type))})};try{Q.displayName="EvaluationRoundLimitOptionsList",Q.__docgenInfo={description:"",displayName:"EvaluationRoundLimitOptionsList",props:{limitInputs:{defaultValue:null,description:"",name:"limitInputs",required:!0,type:{name:"EvaluationRoundLimitInput[]"}},handleChange:{defaultValue:null,description:"",name:"handleChange",required:!0,type:{name:"(index: number) => (limitInput: EvaluationRoundLimitInput) => void"}},handleDeleteLimit:{defaultValue:null,description:"",name:"handleDeleteLimit",required:!0,type:{name:"(index: number) => () => void"}},onAddNewLimit:{defaultValue:null,description:"",name:"onAddNewLimit",required:!0,type:{name:"(limit: EvaluationRoundLimitInput) => void"}}}}}catch{}var Le={exports:{}},P=1;function We(){return P=(P*9301+49297)%233280,P/233280}function $e(e){P=e}var Ye={nextValue:We,seed:$e},H=Ye,N="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-",L,me,R;function J(){R=!1}function Ne(e){if(!e){L!==N&&(L=N,J());return}if(e!==L){if(e.length!==N.length)throw new Error("Custom alphabet for shortid must be "+N.length+" unique characters. You submitted "+e.length+" characters: "+e);var n=e.split("").filter(function(r,a,i){return a!==i.lastIndexOf(r)});if(n.length)throw new Error("Custom alphabet for shortid must be "+N.length+" unique characters. These characters were not unique: "+n.join(", "));L=e,J()}}function Ke(e){return Ne(e),L}function Qe(e){H.seed(e),me!==e&&(J(),me=e)}function He(){L||Ne(N);for(var e=L.split(""),n=[],r=H.nextValue(),a;e.length>0;)r=H.nextValue(),a=Math.floor(r*e.length),n.push(e.splice(a,1)[0]);return n.join("")}function xe(){return R||(R=He(),R)}function Je(e){var n=xe();return n[e]}function ze(){return L||N}var ie={get:ze,characters:Ke,seed:Qe,lookup:Je,shuffled:xe},j=typeof window=="object"&&(window.crypto||window.msCrypto),z;!j||!j.getRandomValues?z=function(e){for(var n=[],r=0;r<e;r++)n.push(Math.floor(Math.random()*256));return n}:z=function(e){return j.getRandomValues(new Uint8Array(e))};var Xe=z,Ze=function(e,n,r){for(var a=(2<<Math.log(n.length-1)/Math.LN2)-1,i=-~(1.6*a*r/n.length),o="";;)for(var s=e(i),l=i;l--;)if(o+=n[s[l]&a]||"",o.length===+r)return o},et=ie,tt=Xe,nt=Ze;function at(e){for(var n=0,r,a="";!r;)a=a+nt(tt,et.get(),1),r=e<Math.pow(16,n+1),n++;return a}var rt=at,B=rt,it=1567752802062,ot=7,F,he;function st(e){var n="",r=Math.floor((Date.now()-it)*.001);return r===he?F++:(F=0,he=r),n=n+B(ot),n=n+B(e),F>0&&(n=n+B(F)),n=n+B(r),n}var lt=st,dt=ie;function ut(e){if(!e||typeof e!="string"||e.length<6)return!1;var n=new RegExp("[^"+dt.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]");return!n.test(e)}var ct=ut;(function(e){var n=ie,r=lt,a=ct,i=0;function o(h){return n.seed(h),e.exports}function s(h){return i=h,e.exports}function l(h){return h!==void 0&&n.characters(h),n.shuffled()}function m(){return r(i)}e.exports=m,e.exports.generate=m,e.exports.seed=o,e.exports.worker=s,e.exports.characters=l,e.exports.isValid=a})(Le);var mt=Le.exports,ht=mt;const Ce=ge(ht),we=(e,n)=>({reactListKey:n??Ce.generate(),evaluationId:e.evaluationId,id:e.id,etag:e.etag,roundStart:e.roundStart,roundEnd:e.roundEnd,totalSubmissionLimit:pt(e.limits),otherLimits:vt(e.limits)}),pt=e=>(e||[]).filter(n=>n.limitType==="TOTAL").reduce((n,r)=>r.maximumSubmissions.toString(),""),vt=e=>(e||[]).filter(n=>n.limitType!=="TOTAL").reduce((n,r)=>(n.push({type:r.limitType,maxSubmissionString:r.maximumSubmissions.toString()}),n),[]),X=({onSave:e,onDelete:n})=>{const[r,a]=d.useState(!1);return u(G,{children:[t(Ee,{title:"Delete Evaluation Round",content:"Are you sure you want to delete this Evaluation Round?",open:r,confirmButtonText:"Delete",onConfirm:()=>{n(),a(!1)},onConfirmCallbackArgs:[],onCancel:()=>{a(!1)},confirmButtonColor:"error"}),u(g,{className:"float-right",children:[t(g.Toggle,{"aria-label":"Round Options",variant:"link",className:"dropdown-no-caret evaluation-round-editor-dropdown",children:t(ae,{icon:"verticalEllipsis"})}),u(g.Menu,{alignRight:!0,children:[t(g.Item,{onClick:e,children:"Save"}),t(g.Divider,{}),t(g.Item,{onClick:()=>a(!0),children:"Delete"})]})]})]})};try{X.displayName="EvaluationRoundEditorDropdown",X.__docgenInfo={description:"",displayName:"EvaluationRoundEditorDropdown",props:{onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"() => void"}}}}}catch{}var Ie={exports:{}};(function(e,n){(function(r,a){e.exports=a()})(Be,function(){return function(r,a){a.prototype.isSameOrAfter=function(i,o){return this.isSame(i,o)||this.isAfter(i,o)}}})})(Ie);var ft=Ie.exports;const Et=ge(ft);b.extend(Fe);b.extend(Et);const gt=(e,n)=>{let r,a,i;const o=b();return o.isSameOrAfter(e)?o.isBefore(n)?(r="status-in-progress",a={icon:"sync"},i="IN PROGRESS"):(r="status-completed",a={icon:"clipboardCheck"},i="COMPLETED"):(r="status-not-yet-started",a=void 0,i="NOT YET STARTED"),t("div",{className:r,children:u("div",{className:"status",children:[a&&t(ae,{...a}),t("span",{children:i})]})})},St=(e,n,r,a,i)=>{const o=[];if(a){const s=Number(a);if(Number.isNaN(s))throw TypeError("Total Submission is not an integer");o.push({limitType:"TOTAL",maximumSubmissions:s})}return i.forEach(s=>{if(s.maxSubmissionString){const l=Number(s.maxSubmissionString);if(Number.isNaN(l))throw TypeError(s.type+" Limit is not an integer");o.push({limitType:s.type,maximumSubmissions:l})}}),{id:e.id,etag:e.etag,evaluationId:e.evaluationId,roundStart:b.utc(n).toJSON(),roundEnd:b.utc(r).toJSON(),limits:o}};function pe(e,n){if(n==null)return null;switch(n){case"disablePast":return`${Pe(e)} date cannot be in the past`;case"invalidDate":default:return"Invalid date"}}const Z=({evaluationRoundInput:e,onSave:n,onDelete:r})=>{const{accessToken:a}=te(),[i,o]=d.useState(),[s,l]=d.useState(!1);d.useEffect(()=>{i&&l(!1)},[i]);const[m,h]=d.useState(e.roundStart?b(e.roundStart):null),[y,_]=d.useState(e.roundEnd?b(e.roundEnd):null),[C,A]=d.useState(e.totalSubmissionLimit),[w,I]=d.useState(!1),[k,p]=d.useState(null),[O,V]=d.useState(null),{list:T,handleListRemove:c,handleListChange:oe,appendToList:x}=Se(e.otherLimits),Te=v=>{const M=c(v);return()=>{M(),T.length===1&&I(!1)}},se=()=>{l(!1);let v;try{v=St(e,m,y,C,T)}catch(M){o(M)}v&&(v.id?_e(v,a):Ae(v,a)).then(U=>{const De=we(U,e.reactListKey);o(void 0),l(!0),n(De)}).catch(U=>o(U))},Re=()=>{e.id?ke(e.evaluationId,e.id,a).then(()=>r()).catch(v=>o(v)):r()},le=b().isSameOrAfter(e.roundStart);return t("div",{className:"evaluation-round-editor",children:t(de,{children:t(de.Body,{children:u(f,{role:"form",children:[u(S,{children:[t(E,{children:u("h5",{children:["ROUND STATUS",e.id&&" ("+e.id+")"]})}),t(E,{children:t(X,{onDelete:Re,onSave:se})})]}),t(S,{className:"mb-3",children:t(E,{children:t("div",{className:"round-status",children:gt(e.roundStart,e.roundEnd)})})}),t(S,{children:t(E,{children:t("h5",{children:"DURATION"})})}),u(S,{children:[t(E,{children:t(ce,{label:"Round Start",value:m,onChange:h,onError:v=>p(v),disabled:le,disablePast:!le,slotProps:{textField:{helperText:pe("start",k)}}})}),t(E,{children:t(ce,{label:"Round End",value:y,onChange:_,onError:v=>V(v),disablePast:!b(y).isSame(e.roundEnd),slotProps:{textField:{helperText:pe("end",O)}}})})]}),t(S,{children:t(E,{children:t("h5",{style:{marginTop:"20px"},children:"SUBMISSION LIMITS"})})}),t(S,{children:t(E,{children:u(W,{children:[t("label",{children:"Total Submissions / Round"}),t($,{value:C,type:"text",pattern:"[0-9]*",onChange:v=>A(v.target.value),autoComplete:"new-password"})]})})}),t(S,{className:"mb-3",children:t(E,{children:t(D,{variant:"text",color:"primary",sx:{fontSize:"16px !important"},className:"advanced-limits-link",onClick:()=>I(!w),children:"Advanced Limits"})})}),w&&t(Q,{limitInputs:T,handleChange:oe,handleDeleteLimit:Te,onAddNewLimit:x}),i&&t(S,{className:"my-3",children:t(E,{children:t(ne,{error:i})})}),s&&t(S,{className:"my-3",children:t(E,{children:t(re,{className:"save-success-alert",severity:"success",onClose:()=>l(!1),sx:{mb:"20px"},children:"Successfully saved."})})}),t(S,{className:"mt-3",children:t(E,{children:t(D,{variant:"contained",color:"primary",className:"save-button float-right border-0",onClick:se,children:"Save"})})})]})})})})};try{Z.displayName="EvaluationRoundEditor",Z.__docgenInfo={description:"",displayName:"EvaluationRoundEditor",props:{evaluationRoundInput:{defaultValue:null,description:"",name:"evaluationRoundInput",required:!0,type:{name:"EvaluationRoundInput"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(evaluationRound: EvaluationRoundInput) => void"}}}}}catch{}const yt=(e,n,r,a)=>{const i=[],o=s=>{Oe(e,{nextPageToken:s},n).then(l=>{const m=l.page.map(h=>we(h));i.push(...m),a(void 0),l.nextPageToken?o(l.nextPageToken):r(i)}).catch(l=>{a(l)})};o(void 0)},ee=({evaluationId:e})=>{const{accessToken:n}=te(),[r,a]=d.useState(),{list:i,appendToList:o,handleListChange:s,handleListRemove:l,setList:m}=Se([]);return d.useEffect(()=>{yt(e,n,m,a)},[n,e]),r?t(ne,{error:r}):u("div",{className:"evaluation-round-editor-list bootstrap-4-backport",children:[t("div",{className:"evaluation-rounds",children:i.map((h,y)=>t(Z,{evaluationRoundInput:h,onSave:s(y),onDelete:l(y)},h.reactListKey))}),t("div",{children:t(D,{className:"add-round-button",variant:"contained",color:"primary",onClick:()=>{o({reactListKey:Ce(),evaluationId:e,roundStart:"",roundEnd:"",totalSubmissionLimit:"",otherLimits:[]})},children:"Add Round"})})]})};try{ee.displayName="EvaluationRoundEditorList",ee.__docgenInfo={description:"Edits EvaluationsRounds for an Evaluation.",displayName:"EvaluationRoundEditorList",props:{evaluationId:{defaultValue:null,description:"id of the Evaluation containing EvaluationRounds to edit",name:"evaluationId",required:!0,type:{name:"string"}}}}}catch{}const ve=({evaluationId:e,entityId:n,onDeleteSuccess:r})=>{const[a,i]=d.useState(e);return u("div",{className:"bootstrap-4-backport",children:[t(Y,{evaluationId:a,entityId:a?void 0:n,onDeleteSuccess:r,onSaveSuccess:i}),t("div",{className:"my-4",children:a?t(ee,{evaluationId:a}):t(bt,{})})]})},bt=()=>{const[e,n]=d.useState(!1);return t("div",{"data-testid":"FakeEvaluationRoundEditorList",children:e?t(re,{severity:"info",children:"Evaluation Rounds can be edited once the Evaluation has been created."}):t(D,{className:"add-round-button",variant:"contained",color:"primary",onClick:()=>{n(!0)},children:"Add Round"})})};try{ve.displayName="EvaluationEditorPage",ve.__docgenInfo={description:"Combined editor that allows editing an Evaluation's data and also it's associated rounds (once the Evaluation exists on Synapse)",displayName:"EvaluationEditorPage",props:{evaluationId:{defaultValue:null,description:"Use if UPDATING an existing Evaluation. Id of the evaluation to edit",name:"evaluationId",required:!1,type:{name:"string"}},entityId:{defaultValue:null,description:"Use if CREATING a new Evaluation. Id of the Entity that will be associated with the Evaluation",name:"entityId",required:!1,type:{name:"string"}},onDeleteSuccess:{defaultValue:null,description:"Callback after successful deletion of the Evaluation",name:"onDeleteSuccess",required:!0,type:{name:"() => void"}}}}}catch{}export{ve as E};
