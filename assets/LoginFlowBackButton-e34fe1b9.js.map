{"version":3,"file":"LoginFlowBackButton-e34fe1b9.js","sources":["../../src/lib/utils/hooks/useLogin.ts","../../../../node_modules/.pnpm/mui-one-time-password-input@1.1.0_@emotion+react@11.10.6_@emotion+styled@11.10.6_@mui+materia_es6l66fetswt4fsyfwxulqp5ye/node_modules/mui-one-time-password-input/dist/mui-one-time-password-input.es.js","../../src/lib/containers/auth/TOTPForm.tsx","../../src/lib/containers/auth/UsernamePasswordForm.tsx","../../src/lib/containers/auth/RecoveryCodeForm.tsx","../../src/lib/containers/auth/LoginForm.tsx","../../src/lib/containers/auth/LoginFlowBackButton.tsx"],"sourcesContent":["import { Dispatch, SetStateAction, useEffect, useState } from 'react'\nimport { SynapseClient } from '../index'\nimport { LoginResponse } from '../synapseTypes'\nimport {\n  TwoFactorAuthLoginRequest,\n  TwoFactorAuthOtpType,\n} from '../synapseTypes/TwoFactorAuthLoginRequest'\nimport { TwoFactorAuthErrorResponse } from '../synapseTypes/ErrorResponse'\nimport { AUTHENTICATION_RECEIPT_LOCALSTORAGE_KEY } from '../SynapseConstants'\nimport { useMutation } from 'react-query'\nimport { SynapseClientError } from '../SynapseClientError'\n\nexport type UseLoginReturn = {\n  step:\n    | 'CHOOSE_AUTH_METHOD'\n    | 'USERNAME_PASSWORD'\n    | 'VERIFICATION_CODE'\n    | 'RECOVERY_CODE'\n    | 'LOGGED_IN'\n  onStepChange: Dispatch<SetStateAction<UseLoginReturn['step']>>\n  submitUsernameAndPassword: (username: string, password: string) => void\n  submitOneTimePassword: (\n    code: string,\n    /* The type of one time password code that can be used to authenticate through two-factor authentication. Default is based on current value of `step` */\n    otpType?: TwoFactorAuthOtpType,\n  ) => void\n  errorMessage: string | undefined\n  isLoading: boolean\n}\n\n/**\n * Stateful hook that manages logging into Synapse\n */\nexport default function useLogin(\n  sessionCallback?: () => void,\n  twoFaErrorResponse?: TwoFactorAuthErrorResponse,\n): UseLoginReturn {\n  const [step, setStep] = useState<UseLoginReturn['step']>('CHOOSE_AUTH_METHOD')\n  const [errorMessage, setErrorMessage] = useState<string>()\n  const [userId, setUserId] = useState<number>()\n  const [twoFaToken, setTwoFaToken] = useState<string>()\n\n  /*\n   * In SWC, if logging in with OAuth, the servlet will call POST /oauth2/session2 to get the access token.\n   *\n   * If the user has 2FA enabled, the servlet will receive a 401 with the userId and twoFaToken in the response.\n   * The servlet will then redirect the user to the login page with the userId and twoFaToken in the searchParams.\n   *\n   * This effect will check if the search params are present, and change the step to 'VERIFICATION_CODE' if they are.\n   */\n  useEffect(() => {\n    // Replace the hash with a slash to handle SWC, which uses a hash in the URL. Otherwise, the searchParams aren't found\n    const fullUrl: URL = new URL(window.location.href.replaceAll('#', '/'))\n\n    const { searchParams } = fullUrl\n    if (searchParams) {\n      const userId = searchParams.get('userId')\n      const twoFaToken = searchParams.get('twoFaToken')\n      if (userId && twoFaToken) {\n        setUserId(parseInt(userId, 10))\n        setTwoFaToken(twoFaToken)\n        if (\n          !['VERIFICATION_CODE', 'RECOVERY_CODE', 'LOGGED_IN'].includes(step)\n        ) {\n          setStep('VERIFICATION_CODE')\n        }\n      }\n    }\n  }, [step])\n\n  /*\n   * In client-only apps (like Portals), if logging in with OAuth, the client app will call POST /oauth2/session2 to get the access token.\n   *\n   * If the user has 2FA enabled, the client app will receive a 401 with the userId and twoFaToken in the response.\n   *\n   * The app can pass the error response as a prop/argument, and we'll use it here to jump straight to the VERIFICATION_CODE step.\n   */\n  useEffect(() => {\n    if (twoFaErrorResponse) {\n      setTwoFaToken(twoFaErrorResponse.twoFaToken)\n      setUserId(twoFaErrorResponse.userId)\n      if (!['VERIFICATION_CODE', 'RECOVERY_CODE', 'LOGGED_IN'].includes(step)) {\n        setStep('VERIFICATION_CODE')\n      }\n    }\n  }, [twoFaErrorResponse])\n\n  /* When the step changes, clear the old error message. */\n  useEffect(() => {\n    setErrorMessage(undefined)\n  }, [step])\n\n  async function finishLogin(loginResponse: LoginResponse) {\n    await SynapseClient.setAccessTokenCookie(loginResponse.accessToken)\n    localStorage.setItem(\n      AUTHENTICATION_RECEIPT_LOCALSTORAGE_KEY,\n      loginResponse.authenticationReceipt,\n    )\n    setStep('LOGGED_IN')\n\n    if (sessionCallback) {\n      sessionCallback()\n    }\n  }\n\n  const {\n    mutate: mutateLoginWithUsernameAndPassword,\n    isLoading: isLoadingLoginWithUsernameAndPassword,\n  } = useMutation<\n    LoginResponse | TwoFactorAuthErrorResponse,\n    SynapseClientError,\n    { username: string; password: string; authenticationReceipt: string | null }\n  >(\n    ({ username, password, authenticationReceipt }) =>\n      SynapseClient.login(username, password, authenticationReceipt),\n    {\n      onError: error => {\n        setErrorMessage(error.reason)\n      },\n      onSuccess: async loginResponse => {\n        if ('errorCode' in loginResponse) {\n          setStep('VERIFICATION_CODE')\n          setTwoFaToken(loginResponse.twoFaToken)\n          setUserId(loginResponse.userId)\n        } else {\n          await finishLogin(loginResponse)\n        }\n      },\n    },\n  )\n\n  const {\n    mutate: mutateLoginWith2FACode,\n    isLoading: isLoadingLoginWith2FACode,\n  } = useMutation<LoginResponse, SynapseClientError, TwoFactorAuthLoginRequest>(\n    SynapseClient.loginWith2fa,\n    {\n      onError: e => {\n        setErrorMessage(e.reason)\n        if (\n          // The twoFaToken wasn't transmitted correctly\n          e.reason.includes('The provided twoFaToken is invalid') ||\n          // The user waited too long to enter the code.\n          e.reason.includes('Token has expired')\n        ) {\n          console.warn(e)\n          // Instruct the user refresh to start over.\n          setErrorMessage(\n            'Something went wrong. Refresh the page and try again.',\n          )\n          // If the 2FA token is in the search parameters, remove it so the user doesn't just get the same error again.\n          if (window.location.href.includes('twoFaToken')) {\n            window.history.replaceState(\n              {},\n              document.title,\n              // using regex because SWC hashbang doesn't work with URLSearchParams\n              window.location.href.replaceAll(\n                /(twoFaToken|userId)=[^&]*&?/g,\n                '',\n              ),\n            )\n          }\n        }\n      },\n      onSuccess: finishLogin,\n    },\n  )\n\n  const submitUsernameAndPassword: UseLoginReturn['submitUsernameAndPassword'] =\n    (username, password) => {\n      setErrorMessage(undefined)\n      const authenticationReceipt = localStorage.getItem(\n        AUTHENTICATION_RECEIPT_LOCALSTORAGE_KEY,\n      )\n      mutateLoginWithUsernameAndPassword({\n        username,\n        password,\n        authenticationReceipt,\n      })\n    }\n\n  const submitOneTimePassword: UseLoginReturn['submitOneTimePassword'] = (\n    code,\n    otpType = step === 'RECOVERY_CODE' ? 'RECOVERY_CODE' : 'TOTP',\n  ) => {\n    setErrorMessage(undefined)\n    if (twoFaToken == null || userId == null) {\n      // This could happen if the 2FA component exists on its own route, and the user directly navigates to it without first logging in with credentials/OAuth\n      setErrorMessage(\n        'You did not first log in with your password or a third-party identity provider.',\n      )\n      return\n    }\n    const request: TwoFactorAuthLoginRequest = {\n      userId: userId,\n      twoFaToken: twoFaToken,\n      otpCode: code,\n      otpType: otpType,\n    }\n    mutateLoginWith2FACode(request)\n  }\n\n  return {\n    step,\n    onStepChange: setStep,\n    submitUsernameAndPassword,\n    submitOneTimePassword: submitOneTimePassword,\n    errorMessage,\n    isLoading:\n      isLoadingLoginWithUsernameAndPassword || isLoadingLoginWith2FACode,\n  }\n}\n","import T from \"react\";\nimport L from \"@mui/material/Box\";\nimport { styled as W } from \"@mui/material/styles\";\nimport q from \"@mui/material/TextField\";\nimport { jsx as C } from \"react/jsx-runtime\";\nconst z = W(q)`\n  input {\n    text-align: center;\n  }\n`, G = {\n  TextFieldStyled: z\n}, H = (n) => /* @__PURE__ */ C(G.TextFieldStyled, {\n  ...n\n}), I = {\n  left: \"ArrowLeft\",\n  right: \"ArrowRight\",\n  backspace: \"Backspace\"\n};\nfunction J(n, o) {\n  return n <= 0 ? [] : Array.from({ length: n }, o);\n}\nfunction Q(n, o, l) {\n  return n.map((a, i) => o === i ? l : a);\n}\nfunction w(n) {\n  return n.join(\"\");\n}\nfunction B(n, o) {\n  return [...n, o];\n}\nfunction U(n, o, l) {\n  return n.reduce(\n    (a, i, f) => {\n      const { characters: d, restArrayMerged: p } = a;\n      if (f < l)\n        return {\n          restArrayMerged: p,\n          characters: B(d, i)\n        };\n      const [h, ...g] = p;\n      return {\n        restArrayMerged: g,\n        characters: B(d, h || \"\")\n      };\n    },\n    {\n      restArrayMerged: o,\n      characters: []\n    }\n  ).characters;\n}\nfunction X(n) {\n  return n.split(\"\");\n}\nconst Z = T.forwardRef((n, o) => {\n  const {\n    value: l,\n    length: a,\n    autoFocus: i,\n    onChange: f,\n    TextFieldsProps: d,\n    onComplete: p,\n    validateChar: h,\n    className: g,\n    ...P\n  } = n, {\n    onPaste: R,\n    onFocus: S,\n    onKeyDown: k,\n    className: M,\n    ...E\n  } = d || {}, c = J(a, (e, r) => ({\n    character: l[r] || \"\",\n    inputRef: T.createRef()\n  })), m = (e) => c.findIndex(({\n    inputRef: r\n  }) => r.current === e), D = () => c.map(({\n    character: e\n  }) => e), N = (e, r) => {\n    const t = Q(D(), e, r);\n    return w(t);\n  }, x = (e) => {\n    c[e]?.inputRef.current?.focus();\n  }, u = (e) => {\n    c[e]?.inputRef.current?.select();\n  }, y = (e) => {\n    e + 1 !== a && (c[e + 1].character ? u(e + 1) : x(e + 1));\n  }, K = (e) => {\n    e > 0 && u(e - 1);\n  }, V = (e) => {\n    const r = e.target.value[0] || \"\", t = m(e.target);\n    if (typeof h == \"function\" && !h(r, t))\n      return;\n    const s = N(t, r);\n    f?.(s), s.length === a && p?.(s), r !== \"\" ? s.length < a ? y(s.length - 1) : y(t) : s[t] ? u(t) : K(t);\n  }, b = (e) => {\n    e.preventDefault(), e.target.select(), S?.(e);\n  }, j = (e) => {\n    const r = e.target, t = m(r);\n    r.value === e.key ? (e.preventDefault(), y(t)) : !r.value && I.backspace === e.key || I.left === e.key ? (e.preventDefault(), u(t - 1)) : I.right === e.key && (e.preventDefault(), u(t + 1)), k?.(e);\n  }, $ = (e) => {\n    e.preventDefault();\n    const r = e.target, t = e.clipboardData.getData(\"text/plain\"), s = m(r), Y = D(), A = U(Y, X(t), s), O = A.findIndex((_, v) => v > s && _ === \"\"), F = w(A);\n    if (f?.(F), F.length === a) {\n      p?.(F), x(a - 1);\n      return;\n    }\n    O !== -1 && x(O), R?.(e);\n  };\n  return /* @__PURE__ */ C(L, {\n    display: \"flex\",\n    gap: \"20px\",\n    alignItems: \"center\",\n    ref: o,\n    className: `MuiOtpInput-Box ${g || \"\"}`,\n    ...P,\n    children: c.map(({\n      character: e,\n      inputRef: r\n    }, t) => /* @__PURE__ */ C(H, {\n      autoFocus: i ? t === 0 : !1,\n      autoComplete: \"one-time-code\",\n      value: e,\n      inputRef: r,\n      className: `MuiOtpInput-TextField MuiOtpInput-TextField-${t + 1} ${M || \"\"}`,\n      onPaste: $,\n      onFocus: b,\n      onChange: V,\n      onKeyDown: j,\n      ...E\n    }, t))\n  });\n});\nZ.defaultProps = {\n  value: \"\",\n  length: 4,\n  autoFocus: !1,\n  validateChar: () => !0,\n  onChange: () => {\n  },\n  onComplete: () => {\n  },\n  TextFieldsProps: {}\n};\nexport {\n  Z as MuiOtpInput\n};\n","import React from 'react'\nimport { Box, Button } from '@mui/material'\nimport { MuiOtpInput } from 'mui-one-time-password-input'\nimport { UseLoginReturn } from '../../utils/hooks'\n\nconst TOTP_LENGTH = 6\nconst DIGIT_CHARACTERS = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']\n\ntype TOTPFormProps = {\n  onSubmit: (value: string) => void\n  isLoading: UseLoginReturn['isLoading']\n}\n\nexport default function TOTPForm(props: TOTPFormProps) {\n  const { onSubmit, isLoading } = props\n  const [verificationCode, setVerificationCode] = React.useState('')\n  return (\n    <Box>\n      <MuiOtpInput\n        autoFocus\n        length={TOTP_LENGTH}\n        value={verificationCode}\n        onChange={setVerificationCode}\n        onComplete={onSubmit}\n        validateChar={(character: string) => {\n          return DIGIT_CHARACTERS.includes(character) || character === ''\n        }}\n        gap={0}\n        sx={{\n          '.MuiInputBase-root': {\n            paddingLeft: '5px',\n            paddingRight: '5px',\n          },\n          '.MuiFormControl-root:first-of-type > .MuiInputBase-root': {\n            borderTopRightRadius: 0,\n            borderBottomRightRadius: 0,\n          },\n          '.MuiFormControl-root:last-of-type > .MuiInputBase-root': {\n            borderTopLeftRadius: 0,\n            borderBottomLeftRadius: 0,\n          },\n          '.MuiFormControl-root:not(:first-of-type):not(:last-of-type) > .MuiInputBase-root':\n            {\n              borderRadius: 0,\n            },\n        }}\n      />\n\n      <Button\n        fullWidth\n        type=\"submit\"\n        color=\"primary\"\n        variant=\"contained\"\n        sx={{\n          height: '50px',\n          mt: 4,\n          mb: 2,\n        }}\n        disabled={verificationCode.length !== TOTP_LENGTH || isLoading}\n        onClick={e => {\n          e.preventDefault()\n          onSubmit(verificationCode)\n        }}\n      >\n        {isLoading ? 'Verifying...' : 'Submit'}\n      </Button>\n    </Box>\n  )\n}\n","import { Button, Link } from '@mui/material'\nimport React, { useState } from 'react'\nimport {\n  BackendDestinationEnum,\n  getEndpoint,\n} from '../../utils/functions/getEndpoint'\nimport TextField from '../TextField'\nimport { UseLoginReturn } from '../../utils/hooks'\n\ntype UsernamePasswordFormProps = {\n  onSubmit: (username: string, password: string) => void\n  resetPasswordUrl?: string\n  isLoading: UseLoginReturn['isLoading']\n}\n\nexport default function UsernamePasswordForm(props: UsernamePasswordFormProps) {\n  const {\n    resetPasswordUrl = `${getEndpoint(\n      BackendDestinationEnum.PORTAL_ENDPOINT,\n    )}#!PasswordReset:0`,\n    onSubmit,\n    isLoading,\n  } = props\n  const [username, setUsername] = useState('')\n  const [password, setPassword] = useState('')\n\n  function handleLogin(e: React.SyntheticEvent) {\n    e.preventDefault()\n    onSubmit(username, password)\n  }\n  return (\n    <form\n      onSubmit={e => {\n        handleLogin(e)\n      }}\n    >\n      <TextField\n        required\n        fullWidth\n        autoFocus\n        autoComplete=\"username\"\n        label=\"Username or Email Address\"\n        id=\"username\"\n        type=\"text\"\n        value={username}\n        onChange={e => setUsername(e.target.value)}\n      />\n      <TextField\n        required\n        fullWidth\n        autoComplete=\"current-password\"\n        label=\"Password\"\n        id=\"current-password\"\n        type=\"password\"\n        value={password}\n        onChange={e => setPassword(e.target.value)}\n      />\n      <Link href={resetPasswordUrl}>Forgot password?</Link>\n      <Button\n        fullWidth\n        type=\"submit\"\n        color=\"primary\"\n        variant=\"contained\"\n        disabled={isLoading}\n        sx={{\n          height: '50px',\n          mt: 4,\n          mb: 2,\n        }}\n      >\n        {isLoading ? 'Logging you in...' : 'Sign in'}\n      </Button>\n    </form>\n  )\n}\n","import React from 'react'\nimport { Box, Button } from '@mui/material'\nimport TextField from '../TextField'\nimport { UseLoginReturn } from '../../utils/hooks'\n\n// 16 characters separated into chunks of 4 by 3 hyphens\nconst RECOVERY_CODE_LENGTH = 19\n\ntype RecoveryCodeFormProps = {\n  onSubmit: (value: string) => void\n  isLoading: UseLoginReturn['isLoading']\n}\n\nexport default function RecoveryCodeForm(props: RecoveryCodeFormProps) {\n  const { onSubmit, isLoading } = props\n  const [recoveryCode, setRecoveryCode] = React.useState('')\n  return (\n    <Box>\n      <TextField\n        placeholder=\"Enter backup code\"\n        value={recoveryCode}\n        onChange={e => {\n          // coerce the input to lowercase and remove any nonalphanumeric or hyphen characters\n          const valueWithAllowedChars = e.target.value\n            .toLowerCase()\n            .replace(/[^a-z0-9-]/gi, '')\n          setRecoveryCode(valueWithAllowedChars)\n        }}\n      />\n\n      <Button\n        fullWidth\n        type=\"submit\"\n        color=\"primary\"\n        variant=\"contained\"\n        sx={{\n          height: '50px',\n          mt: 4,\n          mb: 2,\n        }}\n        disabled={recoveryCode.length !== RECOVERY_CODE_LENGTH || isLoading}\n        onClick={e => {\n          e.preventDefault()\n          onSubmit(recoveryCode)\n        }}\n      >\n        {isLoading ? 'Verifying...' : 'Submit'}\n      </Button>\n    </Box>\n  )\n}\n","import React from 'react'\nimport {\n  BackendDestinationEnum,\n  getEndpoint,\n} from '../../utils/functions/getEndpoint'\nimport { Box, Link } from '@mui/material'\nimport FullWidthAlert from '../FullWidthAlert'\nimport { UseLoginReturn } from '../../utils/hooks'\nimport { TwoFactorAuthErrorResponse } from '../../utils/synapseTypes/ErrorResponse'\nimport TOTPForm from './TOTPForm'\nimport UsernamePasswordForm from './UsernamePasswordForm'\nimport AuthenticationMethodSelection from './AuthenticationMethodSelection'\nimport RecoveryCodeForm from './RecoveryCodeForm'\n\ntype Props = {\n  ssoRedirectUrl?: string\n  registerAccountUrl?: string\n  resetPasswordUrl?: string\n  /* Invoked before redirecting to Google. Useful in portals where we may want to store the current URL to redirect back here. */\n  onBeginOAuthSignIn?: () => void\n  step: UseLoginReturn['step']\n  onStepChange: (step: UseLoginReturn['step']) => void\n  /* optionally pass the 2FA error response to directly start the 2FA challenge */\n  twoFactorAuthenticationRequired?: TwoFactorAuthErrorResponse\n  submitUsernameAndPassword: UseLoginReturn['submitUsernameAndPassword']\n  submitOneTimePassword: UseLoginReturn['submitOneTimePassword']\n  errorMessage: UseLoginReturn['errorMessage']\n  isLoading: UseLoginReturn['isLoading']\n}\n\nexport default function LoginForm(props: Props) {\n  const {\n    ssoRedirectUrl,\n    registerAccountUrl = `${getEndpoint(\n      BackendDestinationEnum.PORTAL_ENDPOINT,\n    )}#!RegisterAccount:0`,\n    resetPasswordUrl,\n    onBeginOAuthSignIn,\n    onStepChange,\n    step,\n    submitUsernameAndPassword,\n    submitOneTimePassword,\n    errorMessage,\n    isLoading,\n  } = props\n\n  return (\n    <>\n      {step == 'CHOOSE_AUTH_METHOD' && (\n        <AuthenticationMethodSelection\n          onSelectUsernameAndPassword={() => onStepChange('USERNAME_PASSWORD')}\n          onBeginOAuthSignIn={onBeginOAuthSignIn}\n          ssoRedirectUrl={ssoRedirectUrl}\n        />\n      )}\n      {step === 'USERNAME_PASSWORD' && (\n        <UsernamePasswordForm\n          isLoading={isLoading}\n          resetPasswordUrl={resetPasswordUrl}\n          onSubmit={(username, password) => {\n            submitUsernameAndPassword(username, password)\n          }}\n        />\n      )}\n      {step === 'VERIFICATION_CODE' && (\n        <>\n          <TOTPForm\n            isLoading={isLoading}\n            onSubmit={totp => {\n              submitOneTimePassword(totp, 'TOTP')\n            }}\n          />\n          <Link\n            align={'center'}\n            color={'grey.700'}\n            sx={{ display: 'block', mx: 'auto' }}\n            onClick={() => onStepChange('RECOVERY_CODE')}\n          >\n            Use a backup code instead\n          </Link>\n        </>\n      )}\n      {step === 'RECOVERY_CODE' && (\n        <RecoveryCodeForm\n          isLoading={isLoading}\n          onSubmit={recoveryCode => {\n            submitOneTimePassword(recoveryCode, 'RECOVERY_CODE')\n          }}\n        />\n      )}\n      {(step === 'CHOOSE_AUTH_METHOD' || step === 'USERNAME_PASSWORD') && (\n        <Box sx={{ display: 'flex', justifyContent: 'center', mt: '10px' }}>\n          <Link href={registerAccountUrl} align={'center'}>\n            Don&apos;t have an account? Create one now\n          </Link>\n        </Box>\n      )}\n      {errorMessage && (\n        <FullWidthAlert\n          variant={'warning'}\n          isGlobal={false}\n          description={errorMessage}\n        />\n      )}\n    </>\n  )\n}\n","import { IconButton, SxProps } from '@mui/material'\nimport IconSvg from '../IconSvg'\nimport React from 'react'\nimport { UseLoginReturn } from '../../utils/hooks'\nimport { LOGIN_BACK_BUTTON_CLASS_NAME } from '../../utils/SynapseConstants'\n\ntype LoginFormBackButtonProps = {\n  step: UseLoginReturn['step']\n  onStepChange: (step: UseLoginReturn['step']) => void\n  sx?: SxProps\n}\n\nfunction getPreviousStep(currentStep: UseLoginReturn['step']) {\n  switch (currentStep) {\n    case 'CHOOSE_AUTH_METHOD':\n      // Should never happen\n      return 'CHOOSE_AUTH_METHOD'\n    case 'USERNAME_PASSWORD':\n      return 'CHOOSE_AUTH_METHOD'\n    case 'VERIFICATION_CODE':\n      // Could have reached this step from either username + password or OAuth sign in, so go back to the beginning\n      return 'CHOOSE_AUTH_METHOD'\n    case 'RECOVERY_CODE':\n      return 'VERIFICATION_CODE'\n    case 'LOGGED_IN':\n      // Should never happen\n      return 'LOGGED_IN'\n  }\n}\n\nexport default function LoginFlowBackButton(props: LoginFormBackButtonProps) {\n  const { step, onStepChange, sx } = props\n  const shouldRender =\n    step === 'USERNAME_PASSWORD' ||\n    step === 'VERIFICATION_CODE' ||\n    step === 'RECOVERY_CODE'\n\n  if (!shouldRender) {\n    return null\n  }\n  return (\n    <IconButton\n      className={LOGIN_BACK_BUTTON_CLASS_NAME}\n      type=\"button\"\n      onClick={() => {\n        onStepChange(getPreviousStep(step))\n      }}\n      sx={sx}\n    >\n      <IconSvg\n        icon=\"arrowBack\"\n        wrap={false}\n        sx={{ height: '24px', width: '24px' }}\n      />\n    </IconButton>\n  )\n}\n"],"names":["useLogin","sessionCallback","twoFaErrorResponse","step","setStep","useState","errorMessage","setErrorMessage","userId","setUserId","twoFaToken","setTwoFaToken","useEffect","fullUrl","searchParams","finishLogin","loginResponse","SynapseClient.setAccessTokenCookie","AUTHENTICATION_RECEIPT_LOCALSTORAGE_KEY","mutateLoginWithUsernameAndPassword","isLoadingLoginWithUsernameAndPassword","useMutation","username","password","authenticationReceipt","SynapseClient.login","error","mutateLoginWith2FACode","isLoadingLoginWith2FACode","SynapseClient.loginWith2fa","e","code","otpType","z","W","q","G","H","n","C","I","J","Q","l","a","i","w","B","U","f","d","p","h","g","X","Z","T","P","R","S","k","M","E","c","r","m","D","N","t","x","_b","_a","u","y","K","V","s","b","j","$","Y","A","O","_","v","F","L","TOTP_LENGTH","DIGIT_CHARACTERS","TOTPForm","props","onSubmit","isLoading","verificationCode","setVerificationCode","React","jsxs","Box","jsx","MuiOtpInput","character","Button","UsernamePasswordForm","resetPasswordUrl","getEndpoint","BackendDestinationEnum","setUsername","setPassword","handleLogin","TextField","Link","RECOVERY_CODE_LENGTH","RecoveryCodeForm","recoveryCode","setRecoveryCode","valueWithAllowedChars","LoginForm","ssoRedirectUrl","registerAccountUrl","onBeginOAuthSignIn","onStepChange","submitUsernameAndPassword","submitOneTimePassword","Fragment","AuthenticationMethodSelection","totp","FullWidthAlert","getPreviousStep","currentStep","LoginFlowBackButton","sx","IconButton","LOGIN_BACK_BUTTON_CLASS_NAME","IconSvg"],"mappings":"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","x_google_ignoreList":[1]}