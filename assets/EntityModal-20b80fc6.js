import{j as e,a as n,F as R}from"./jsx-runtime-9dc53467.js";import{r as f}from"./index-76fb7be0.js";import{m as H,b3 as W,V as b,t as M,b4 as J,b5 as Z,b6 as z,$ as Q}from"./SynapseClient-d7905674.js";import{g as O,B as D}from"./getEndpoint-ac94413e.js";import{u as k,c as X}from"./SynapseTableCell-32a25a85.js";import{d as Y}from"./ToastMessage-19949884.js";import{u as ee,a as te,S as ae}from"./SchemaDrivenAnnotationEditor-8bc5e640.js";import"./OrientationBanner-1bd00e8c.js";import{d as ne}from"./useEntity-87581b86.js";import"./SkeletonButton-9ffd30ff.js";import{S as oe}from"./SkeletonTable-aa2cf667.js";import{d as N}from"./dayjs.min-f79c4412.js";import{F as ie}from"./FullWidthAlert-a8fd2235.js";import{f as E}from"./DateFormatter-5757df8d.js";import{g as se,u as le,a as re}from"./useUploadDestination-417e5185.js";import{a as V}from"./UserBadge-351024be.js";import{B as w}from"./Button-8ea9f590.js";import{S as de}from"./Skeleton-5f112c28.js";import{T as ce}from"./Tooltip-72ca093b.js";function me(a){if(!/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/.test(a))return!1;const i=new Date(a);return i instanceof Date&&!isNaN(i.getTime())&&i.toISOString()===a}function C(a){return typeof a=="number"||typeof a=="boolean"?a.toString():me(a)?E(N(a)):a}function S(a){const{entityId:i}=a,[t,y]=f.useState(!1),{isInExperimentalMode:m}=H(),{entityMetadata:l,annotations:r,isLoading:h,refetch:s}=ne(i,!0),{data:_}=ee(i,{enabled:m}),{data:d,refetch:u}=te(i,{enabled:m&&!!_}),p=m&&!!_,T=!!l&&!!d&&N(l.modifiedOn).diff(N(d.validatedOn))>0,o=f.useCallback(async()=>{y(!0);const c=[s(),u()];await Promise.allSettled(c),y(!1)},[s,u]);return h||t?e(oe,{numRows:3,numCols:2}):n(R,{children:[l&&r&&W(r)?n("div",{className:"placeholder",children:["This"," ",b(M(l.concreteType))," ","has no annotations."]}):null,e("table",{className:"AnnotationsTable",children:n("tbody",{children:[r&&Object.keys(r).map(c=>n("tr",{className:"AnnotationsTable__Row",children:[e("td",{className:"AnnotationsTable__Row__Key",children:c}),e("td",{className:"AnnotationsTable__Row__Value",children:Array.isArray(r[c])?r[c].map(C).join(", "):C(r[c])})]},c)),p?n("tr",{className:"AnnotationsTable__Row",children:[e("td",{className:"AnnotationsTable__Row__Key Schema",children:"Validation Schema"}),e("td",{className:"AnnotationsTable__Row__Value",children:e("a",{href:`${O(D.REPO_ENDPOINT)}/repo/v1/schema/type/registered/${_.jsonSchemaVersionInfo.$id}`,target:"_blank",rel:"noopener noreferrer",children:_.jsonSchemaVersionInfo.schemaName})})]}):null]})}),l&&p&&T&&e(ie,{variant:"warning",description:`This ${b(M(l.concreteType))} has changed since it has been last validated. If this ${b(M(l.concreteType))} is expected to have annotations derived from the Validation Schema, they may not yet be visible.`,primaryButtonConfig:{text:"Reload Annotations",onClick:()=>{o()}},isGlobal:!1})]})}try{S.displayName="AnnotationsTable",S.__docgenInfo={description:"",displayName:"AnnotationsTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const I=({entityId:a,versionNumber:i})=>{var _,d,u,p,T,o,c;const{data:t}=k(a,i),y=t&&J(t.entity),m=t?se(t):void 0,l=(_=t==null?void 0:t.entity)==null?void 0:_.parentId,r=m==null?void 0:m.storageLocationId,{data:h}=le(l,r,{enabled:l!==void 0&&r!=null});let s;return m&&(s=re(m,h)),t?e("table",{className:"MetadataTable",children:n("tbody",{children:[n("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Name"}),e("td",{className:"MetadataTable__Row__Value",children:(d=t.entity)==null?void 0:d.name})]}),n("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Type"}),e("td",{className:"MetadataTable__Row__Value",children:b(t.entityType)})]}),n("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Synapse ID"}),e("td",{className:"MetadataTable__Row__Value",children:(u=t.entity)==null?void 0:u.id})]}),y&&n("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Version"}),e("td",{className:"MetadataTable__Row__Value",children:Z(t.entity)})]}),s&&n("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Storage"}),e("td",{className:"MetadataTable__Row__Value",children:s})]}),n("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:" Last Modified By"}),n("td",{className:"MetadataTable__Row__Value",children:[e(V,{userId:(p=t.entity)==null?void 0:p.modifiedBy})," at"," ",E(N((T=t.entity)==null?void 0:T.modifiedOn))]})]}),n("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Created By"}),n("td",{className:"MetadataTable__Row__Value",children:[e(V,{userId:(o=t.entity)==null?void 0:o.createdBy})," at"," ",E(N((c=t.entity)==null?void 0:c.createdOn))]})]})]})}):null};try{I.displayName="MetadataTable",I.__docgenInfo={description:"",displayName:"MetadataTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const ue=["METADATA","ANNOTATIONS"];function B(a){const{entityId:i,versionNumber:t,show:y,onClose:m,initialTab:l="METADATA",showTabs:r=!0}=a,h=f.useRef(null),[s,_]=f.useState(l),[d,u]=f.useState(!1),[p,T]=f.useState(!1),{data:o}=k(i,t),c=o&&o.permissions.canEdit,g=o&&z(o.entityType),v=g&&o.entity.isLatestVersion,q=s==="METADATA"&&o&&!window.location.href.includes(i),L=n(w,{variant:"contained",onClick:()=>window.open(`${O(D.PORTAL_ENDPOINT)}#!Synapse:${i}`,"_blank","noopener"),children:["Open"," ",o?b(o==null?void 0:o.entityType):""]}),x=s==="ANNOTATIONS"&&d,K=e(w,{variant:"contained",onClick:()=>{h.current.formElement.current.requestSubmit()},children:"Save Annotations"}),j=s==="ANNOTATIONS"&&d,P=e(w,{variant:"outlined",onClick:()=>{p&&u(!1),T(!p)},children:p?"Are you sure? Unsaved changes will be lost":"Cancel"}),$=c&&s==="ANNOTATIONS"&&!d,F=e(ce,{title:g&&!v?"Annotations can only be edited on the latest version":void 0,children:e(w,{variant:"contained",disabled:g&&!v,onClick:()=>{u(!0)},children:"Edit"})}),G=n(R,{children:[r&&!d?e("div",{className:"Tabs",children:ue.map(A=>e("div",{className:"Tab",role:"tab",onClick:U=>{U.stopPropagation(),_(A)},"aria-selected":A===s,children:A},A))}):null,e("div",{style:s==="ANNOTATIONS"?{}:{display:"none"},children:d?e(Q,{children:e(ae,{entityId:i,formRef:h,onSuccess:()=>{Y("Annotations successfully updated.","success"),u(!1)},onCancel:()=>u(!1)})}):e(S,{entityId:i,versionNumber:t})}),e("div",{style:s==="METADATA"?{}:{display:"none"},children:e(I,{entityId:i,versionNumber:t})})]});return e(X,{className:"EntityMetadata",open:y,onCancel:m,maxWidth:d?"md":"sm",title:o?o.entity.name:e(de,{width:"40%"}),content:G,actions:n(R,{children:[j&&P,x&&K,$&&F,q&&L]})})}try{B.displayName="EntityModal",B.__docgenInfo={description:"",displayName:"EntityModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},initialTab:{defaultValue:null,description:"",name:"initialTab",required:!1,type:{name:"enum",value:[{value:'"METADATA"'},{value:'"ANNOTATIONS"'}]}},showTabs:{defaultValue:null,description:"",name:"showTabs",required:!1,type:{name:"boolean"}}}}}catch{}export{B as E};
//# sourceMappingURL=EntityModal-20b80fc6.js.map
