import{j as w}from"./jsx-runtime-095bf462.js";import{r as i,R as O}from"./index-8db94870.js";import{u as b,S as R,d as y}from"./Select-ce3716e1.esm-8435c103.js";import{_ as T}from"./emotion-use-insertion-effect-with-fallbacks.browser.esm-4abd396b.js";import"./index-8ce4a492.js";import{u as v,bx as N,by as k,bz as F}from"./SynapseClient-773213a5.js";import"./OrientationBanner-3e5e2da7.js";import"./getEndpoint-ac94413e.js";import{a as A}from"./use-deep-compare-effect.esm-7a830988.js";import{V as H,r as x,s as L,t as D}from"./SynapseConstants-76f49806.js";import{u as C,c as G}from"./uniq-538169c7.js";import{w as P}from"./without-34cd7bc5.js";import{u as q,U as _}from"./UserOrTeamBadge-f95e6103.js";import{S as B}from"./Skeleton-a24326d8.js";const Y=(t,e,n)=>{i.useEffect(()=>{const o=setTimeout(()=>t(),n);return()=>clearTimeout(o)},[...e||[],n])},M={ownerId:"",firstName:"Unknown",lastName:"Unknown",userName:"Unknown",isIndividual:!1},K={name:"Unknown",id:"unknown",type:"org.sagebionetworks.repo.model.FileEntity",versionNumber:0,versionLabel:"placeholder",benefactorId:0,createdOn:"null",modifiedOn:"null",createdBy:"null",modifiedBy:"null",isLatestVersion:!0},j={id:"unknown",etag:"Unknown",name:"Unknown",description:"Unknown",ownerId:"null",createdOn:"null",contentSource:"Unknown",submissionInstructionsMessage:"Unknown",submissionReceiptMessage:"Unknown"},$=async(t,e)=>{const n=await N(t,e),r=t.filter(s=>n.results.map(c=>c.id).indexOf(s.targetId)===-1).map(s=>({...K,id:s.targetId,name:`${s.targetId}`}));return[...n.results,...r]},J=async t=>{const e=(await k(t)).children,o=t.filter(r=>e.map(s=>s.ownerId).indexOf(r)===-1).map(r=>({...M,ownerId:r,name:`Unknown User (${r})`}));return[...e,...o]},z=async(t,e)=>{const n=await F(t,e),r=t.filter(s=>n.results.map(c=>c.id).indexOf(s)===-1).map(s=>({...j,id:s,name:s}));return[...n.results,...r]};function Q(t){const{ids:e,type:n}=t,{accessToken:o}=v(),[r,s]=i.useState([]),c=n==="USER_PROFILE"?"ownerId":"id",I=(l=>{switch(l){case"USER_PROFILE":return D;case"ENTITY_HEADER":return L;case"EVALUATION_QUEUE":return x;default:return""}})(n),g=r.map(l=>l[c]),h=e.filter(l=>l!==H),S=C(P(h,...g));return i.useEffect(()=>{(p=>{if(!p.length)return;const d=sessionStorage.getItem(I);try{const u=d?JSON.parse(d):[],E=u.map(f=>f[c]);for(const f of p)E.includes(f[c])||u.push(f);sessionStorage.setItem(I,JSON.stringify(u))}catch{sessionStorage.setItem(I,JSON.stringify(p))}})(r)},[r,c,I]),A(()=>{let l=!1;return(async()=>{if(S.length>0)try{const d=Array.from(S),u=n==="ENTITY_HEADER"?d.map(m=>({targetId:m})):d,E=G(u,45),f=[];for(const m of E){let a=[];switch(n){case"USER_PROFILE":a=await J(m);break;case"ENTITY_HEADER":a=await $(m,o);break;case"EVALUATION_QUEUE":a=await z(m,o);break}f.push(...a)}l||s(m=>m.concat(...f))}catch(d){console.error("Error on data retrieval",d)}})(),()=>{l=!0}},[o,n,S]),r}var W=i.forwardRef(function(t,e){var n=b(t);return i.createElement(R,T({ref:e},n))}),X=W;const Z={Control:t=>w(y.Control,{...t,className:`form-control ${t.className??""}`}),SingleValue:t=>{const{data:e}=t;return i.createElement(y.SingleValue,{...t,key:e==null?void 0:e.id},w(_,{userGroupHeader:e==null?void 0:e.header,disableHref:!0,showFullName:!0},e==null?void 0:e.header.ownerId))},Option:t=>{const{data:e}=t;return i.createElement(y.Option,{...t,key:e==null?void 0:e.id},w(_,{userGroupHeader:e==null?void 0:e.header,disableHref:!0,showFullName:!0,showCardOnHover:!1}))}},V=t=>{const{inputId:e,defaultValue:n=null,onChange:o,filterPredicate:r,typeFilter:s,placeholder:c,focusOnSelect:U=!1,value:I}=t,[g,h]=i.useState(""),[S,l]=i.useState("");Y(()=>{l(g)},[g],500);const[p=void 0]=Q({ids:n?[n]:[],type:"USER_PROFILE"}),{data:d,isLoading:u}=q(S,s),E=O.useRef(null);O.useEffect(()=>{U&&E.current&&E.current.focus()});const f=i.useMemo(()=>u||g!==S?()=>"Loadingâ€¦":void 0,[u,S,g]),m=(d??[]).filter(r??(()=>!0)).map(a=>({id:a.ownerId.toString(),value:a.ownerId.toString(),label:a.userName,header:a}));return n&&p==null?w(B,{width:"100%"}):w(X,{className:"bootstrap-4-backport UserSearchBoxV2",ref:E,inputValue:g,onInputChange:h,filterOption:()=>!0,isLoading:u,options:!u&&m||[],noOptionsMessage:f,defaultValue:n?{id:n,value:n,label:p.userName,header:p}:void 0,inputId:e,isClearable:!0,value:I,styles:{control:a=>({...a,display:"flex !important"}),input:a=>({...a,input:{gridArea:"1 / 2 / 4 / 4 !important"}}),menu:a=>({...a,zIndex:2})},components:Z,onChange:a=>{o&&o((a==null?void 0:a.id)??null,(a==null?void 0:a.header)??null)},placeholder:c})};try{V.displayName="UserSearchBoxV2",V.__docgenInfo={description:"",displayName:"UserSearchBoxV2",props:{inputId:{defaultValue:null,description:"",name:"inputId",required:!1,type:{name:"string"}},defaultValue:{defaultValue:null,description:"",name:"defaultValue",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((principalId: string | null, header: UserGroupHeader | null) => void)"}},typeFilter:{defaultValue:null,description:"",name:"typeFilter",required:!1,type:{name:"enum",value:[{value:'"USERS_ONLY"'},{value:'"TEAMS_ONLY"'},{value:'"ALL"'}]}},filterPredicate:{defaultValue:null,description:"",name:"filterPredicate",required:!1,type:{name:"((item: UserGroupHeader) => boolean)"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},focusOnSelect:{defaultValue:null,description:"",name:"focusOnSelect",required:!1,type:{name:"boolean"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"PropsValue<UserSearchBoxValueType>"}}}}}catch{}export{X as S,V as U,Q as a,Y as u};
//# sourceMappingURL=UserSearchBoxV2-0062ccaa.js.map
