{"version":3,"file":"StorybookComponentWrapper-4af58ba4.js","sources":["../../../../node_modules/.pnpm/react-query@3.39.3_react-dom@18.2.0_react@18.2.0/node_modules/react-query/devtools/index.js","../../src/components/StorybookComponentWrapper.tsx"],"sourcesContent":["if (process.env.NODE_ENV !== 'development') {\n  module.exports = {\n    ReactQueryDevtools: function () {\n      return null\n    },\n    ReactQueryDevtoolsPanel: function () {\n      return null\n    },\n  }\n} else {\n  module.exports = require('./development')\n}\n","import React, { useEffect, useMemo } from 'react'\nimport { MemoryRouter } from 'react-router-dom'\nimport {\n  SynapseContextProvider,\n  SynapseContextType,\n} from '../utils/context/SynapseContext'\nimport { QueryClient, QueryClientProvider } from 'react-query'\nimport SynapseClient from '../synapse-client'\nimport { SynapseToastContainer } from './ToastMessage/ToastMessage'\nimport { ReactQueryDevtools } from 'react-query/devtools'\nimport dayjs from 'dayjs'\nimport {\n  getAccessTokenFromCookie,\n  getAuthenticatedOn,\n  getUserProfile,\n  signOut,\n} from '../synapse-client/SynapseClient'\nimport { SynapseClientError } from '../utils/SynapseClientError'\nimport { STACK_MAP, SynapseStack } from '../utils/functions/getEndpoint'\nimport useDetectSSOCode from '../utils/hooks/useDetectSSOCode'\nimport { defaultQueryClientConfig } from '../utils/context/FullContextProvider'\n\nexport async function sessionChangeHandler() {\n  let accessToken: string | undefined = await getAccessTokenFromCookie()\n  let profile\n  try {\n    profile = await getUserProfile(accessToken)\n  } catch (err) {\n    if (err instanceof SynapseClientError && err.status === 401) {\n      console.error(\n        'Encountered error fetching profile: ',\n        err,\n        'Signing out...',\n      )\n      await signOut()\n      accessToken = undefined\n    }\n    // Otherwise rethrow\n    throw err\n  }\n  let date\n  if (accessToken) {\n    getAuthenticatedOn(accessToken).then(authenticatedOn => {\n      date = dayjs(authenticatedOn.authenticatedOn).format('L LT')\n    })\n  }\n  return { accessToken, profile, authenticatedOn: date }\n}\n\nconst storybookQueryClient = new QueryClient(defaultQueryClientConfig)\n\nfunction overrideEndpoint(stack: SynapseStack) {\n  const endpointConfig = STACK_MAP[stack]\n  ;(window as any)['SRC'] = {\n    OVERRIDE_ENDPOINT_CONFIG: endpointConfig,\n  }\n  storybookQueryClient.resetQueries()\n}\n\n/**\n * Wraps storybook story components to ensure that all components receive required context.\n * @param props\n * @returns\n */\nexport function StorybookComponentWrapper(props: {\n  children: React.ReactNode\n  /* This will match the `globalTypes` object in preview.tsx. */\n  storybookContext: {\n    globals: {\n      stack?: SynapseStack\n      showReactQueryDevtools?: boolean\n    }\n    parameters: {\n      stack?: SynapseStack\n    }\n  }\n}) {\n  const { storybookContext } = props\n\n  useEffect(() => {\n    overrideEndpoint(\n      (storybookContext.globals.stack as SynapseStack) ||\n        (storybookContext.parameters.stack as SynapseStack),\n    )\n  }, [storybookContext.globals.stack])\n\n  const [accessToken, setAccessToken] = React.useState<string | undefined>(\n    undefined,\n  )\n\n  useDetectSSOCode()\n\n  useEffect(() => {\n    sessionChangeHandler().then(data => {\n      setAccessToken(data.accessToken)\n    })\n  })\n\n  useEffect(() => {\n    async function resetCache() {\n      await storybookQueryClient.cancelQueries()\n      storybookQueryClient.removeQueries()\n      await storybookQueryClient.invalidateQueries()\n    }\n\n    resetCache()\n  }, [accessToken])\n\n  const synapseContext: Partial<SynapseContextType> = useMemo(\n    () => ({\n      accessToken: accessToken,\n      isInExperimentalMode: SynapseClient.isInSynapseExperimentalMode(),\n      utcTime: SynapseClient.getUseUtcTimeFromCookie(),\n      withErrorBoundary: true,\n      downloadCartPageUrl: '/?path=/story/download-downloadcartpage--demo',\n    }),\n    [accessToken],\n  )\n\n  return (\n    <QueryClientProvider client={storybookQueryClient}>\n      <SynapseContextProvider synapseContext={synapseContext}>\n        {storybookContext.globals.showReactQueryDevtools && (\n          <ReactQueryDevtools />\n        )}\n        <MemoryRouter>\n          <SynapseToastContainer />\n          <main>{props.children}</main>\n        </MemoryRouter>\n      </SynapseContextProvider>\n    </QueryClientProvider>\n  )\n}\n\nexport default StorybookComponentWrapper\n"],"names":["devtoolsModule","sessionChangeHandler","accessToken","getAccessTokenFromCookie","profile","getUserProfile","err","SynapseClientError","signOut","date","getAuthenticatedOn","authenticatedOn","dayjs","storybookQueryClient","QueryClient","defaultQueryClientConfig","overrideEndpoint","stack","endpointConfig","STACK_MAP","StorybookComponentWrapper","props","storybookContext","useEffect","setAccessToken","React","useDetectSSOCode","data","resetCache","synapseContext","useMemo","SynapseClient","jsx","QueryClientProvider","jsxs","SynapseContextProvider","ReactQueryDevtools","MemoryRouter","SynapseToastContainer"],"mappings":"sYACEA,UAAiB,CACf,mBAAoB,UAAY,CAC9B,OAAO,IACR,EACD,wBAAyB,UAAY,CACnC,OAAO,IACR,CACF,kBCcH,eAAAC,GAAA,CACE,IAAAC,EAAA,MAAAC,IACAC,EACA,GAAA,CACEA,EAAA,MAAAC,EAAAH,CAAA,CAA0C,OAAAI,EAAA,CAE1C,MAAAA,aAAAC,GAAAD,EAAA,SAAA,MACE,QAAA,MAAQ,uCACNA,EACA,gBACA,EAEF,MAAAE,EAAA,EACAN,EAAA,QAGFI,CAAM,CAER,IAAAG,EACA,OAAAP,GACEQ,EAAAR,CAAA,EAAA,KAAAS,GAAA,CACEF,EAAAG,EAAAD,EAAA,eAAA,EAAA,OAAA,MAAA,CAA2D,CAAA,EAG/D,CAAA,YAAAT,EAAA,QAAAE,EAAA,gBAAAK,CAAA,CACF,CAEA,MAAAI,EAAA,IAAAC,EAAAC,CAAA,EAEA,SAAAC,EAAAC,EAAA,CACE,MAAAC,EAAAC,EAAAF,CAAA,EACC,OAAA,IAAA,CAAyB,yBAAAC,CACE,EAE5BL,EAAA,aAAA,CACF,CAOO,SAAAO,EAAAC,EAAA,CAaL,KAAA,CAAA,iBAAAC,CAAA,EAAAD,EAEAE,EAAAA,UAAA,IAAA,CACEP,EAAAM,EAAA,QAAA,OAAAA,EAAA,WAAA,KAEiC,CACjC,EAAA,CAAAA,EAAA,QAAA,KAAA,CAAA,EAGF,KAAA,CAAApB,EAAAsB,CAAA,EAAAC,EAAA,SAA4C,MAC1C,EAGFC,IAEAH,EAAAA,UAAA,IAAA,CACEtB,EAAA,EAAA,KAAA0B,GAAA,CACEH,EAAAG,EAAA,WAAA,CAA+B,CAAA,CAChC,CAAA,EAGHJ,EAAAA,UAAA,IAAA,CACE,eAAAK,GAAA,CACE,MAAAf,EAAA,gBACAA,EAAA,cAAA,EACA,MAAAA,EAAA,mBAA6C,CAG/Ce,GAAW,EAAA,CAAA1B,CAAA,CAAA,EAGb,MAAA2B,EAAAC,EAAA,QAAoD,KAAA,CAC3C,YAAA5B,EACL,qBAAA6B,EAAA,4BAAA,EACgE,QAAAA,EAAA,wBAAA,EACjB,kBAAA,GAC5B,oBAAA,+CACE,GACvB,CAAA7B,CAAA,CACY,EAGd,OAAA8B,EAAAC,EAAA,CAAA,OAAApB,EAAA,SAAAqB,EAAAC,EAAA,CAAA,eAAAN,EAAA,SAAA,CAGOP,EAAA,QAAA,wBAAAU,EAAAI,EAAAA,mBAAA,CAAA,CAAA,EACqBF,EAAAG,EAAA,CAAA,SAAA,CAGpBL,EAAAM,EAAA,EAAA,EAAuBN,EAAA,OAAA,CAAA,SAAAX,EAAA,QAAA,CAAA,CACD,EAAA,CACxB,CAAA,CAAA,CAAA,CAAA,CAIR","x_google_ignoreList":[0]}