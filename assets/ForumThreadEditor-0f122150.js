import{j as i,F as q,a as b}from"./jsx-runtime-095bf462.js";import{r as m}from"./index-8db94870.js";import{c as B,d as P,e as $}from"./useThread-612e961f.js";import{u as k,a as v,l as j,h as V,ao as O,cd as G,ce as Q}from"./SynapseClient-a57981a2.js";import{u as L}from"./useMutation-4912c071.js";import{u as Y}from"./useInfiniteQuery-e2e29633.js";import{I as W}from"./IconSvg-5d52c249.js";import{W as z,a9 as H,a as J,V as X}from"./ConfirmationDialog-fbfc50bb.js";import{U as Z}from"./UserSearchBoxV2-af5e8525.js";import{s as ee}from"./startCase-a4470715.js";import{B as te}from"./Box-653de305.js";import{b as ae}from"./Form-3a0caad7.js";function Se(e,s,o,n,t,r){const{accessToken:c,keyFactory:h}=k();return Y(h.getRepliesQueryKey(e,s,o,n,t),async d=>v.getReplies(c,e,o,d.pageParam,n,s,t),{...r,getNextPageParam:(d,w)=>{const g=w.flatMap(u=>u.results).length;if(d.totalNumberOfResults>g)return g}})}function Ce(e,s){const{accessToken:o,keyFactory:n}=k(),t=async()=>{const r=await v.getReplyMessageUrl(e.messageKey,o);return(await fetch(r.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return j(n.getReplyQueryKey(e.threadId,e.id,e.messageKey),t,s)}function se(e){const s=V(),{accessToken:o,keyFactory:n}=k();return L(t=>v.postReply(t,o),{...e,onSuccess:async(t,r,c)=>{await s.invalidateQueries(n.getAllRepliesQueryKey(t.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,r,c)}})}function ne(e){const s=V(),{accessToken:o,keyFactory:n}=k();return L(t=>v.putReply(t,o),{...e,onSuccess:async(t,r,c)=>{await s.invalidateQueries(n.getAllRepliesQueryKey(t.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,r,c)}})}function Me(e){const s=V(),{accessToken:o,keyFactory:n}=k();return L(t=>v.deleteReply(o,t.replyId),{...e,onSuccess:async(t,r,c)=>{await s.invalidateQueries(n.getAllRepliesQueryKey(r.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,r,c)}})}const F=({show:e,onClose:s,handleUserTag:o})=>{const n=m.useCallback((t,r)=>{t&&r&&o(r.userName),s()},[s,o]);return i(q,{children:i(z,{open:e,onCancel:s,title:"Find User or Team",content:i(Z,{placeholder:"Search for a user or team name",onChange:n,typeFilter:O.ALL,focusOnSelect:!0}),sx:{".MuiDialog-paperFullWidth":{overflowY:"visible",".MuiDialogContent-root":{overflowY:"visible"}}}})})};try{F.displayName="UserMentionModal",F.__docgenInfo={description:"",displayName:"UserMentionModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},handleUserTag:{defaultValue:null,description:"",name:"handleUserTag",required:!0,type:{name:"(user: string) => void"}}}}}catch{}const re=["WRITE","PREVIEW"],N=({placeholder:e,text:s,setText:o})=>{const[n,t]=m.useState("WRITE"),[r,c]=m.useState(0),[h,d]=m.useState(!1),[w,g]=m.useState(!1),u=m.useRef(null);m.useEffect(()=>{const a=u.current;a&&a.setSelectionRange(r,r)},[u,r]),m.useEffect(()=>{var a;(a=u.current)==null||a.focus()},[h]);const x=a=>{const l=[],p=u.current;if(p){const f=p==null?void 0:p.selectionStart,T=s.substring(0,f),S=s.substring(f,s.length);c(f+a.length),l.push(T,`${w?"":"@"}${a.replace(/\s/g,"")}`,S)}o(l.join("")),g(!1)},E=a=>{const l=u.current&&u.current.selectionStart;l&&l>0&&a.charAt(l-1)==="@"&&(g(!0),d(!0))},I=a=>{const l=u.current;if(l){const p=l.selectionStart,f=l.selectionEnd,T=s.substring(p,f),S=s.substring(0,p),_=s.substring(f,s.length),C=Q[a].openSyntax,R=Q[a].closeSyntax;switch(a){case"code":{const y=[];y.push(S,C,T,R,_),o(y.join(`\r
`)),l.focus(),c(p+C.length+2);break}case"title":case"bold":case"italic":case"strikethrough":case"latex":case"subscript":case"superscript":case"link":case"image":{const y=`${S}${C}${T}${R}${_}`;l.focus(),c(p+C.length),o(y)}}}};return b("div",{className:"bootstrap-4-backport MarkdownEditor",children:[b("div",{className:"MarkdownEditorControls",children:[i("div",{className:"Tabs",children:re.map(a=>i("button",{className:"Tab",role:"tab","aria-selected":a===n,onClick:l=>{l.stopPropagation(),t(a)},children:a},a))}),n==="WRITE"&&b("div",{className:"MarkdownEditorControlsToolbar",children:[G.map(a=>i("button",{onClick:()=>I(a),children:i(W,{icon:a,label:ee(a)})},a)),i("button",{onClick:()=>d(!0),children:i(W,{icon:"tag",label:"Mention"})})]})]}),i("div",{children:n==="WRITE"?i("textarea",{onChange:a=>{o(a.target.value),E(a.target.value)},style:{width:"100%"},rows:6,value:s,ref:u,placeholder:e}):s?i(H,{markdown:s}):"Nothing to preview"}),i(F,{show:h,onClose:()=>d(!1),handleUserTag:x})]})};try{N.displayName="MarkdownEditor",N.__docgenInfo={description:"",displayName:"MarkdownEditor",props:{placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}},setText:{defaultValue:null,description:"",name:"setText",required:!0,type:{name:"(text: string) => void"}}}}}catch{}const K=e=>{const{initialText:s,initialTitle:o,id:n,onClose:t,isReply:r,isDialog:c,openDialog:h}=e,[d,w]=m.useState(o??""),[g,u]=m.useState(s??""),{mutate:x,isLoading:E}=B({onSuccess:()=>t()}),{mutate:I,isLoading:a}=P({onSuccess:()=>t()}),{mutate:l,isLoading:p}=$({onSuccess:()=>t()}),{mutate:f,isLoading:T}=se({onSuccess:()=>t()}),{mutate:S,isLoading:_}=ne({onSuccess:()=>t()}),C=a||T||p||E||_,R=!r&&o,y=(M,D)=>{r?s?S({replyId:n,messageMarkdown:M}):f({threadId:n,messageMarkdown:M}):R?(x({title:D,threadId:n}),I({messageMarkdown:M,threadId:n})):l({forumId:n,title:D,messageMarkdown:M})},U=b("div",{className:"bootstrap-4-backport",children:[!r&&i(ae,{type:"text",placeholder:"Title",value:d,onChange:M=>w(M.target.value)}),i(N,{text:g,setText:u})]}),A=C?"Saving":"Save";return i(q,{children:c?i(J,{maxWidth:"md",open:h,onCancel:t,title:r?"Edit Reply":R?"Edit Thread":"New Thread",content:U,onConfirm:()=>y(g,d),confirmButtonText:A}):b(q,{children:[U,i(te,{display:"flex",justifyContent:"flex-end",children:i(X,{onCancel:t,onConfirm:()=>y(g,d),confirmButtonText:A})})]})})};try{K.displayName="ForumThreadEditor",K.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isReply:{defaultValue:null,description:"",name:"isReply",required:!0,type:{name:"boolean"}},isDialog:{defaultValue:null,description:"",name:"isDialog",required:!0,type:{name:"boolean"}},openDialog:{defaultValue:null,description:"",name:"openDialog",required:!1,type:{name:"boolean"}}}}}catch{}export{K as F,Me as a,Se as b,Ce as u};
//# sourceMappingURL=ForumThreadEditor-0f122150.js.map
