import{j as a,a as B,F as ie}from"./jsx-runtime-9dc53467.js";import{r as b}from"./index-76fb7be0.js";import{d as oe}from"./AddCircleTwoTone-b7ecfece.js";import{D as P,J as O,b as j}from"./index-01eb1463.js";import{N as L,V as R,A as se,B as de,f as ue,L as ce,g as me,h as C,i as pe,T as ye,M as fe,u as he,j as be}from"./useEntitySelection-9866fbaa.js";import"./OrientationBanner-a1ca5cdb.js";import"./getEndpoint-ac94413e.js";import{bk as ge,l as Se,h as Z,w as V,bh as $,bl as Ce,bm as Ve}from"./ApplicationSessionManager-9bd355c2.js";import{u as De,O as Ee,T as qe}from"./HelpPopover-f7b3f4de.js";import{C as we}from"./Checkbox-ed5f8a28.js";import{B as ve}from"./LoadingScreen-21cf5616.js";import{S as Ie}from"./Skeleton-131bd473.js";import{a as Te}from"./useDownloadList-28fa77c1.js";import{d as G}from"./ToastMessage-313b7aae.js";import{B as J}from"./Box-8faf86fd.js";import{B as Re}from"./Button-33299b2c.js";function W(t){const{data:s,isLoading:d}=De(t.rowData.entityId,t.rowData.versionNumber);if(d)return a(Ie,{width:200});const l=s==null?void 0:s.fileHandles.find(c=>c.isPreview!==!0),m=l!=null&&l.contentSize?ge(l==null?void 0:l.contentSize):"";return a("span",{children:m})}function H(t){return a(Ee,{entityId:t.rowData.entityId,entityVersionNumber:t.rowData.versionNumber,stopPropagation:!0})}try{W.displayName="SizeRenderer",W.__docgenInfo={description:"",displayName:"SizeRenderer",props:{cellData:{defaultValue:null,description:"",name:"cellData",required:!0,type:{name:"any"}},columns:{defaultValue:null,description:"",name:"columns",required:!0,type:{name:"ColumnShape<T>[]"}},column:{defaultValue:null,description:"",name:"column",required:!0,type:{name:"ColumnShape<T>"}},columnIndex:{defaultValue:null,description:"",name:"columnIndex",required:!0,type:{name:"number"}},rowData:{defaultValue:null,description:"",name:"rowData",required:!0,type:{name:"EntityIdAndVersionNumber"}},rowIndex:{defaultValue:null,description:"",name:"rowIndex",required:!0,type:{name:"number"}},container:{defaultValue:null,description:"",name:"container",required:!0,type:{name:"BaseTable<T>"}},isScrolling:{defaultValue:null,description:"",name:"isScrolling",required:!1,type:{name:"boolean"}}}}}catch{}try{H.displayName="DownloadRenderer",H.__docgenInfo={description:"",displayName:"DownloadRenderer",props:{cellData:{defaultValue:null,description:"",name:"cellData",required:!0,type:{name:"any"}},columns:{defaultValue:null,description:"",name:"columns",required:!0,type:{name:"ColumnShape<T>[]"}},column:{defaultValue:null,description:"",name:"column",required:!0,type:{name:"ColumnShape<T>"}},columnIndex:{defaultValue:null,description:"",name:"columnIndex",required:!0,type:{name:"number"}},rowData:{defaultValue:null,description:"",name:"rowData",required:!0,type:{name:"EntityIdAndVersionNumber"}},rowIndex:{defaultValue:null,description:"",name:"rowIndex",required:!0,type:{name:"number"}},container:{defaultValue:null,description:"",name:"container",required:!0,type:{name:"BaseTable<T>"}},isScrolling:{defaultValue:null,description:"",name:"isScrolling",required:!1,type:{name:"boolean"}}}}}catch{}const X=1200,_e=46,M=({entities:t,isLoading:s,hasNextPage:d,fetchNextPage:l,isFetchingNextPage:m,versionSelection:c,selectColumnType:D,selected:i,visibleTypes:y,selectableTypes:o,toggleSelection:p,sort:f,setSort:E,noResultsPlaceholder:N,enableSelectAll:v,selectAllIsChecked:g=!1,getChildrenInfiniteRequestObject:I,totalEntities:q,setCurrentContainer:A})=>{const x=Se(),{accessToken:K,keyFactory:k}=Z(),Y=D!=="none",[Q,F]=b.useState(!1),[ee,T]=b.useState(!1),te=()=>{I&&x.cancelQueries({queryKey:k.getEntityChildrenQueryKey(I,!0)}),T(!1),F(!1)},ne=r=>y.includes(V(r))?o.includes(V(r))?i.has(r.id)?"selected":"default":"disabled":"hidden";b.useEffect(()=>{async function r(){Q&&(d&&l?(T(!0),m||l()):(p(g?t.filter(e=>i.has(e.id)).map(e=>{const n=i.get(e.id);return{targetId:e.id,targetVersionNumber:n===L?void 0:n}}):await Promise.all(t.filter(e=>{const n=V(e);return!i.has(e.id)&&o.includes(n)&&y.includes(n)}).map(async e=>{var u;let n;if(c===R.REQUIRED&&$(V(e))&&(Object.prototype.hasOwnProperty.call(e,"versionNumber")&&(n=e.versionNumber),!n)){T(!0);const h=1,S=0;n=(u=(await x.fetchQuery({queryKey:k.getPaginatedEntityVersionsQueryKey(e.id,h,S),queryFn:()=>Ve(e.id,K,S,h)})).results[0])==null?void 0:u.versionNumber}return{targetId:e.id,targetVersionNumber:n}}))),F(!1),T(!1)))}r()},[K,t,l,d,c,x,m,g,o,i,Q,p,y,k]);const ae=t.reduce((r,e)=>{const n=ne(e);if(n!=="hidden"){const u=V(e),h=i.get(e.id);let S;"versionNumber"in e&&(h!=null&&h!==L?S=h:c===R.REQUIRED&&(S=e.versionNumber)),r.push({...e,entityId:e.id,versionNumber:S,entityType:u,isSelected:n==="selected",isDisabled:n==="disabled",isVersionableEntity:$(u),currentSelectedVersion:h})}return r},[]),le=b.useMemo(()=>{const r=d||t.filter(e=>o.includes(V(e))&&y.includes(V(e))).length>0;return v&&a("div",{"data-testid":"Select All",style:r?{cursor:"pointer"}:{cursor:"not-allowed"},onClick:()=>{r&&F(!0)},children:a(we,{label:"Select All",hideLabel:!0,className:"SRC-pointer-events-none",checked:g,disabled:!r,onChange:()=>{}})})},[v,t,d,g,o,y]),re=b.useCallback(r=>A&&Ce(r.rowData.entityType)?a("span",{role:"link",className:"EntityFinderTableCellContainerLink",onClick:e=>{e.stopPropagation(),A(r.rowData.id)},children:r.rowData.name}):r.rowData.name,[A]),U={};return f&&(U[f.sortBy]=f.sortDirection.toLowerCase()),B("div",{className:"EntityFinderDetailsView bootstrap-4-backport",children:[a(ve,{show:ee,currentProgress:t.length,totalProgress:q,hintText:q?`${t.length.toLocaleString()} of ${q==null?void 0:q.toLocaleString()}`:`Fetching ${t.length.toLocaleString()}`,headlineText:"Fetching selected items",onCancel:te}),a(se,{className:"DetailsViewAutosizer",children:({height:r,width:e})=>B(de,{classPrefix:"DetailsViewTable",data:ae,height:r,width:e>X?e:X,rowHeight:_e,overscanRowCount:5,rowClassName:({rowIndex:n})=>{let u="EntityFinderDetailsViewRow";return n%2===0&&(u+=" isEven"),u},rowProps:({rowData:n})=>({"aria-selected":n.isSelected,"aria-disabled":n.isDisabled}),headerCellProps:{role:"columnheader"},sortState:U,components:{SortIndicator:ue},onColumnSort:({key:n,order:u})=>{f&&E&&E(n,u==="asc"?P.ASC:P.DESC)},rowEventHandlers:{onClick:({rowData:n})=>{const{id:u,isDisabled:h,isVersionableEntity:S}=n;let{currentSelectedVersion:w}=n;h||(S&&c===R.REQUIRED&&w==null&&Object.prototype.hasOwnProperty.call(n,"versionNumber")&&(w=n.versionNumber),p({targetId:u,targetVersionNumber:w===L?void 0:w}))}},onEndReached:()=>{d&&l&&!m&&l()},emptyRenderer:s?ce:()=>a(me,{noResultsPlaceholder:N}),children:[Y&&a(C,{title:"",minWidth:50,maxWidth:50,width:50,dataKey:"isSelected",headerRenderer:le,cellRenderer:pe},"isSelected"),a(C,{title:"",minWidth:45,maxWidth:45,width:45,dataKey:"entityType",align:"center",cellRenderer:ye},"type"),a(C,{title:"File Name",width:500,sortable:f!=null,resizable:!0,cellRenderer:re},O.NAME),a(C,{title:"Size",width:200,sortable:!1,resizable:!0,cellRenderer:W},"SIZE"),a(C,{title:"Modified On",width:220,minWidth:170,sortable:f!=null,cellRenderer:fe},O.MODIFIED_ON),a(C,{width:130,dataKey:"id",title:"ID",minWidth:130},"id"),a(C,{title:"Actions",minWidth:100,maxWidth:100,width:100,cellRenderer:H},"actions")]})})]})};try{M.displayName="ChallengeDataTable",M.__docgenInfo={description:'Displays a list of entities in a table.\n\nIf the list of entities is paginated, the `hasNextPage` prop can be set to indicate that there is more data to load.\nWhen the view is ready to load more data, the `fetchNextPage` callback will be invoked. The view is designed to handle\nan "infinite scroll" pattern, so entities should not be removed from the list when loading the next page.',displayName:"ChallengeDataTable",props:{versionSelection:{defaultValue:null,description:"",name:"versionSelection",required:!0,type:{name:"enum",value:[{value:'"DISALLOWED"'},{value:'"REQUIRED"'},{value:'"TRACKED"'},{value:'"UNTRACKED"'}]}},selectColumnType:{defaultValue:null,description:"",name:"selectColumnType",required:!0,type:{name:"enum",value:[{value:'"none"'},{value:'"checkbox"'}]}},enableSelectAll:{defaultValue:null,description:"",name:"enableSelectAll",required:!0,type:{name:"boolean"}},visibleTypes:{defaultValue:null,description:"",name:"visibleTypes",required:!0,type:{name:"EntityType[]"}},selected:{defaultValue:null,description:"",name:"selected",required:!0,type:{name:"Map<string, number>"}},selectableTypes:{defaultValue:null,description:"",name:"selectableTypes",required:!0,type:{name:"EntityType[]"}},isIdSelected:{defaultValue:null,description:"",name:"isIdSelected",required:!0,type:{name:"(header: EntityFinderHeader) => boolean"}},isSelectable:{defaultValue:null,description:"",name:"isSelectable",required:!0,type:{name:"(header: EntityFinderHeader) => boolean"}},toggleSelection:{defaultValue:null,description:"",name:"toggleSelection",required:!0,type:{name:"(entity: Reference | Reference[]) => void"}},setCurrentContainer:{defaultValue:null,description:"",name:"setCurrentContainer",required:!1,type:{name:"Dispatch<SetStateAction<EntityTreeContainer>>"}},entities:{defaultValue:null,description:"",name:"entities",required:!0,type:{name:"EntityFinderHeader[]"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}},hasNextPage:{defaultValue:null,description:"",name:"hasNextPage",required:!1,type:{name:"boolean"}},fetchNextPage:{defaultValue:null,description:"",name:"fetchNextPage",required:!1,type:{name:"(() => Promise<any>)"}},isFetchingNextPage:{defaultValue:null,description:"",name:"isFetchingNextPage",required:!1,type:{name:"boolean"}},sort:{defaultValue:null,description:"The current sort of the view. If the view cannot be sorted, set this to `undefined`",name:"sort",required:!1,type:{name:"{ sortBy: SortBy; sortDirection: Direction; }"}},setSort:{defaultValue:null,description:"If sortable, `setSort` will be invoked when the user tries to change the sort",name:"setSort",required:!1,type:{name:"((soryBy: SortBy, sortDirection: Direction) => void)"}},noResultsPlaceholder:{defaultValue:null,description:"",name:"noResultsPlaceholder",required:!1,type:{name:"ReactElement<any, string | JSXElementConstructor<any>>"}},selectAllIsChecked:{defaultValue:{value:"false"},description:"We defer to the configuration component to determine this",name:"selectAllIsChecked",required:!1,type:{name:"boolean"}},getChildrenInfiniteRequestObject:{defaultValue:null,description:"This request object is only used to tell react-query to cancel fetching all children at once.",name:"getChildrenInfiniteRequestObject",required:!1,type:{name:"EntityChildrenRequest"}},totalEntities:{defaultValue:null,description:"The total number of entities that can be retrieved",name:"totalEntities",required:!1,type:{name:"number"}}}}}catch{}const z=({parentContainerId:t,...s})=>{const[d,l]=b.useState(O.NAME),[m,c]=b.useState(P.ASC),D={parentId:t,includeTotalChildCount:!0,includeTypes:s.visibleTypes,sortBy:d,sortDirection:m},{data:i,isLoading:y,isFetchingNextPage:o,hasNextPage:p,fetchNextPage:f}=qe(D,{throwOnError:!0}),E=(i==null?void 0:i.pages.flatMap(g=>g.page))??[],N=i==null?void 0:i.pages[0].totalChildCount,v=he(E,s.selected.size,s.isIdSelected,s.isSelectable,p,f,o);return a(M,{entities:E,isLoading:y,hasNextPage:p,fetchNextPage:f,isFetchingNextPage:o,sort:{sortBy:d,sortDirection:m},setSort:(g,I)=>{l(g),c(I)},selectAllIsChecked:v,getChildrenInfiniteRequestObject:D,totalEntities:N,...s})};try{z.displayName="ChallengeEntityChildrenDetails",z.__docgenInfo={description:"",displayName:"ChallengeEntityChildrenDetails",props:{versionSelection:{defaultValue:null,description:"",name:"versionSelection",required:!0,type:{name:"enum",value:[{value:'"DISALLOWED"'},{value:'"REQUIRED"'},{value:'"TRACKED"'},{value:'"UNTRACKED"'}]}},selectColumnType:{defaultValue:null,description:"",name:"selectColumnType",required:!0,type:{name:"enum",value:[{value:'"none"'},{value:'"checkbox"'}]}},enableSelectAll:{defaultValue:null,description:"",name:"enableSelectAll",required:!0,type:{name:"boolean"}},visibleTypes:{defaultValue:null,description:"",name:"visibleTypes",required:!0,type:{name:"EntityType[]"}},selected:{defaultValue:null,description:"",name:"selected",required:!0,type:{name:"Map<string, number>"}},selectableTypes:{defaultValue:null,description:"",name:"selectableTypes",required:!0,type:{name:"EntityType[]"}},isIdSelected:{defaultValue:null,description:"",name:"isIdSelected",required:!0,type:{name:"(header: EntityFinderHeader) => boolean"}},isSelectable:{defaultValue:null,description:"",name:"isSelectable",required:!0,type:{name:"(header: EntityFinderHeader) => boolean"}},toggleSelection:{defaultValue:null,description:"",name:"toggleSelection",required:!0,type:{name:"(entity: Reference | Reference[]) => void"}},setCurrentContainer:{defaultValue:null,description:"",name:"setCurrentContainer",required:!1,type:{name:"Dispatch<SetStateAction<EntityTreeContainer>>"}},parentContainerId:{defaultValue:null,description:"",name:"parentContainerId",required:!0,type:{name:"string"}}}}}catch{}function _({parentContainerId:t}){const{downloadCartPageUrl:s}=Z(),d=!0,[l,m]=be(d),{mutate:c}=Te({onSuccess:()=>{G("File(s) were successfully added to your Download Cart.","success",{primaryButtonConfig:{text:"View Download Cart",onClick:()=>window.location.href=s}})},onError:o=>{G(`Unable to add the file to your Download Cart. ${o.reason}`,"danger")}}),D=b.useCallback(o=>l.has(o.id),[l]),i=b.useCallback(()=>{const o=l.toArray().map(p=>({fileEntityId:p[0],versionNumber:p[1]}));c(o)},[l,c]),y={versionSelection:R.REQUIRED,selectColumnType:"checkbox",enableSelectAll:!0,visibleTypes:[j.FILE],selected:l,selectableTypes:[j.FILE],isIdSelected:D,isSelectable:()=>!0,toggleSelection:m};return B(ie,{children:[a(J,{children:a(z,{parentContainerId:t,...y})}),a(J,{mt:4,children:a(Re,{endIcon:a(oe,{}),variant:"outlined",sx:{alignSelf:"flex-end",height:"47px"},onClick:i,disabled:!l.toArray().length,children:"Add to Download Cart"})})]})}try{_.displayName="ChallengeDataDownload",_.__docgenInfo={description:"",displayName:"ChallengeDataDownload",props:{parentContainerId:{defaultValue:null,description:"",name:"parentContainerId",required:!0,type:{name:"string"}}}}}catch{}try{_.displayName="ChallengeDataDownload",_.__docgenInfo={description:"",displayName:"ChallengeDataDownload",props:{parentContainerId:{defaultValue:null,description:"",name:"parentContainerId",required:!0,type:{name:"string"}}}}}catch{}try{ChallengeDataTable.displayName="ChallengeDataTable",ChallengeDataTable.__docgenInfo={description:'Displays a list of entities in a table.\n\nIf the list of entities is paginated, the `hasNextPage` prop can be set to indicate that there is more data to load.\nWhen the view is ready to load more data, the `fetchNextPage` callback will be invoked. The view is designed to handle\nan "infinite scroll" pattern, so entities should not be removed from the list when loading the next page.',displayName:"ChallengeDataTable",props:{versionSelection:{defaultValue:null,description:"",name:"versionSelection",required:!0,type:{name:"enum",value:[{value:'"DISALLOWED"'},{value:'"REQUIRED"'},{value:'"TRACKED"'},{value:'"UNTRACKED"'}]}},selectColumnType:{defaultValue:null,description:"",name:"selectColumnType",required:!0,type:{name:"enum",value:[{value:'"none"'},{value:'"checkbox"'}]}},enableSelectAll:{defaultValue:null,description:"",name:"enableSelectAll",required:!0,type:{name:"boolean"}},visibleTypes:{defaultValue:null,description:"",name:"visibleTypes",required:!0,type:{name:"EntityType[]"}},selected:{defaultValue:null,description:"",name:"selected",required:!0,type:{name:"Map<string, number>"}},selectableTypes:{defaultValue:null,description:"",name:"selectableTypes",required:!0,type:{name:"EntityType[]"}},isIdSelected:{defaultValue:null,description:"",name:"isIdSelected",required:!0,type:{name:"(header: EntityFinderHeader) => boolean"}},isSelectable:{defaultValue:null,description:"",name:"isSelectable",required:!0,type:{name:"(header: EntityFinderHeader) => boolean"}},toggleSelection:{defaultValue:null,description:"",name:"toggleSelection",required:!0,type:{name:"(entity: Reference | Reference[]) => void"}},setCurrentContainer:{defaultValue:null,description:"",name:"setCurrentContainer",required:!1,type:{name:"Dispatch<SetStateAction<EntityTreeContainer>>"}},entities:{defaultValue:null,description:"",name:"entities",required:!0,type:{name:"EntityFinderHeader[]"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}},hasNextPage:{defaultValue:null,description:"",name:"hasNextPage",required:!1,type:{name:"boolean"}},fetchNextPage:{defaultValue:null,description:"",name:"fetchNextPage",required:!1,type:{name:"(() => Promise<any>)"}},isFetchingNextPage:{defaultValue:null,description:"",name:"isFetchingNextPage",required:!1,type:{name:"boolean"}},sort:{defaultValue:null,description:"The current sort of the view. If the view cannot be sorted, set this to `undefined`",name:"sort",required:!1,type:{name:"{ sortBy: SortBy; sortDirection: Direction; }"}},setSort:{defaultValue:null,description:"If sortable, `setSort` will be invoked when the user tries to change the sort",name:"setSort",required:!1,type:{name:"((soryBy: SortBy, sortDirection: Direction) => void)"}},noResultsPlaceholder:{defaultValue:null,description:"",name:"noResultsPlaceholder",required:!1,type:{name:"ReactElement<any, string | JSXElementConstructor<any>>"}},selectAllIsChecked:{defaultValue:{value:"false"},description:"We defer to the configuration component to determine this",name:"selectAllIsChecked",required:!1,type:{name:"boolean"}},getChildrenInfiniteRequestObject:{defaultValue:null,description:"This request object is only used to tell react-query to cancel fetching all children at once.",name:"getChildrenInfiniteRequestObject",required:!1,type:{name:"EntityChildrenRequest"}},totalEntities:{defaultValue:null,description:"The total number of entities that can be retrieved",name:"totalEntities",required:!1,type:{name:"number"}}}}}catch{}export{_ as C};
