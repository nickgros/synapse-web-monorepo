{"version":3,"file":"mutation-1cb9601d.js","sources":["../../../../node_modules/.pnpm/react-query@3.39.1_react-dom@18.2.0_react@18.2.0/node_modules/react-query/es/core/mutation.js"],"sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { getLogger } from './logger';\nimport { notifyManager } from './notifyManager';\nimport { Retryer } from './retryer';\nimport { noop } from './utils'; // TYPES\n\n// CLASS\nexport var Mutation = /*#__PURE__*/function () {\n  function Mutation(config) {\n    this.options = _extends({}, config.defaultOptions, config.options);\n    this.mutationId = config.mutationId;\n    this.mutationCache = config.mutationCache;\n    this.observers = [];\n    this.state = config.state || getDefaultState();\n    this.meta = config.meta;\n  }\n\n  var _proto = Mutation.prototype;\n\n  _proto.setState = function setState(state) {\n    this.dispatch({\n      type: 'setState',\n      state: state\n    });\n  };\n\n  _proto.addObserver = function addObserver(observer) {\n    if (this.observers.indexOf(observer) === -1) {\n      this.observers.push(observer);\n    }\n  };\n\n  _proto.removeObserver = function removeObserver(observer) {\n    this.observers = this.observers.filter(function (x) {\n      return x !== observer;\n    });\n  };\n\n  _proto.cancel = function cancel() {\n    if (this.retryer) {\n      this.retryer.cancel();\n      return this.retryer.promise.then(noop).catch(noop);\n    }\n\n    return Promise.resolve();\n  };\n\n  _proto.continue = function _continue() {\n    if (this.retryer) {\n      this.retryer.continue();\n      return this.retryer.promise;\n    }\n\n    return this.execute();\n  };\n\n  _proto.execute = function execute() {\n    var _this = this;\n\n    var data;\n    var restored = this.state.status === 'loading';\n    var promise = Promise.resolve();\n\n    if (!restored) {\n      this.dispatch({\n        type: 'loading',\n        variables: this.options.variables\n      });\n      promise = promise.then(function () {\n        // Notify cache callback\n        _this.mutationCache.config.onMutate == null ? void 0 : _this.mutationCache.config.onMutate(_this.state.variables, _this);\n      }).then(function () {\n        return _this.options.onMutate == null ? void 0 : _this.options.onMutate(_this.state.variables);\n      }).then(function (context) {\n        if (context !== _this.state.context) {\n          _this.dispatch({\n            type: 'loading',\n            context: context,\n            variables: _this.state.variables\n          });\n        }\n      });\n    }\n\n    return promise.then(function () {\n      return _this.executeMutation();\n    }).then(function (result) {\n      data = result; // Notify cache callback\n\n      _this.mutationCache.config.onSuccess == null ? void 0 : _this.mutationCache.config.onSuccess(data, _this.state.variables, _this.state.context, _this);\n    }).then(function () {\n      return _this.options.onSuccess == null ? void 0 : _this.options.onSuccess(data, _this.state.variables, _this.state.context);\n    }).then(function () {\n      return _this.options.onSettled == null ? void 0 : _this.options.onSettled(data, null, _this.state.variables, _this.state.context);\n    }).then(function () {\n      _this.dispatch({\n        type: 'success',\n        data: data\n      });\n\n      return data;\n    }).catch(function (error) {\n      // Notify cache callback\n      _this.mutationCache.config.onError == null ? void 0 : _this.mutationCache.config.onError(error, _this.state.variables, _this.state.context, _this); // Log error\n\n      getLogger().error(error);\n      return Promise.resolve().then(function () {\n        return _this.options.onError == null ? void 0 : _this.options.onError(error, _this.state.variables, _this.state.context);\n      }).then(function () {\n        return _this.options.onSettled == null ? void 0 : _this.options.onSettled(undefined, error, _this.state.variables, _this.state.context);\n      }).then(function () {\n        _this.dispatch({\n          type: 'error',\n          error: error\n        });\n\n        throw error;\n      });\n    });\n  };\n\n  _proto.executeMutation = function executeMutation() {\n    var _this2 = this,\n        _this$options$retry;\n\n    this.retryer = new Retryer({\n      fn: function fn() {\n        if (!_this2.options.mutationFn) {\n          return Promise.reject('No mutationFn found');\n        }\n\n        return _this2.options.mutationFn(_this2.state.variables);\n      },\n      onFail: function onFail() {\n        _this2.dispatch({\n          type: 'failed'\n        });\n      },\n      onPause: function onPause() {\n        _this2.dispatch({\n          type: 'pause'\n        });\n      },\n      onContinue: function onContinue() {\n        _this2.dispatch({\n          type: 'continue'\n        });\n      },\n      retry: (_this$options$retry = this.options.retry) != null ? _this$options$retry : 0,\n      retryDelay: this.options.retryDelay\n    });\n    return this.retryer.promise;\n  };\n\n  _proto.dispatch = function dispatch(action) {\n    var _this3 = this;\n\n    this.state = reducer(this.state, action);\n    notifyManager.batch(function () {\n      _this3.observers.forEach(function (observer) {\n        observer.onMutationUpdate(action);\n      });\n\n      _this3.mutationCache.notify(_this3);\n    });\n  };\n\n  return Mutation;\n}();\nexport function getDefaultState() {\n  return {\n    context: undefined,\n    data: undefined,\n    error: null,\n    failureCount: 0,\n    isPaused: false,\n    status: 'idle',\n    variables: undefined\n  };\n}\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'failed':\n      return _extends({}, state, {\n        failureCount: state.failureCount + 1\n      });\n\n    case 'pause':\n      return _extends({}, state, {\n        isPaused: true\n      });\n\n    case 'continue':\n      return _extends({}, state, {\n        isPaused: false\n      });\n\n    case 'loading':\n      return _extends({}, state, {\n        context: action.context,\n        data: undefined,\n        error: null,\n        isPaused: false,\n        status: 'loading',\n        variables: action.variables\n      });\n\n    case 'success':\n      return _extends({}, state, {\n        data: action.data,\n        error: null,\n        status: 'success',\n        isPaused: false\n      });\n\n    case 'error':\n      return _extends({}, state, {\n        data: undefined,\n        error: action.error,\n        failureCount: state.failureCount + 1,\n        isPaused: false,\n        status: 'error'\n      });\n\n    case 'setState':\n      return _extends({}, state, action.state);\n\n    default:\n      return state;\n  }\n}"],"names":["Mutation","config","_extends","getDefaultState","_proto","state","observer","x","noop","_this","data","restored","promise","context","result","error","getLogger","_this2","_this$options$retry","Retryer","action","_this3","reducer","notifyManager"],"mappings":"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"}