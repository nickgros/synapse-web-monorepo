import{j as h}from"./jsx-runtime-095bf462.js";import{r as d,R as O}from"./index-8db94870.js";import{u as b,S as R,d as y}from"./Select-457c486b.esm-39815c2e.js";import{_ as T}from"./extends-98964cd2.js";import"./index-8ce4a492.js";import{u as v,bd as N,bv as k,b$ as F}from"./EntityTypeUtils-80a22eb6.js";import"./getEndpoint-ac94413e.js";import{u as A}from"./use-deep-compare-effect.esm-08e85271.js";import{V as H,q as L,o as D,p as x}from"./SynapseConstants-667d004c.js";import{u as C,c as P}from"./uniq-1b9c0f0c.js";import{w as G}from"./without-d1d06e27.js";import{a as q,U as _}from"./UserOrTeamBadge-58df9bc4.js";import{S as B}from"./Skeleton-3aad52b9.js";var Y=d.forwardRef(function(t,e){var n=b(t);return d.createElement(R,T({ref:e},n))});const M=Y,$=(t,e,n)=>{d.useEffect(()=>{const c=setTimeout(()=>t(),n);return()=>clearTimeout(c)},[...e||[],n])},j={ownerId:"",firstName:"Unknown",lastName:"Unknown",userName:"Unknown",isIndividual:!1},K={name:"Unknown",id:"unknown",type:"org.sagebionetworks.repo.model.FileEntity",versionNumber:0,versionLabel:"placeholder",benefactorId:0,createdOn:"null",modifiedOn:"null",createdBy:"null",modifiedBy:"null",isLatestVersion:!0},J={id:"unknown",etag:"Unknown",name:"Unknown",description:"Unknown",ownerId:"null",createdOn:"null",contentSource:"Unknown",submissionInstructionsMessage:"Unknown",submissionReceiptMessage:"Unknown"},Q=async(t,e)=>{const n=await N(t,e),a=t.filter(r=>n.results.map(f=>f.id).indexOf(r.targetId)===-1).map(r=>({...K,id:r.targetId,name:`${r.targetId}`}));return[...n.results,...a]},z=async t=>{const e=(await k(t)).children,c=t.filter(a=>e.map(r=>r.ownerId).indexOf(a)===-1).map(a=>({...j,ownerId:a,name:`Unknown User (${a})`}));return[...e,...c]},W=async(t,e)=>{const n=await F(t,e),a=t.filter(r=>n.results.map(f=>f.id).indexOf(r)===-1).map(r=>({...J,id:r,name:r}));return[...n.results,...a]};function X(t){const{ids:e,type:n}=t,{accessToken:c}=v(),[a,r]=d.useState([]),f=s=>s==="USER_PROFILE"?"ownerId":"id",I=s=>{switch(s){case"USER_PROFILE":return x;case"ENTITY_HEADER":return D;case"EVALUATION_QUEUE":return L;default:return""}},U=a.map(s=>s[f(n)]),p=e.filter(s=>s!==H),w=C(G(p,...U));return d.useEffect(()=>{((E,l)=>{if(!E.length)return;const S=sessionStorage.getItem(I(l));try{const i=S?JSON.parse(S):[],m=i.map(u=>u[f(l)]);for(const u of E)m.includes(u[f(l)])||i.push(u);sessionStorage.setItem(I(l),JSON.stringify(i))}catch{sessionStorage.setItem(I(l),JSON.stringify(E))}})(a,n)},[a,n]),A(()=>{let s=!1;return(async()=>{if(w.length>0)try{const l=Array.from(w),S=n==="ENTITY_HEADER"?l.map(u=>({targetId:u})):l,i=P(S,45),m=[];for(const u of i){let g=[];switch(n){case"USER_PROFILE":g=await z(u);break;case"ENTITY_HEADER":g=await Q(u,c);break;case"EVALUATION_QUEUE":g=await W(u,c);break}m.push(...g)}s||r(u=>u.concat(...m))}catch(l){console.error("Error on data retrieval",l)}})(),()=>{s=!0}},[c,n,w]),a}const Z={Control:t=>h(y.Control,{...t,className:`form-control ${t.className??""}`}),SingleValue:t=>{const{data:e}=t;return d.createElement(y.SingleValue,{...t,key:e==null?void 0:e.id},h(_,{userGroupHeader:e==null?void 0:e.header,disableHref:!0,showFullName:!0},e==null?void 0:e.header.ownerId))},Option:t=>{const{data:e}=t;return d.createElement(y.Option,{...t,key:e==null?void 0:e.id},h(_,{userGroupHeader:e==null?void 0:e.header,disableHref:!0,showFullName:!0,showCardOnHover:!1}))}},V=t=>{const{inputId:e,defaultValue:n=null,onChange:c,filterPredicate:a,typeFilter:r,placeholder:f,focusOnSelect:I=!1,value:U}=t,[p,w]=d.useState(""),[s,E]=d.useState("");$(()=>{E(p)},[p],500);const[l=void 0]=X({ids:n?[n]:[],type:"USER_PROFILE"}),{data:S,isLoading:i}=q(s,r),m=O.useRef(null);O.useEffect(()=>{I&&m.current&&m.current.focus()});const u=d.useMemo(()=>i||p!==s?()=>"Loadingâ€¦":void 0,[i,s,p]),g=(S??[]).filter(a??(()=>!0)).map(o=>({id:o.ownerId.toString(),value:o.ownerId.toString(),label:o.userName,header:o}));return n&&l==null?h(B,{width:"100%"}):h(M,{className:"bootstrap-4-backport UserSearchBoxV2",ref:m,inputValue:p,onInputChange:w,filterOption:()=>!0,isLoading:i,options:!i&&g||[],noOptionsMessage:u,defaultValue:n?{id:n,value:n,label:l.userName,header:l}:void 0,inputId:e,isClearable:!0,value:U,styles:{control:o=>({...o,display:"flex !important"}),input:o=>({...o,input:{gridArea:"1 / 2 / 4 / 4 !important"}})},components:Z,onChange:o=>{c&&c((o==null?void 0:o.id)??null,(o==null?void 0:o.header)??null)},placeholder:f})};try{V.displayName="UserSearchBoxV2",V.__docgenInfo={description:"",displayName:"UserSearchBoxV2",props:{inputId:{defaultValue:null,description:"",name:"inputId",required:!1,type:{name:"string"}},defaultValue:{defaultValue:null,description:"",name:"defaultValue",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((principalId: string | null, header: UserGroupHeader | null) => void)"}},typeFilter:{defaultValue:null,description:"",name:"typeFilter",required:!1,type:{name:"enum",value:[{value:'"USERS_ONLY"'},{value:'"TEAMS_ONLY"'},{value:'"ALL"'}]}},filterPredicate:{defaultValue:null,description:"",name:"filterPredicate",required:!1,type:{name:"((item: UserGroupHeader) => boolean)"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},focusOnSelect:{defaultValue:null,description:"",name:"focusOnSelect",required:!1,type:{name:"boolean"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"PropsValue<UserSearchBoxValueType>"}}}}}catch{}export{M as S,V as U,$ as a,X as u};
//# sourceMappingURL=UserSearchBoxV2-59d7f303.js.map
