import{j as o,F as _,a as b}from"./jsx-runtime-095bf462.js";import{r as f}from"./index-8db94870.js";import{u as l,S as d,am as U,an as T,a5 as O,bN as $,bO as W}from"./SynapseClient-c43c6534.js";import{u as h}from"./useMutation-424ee4ed.js";import{u as B}from"./useInfiniteQuery-f8eb063d.js";import{I as j}from"./IconSvg-f04d8c2b.js";import{D as Y,c as z,C as H,k as D}from"./ConfirmationDialog-841e003d.js";import{U as J}from"./UserSearchBoxV2-18c7df1d.js";import{s as X}from"./startCase-b2e198bb.js";import{B as Z}from"./Box-fe8ef83e.js";import{a as ee}from"./FormLabel-7b55e02a.js";function Ce(e,a,r,n,t,s){const{accessToken:c,keyFactory:S}=l();return B(S.getRepliesQueryKey(e,a,r,n,t),async y=>d.getReplies(c,e,r,y.pageParam,n,a,t),{...s,getNextPageParam:(y,M)=>{const p=M.flatMap(g=>g.results).length;if(y.totalNumberOfResults>p)return p}})}function ve(e,a){const{accessToken:r,keyFactory:n}=l(),t=async()=>{const s=await d.getReplyMessageUrl(e.messageKey,r);return(await fetch(s.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return U(n.getReplyQueryKey(e.threadId,e.id,e.messageKey),t,a)}function te(e){const a=T(),{accessToken:r,keyFactory:n}=l();return h(t=>d.postReply(t,r),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllRepliesQueryKey(t.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function ae(e){const a=T(),{accessToken:r,keyFactory:n}=l();return h(t=>d.putReply(t,r),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllRepliesQueryKey(t.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function Re(e){const a=T(),{accessToken:r,keyFactory:n}=l();return h(t=>d.deleteReply(r,t.replyId),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllRepliesQueryKey(s.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function Qe(e){const{data:a,isLoading:r}=se(e),{data:n,isLoading:t}=ne(a,{enabled:!!a}),{mutate:s}=oe(),{mutate:c}=ue(),S=f.useCallback(()=>{a&&(a!=null&&a.isPinned?c(a):s(a))},[c,s,a]);return{threadData:a,threadBody:n,togglePin:S,isLoading:t||r}}function se(e,a){const{accessToken:r,keyFactory:n}=l();return U(n.getThreadQueryKey(e),()=>d.getThread(e,r),a)}function ne(e,a){const{accessToken:r,keyFactory:n}=l(),t=async()=>{const s=await d.getThreadMessageUrl(e==null?void 0:e.messageKey,r);return(await fetch(s.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return U(n.getThreadBodyQueryKey(e==null?void 0:e.id,e==null?void 0:e.messageKey),t,a)}function re(e){const a=T(),{accessToken:r,keyFactory:n}=l();return h(t=>d.putThreadTitle(r,t),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(t.forumId)),await a.invalidateQueries(n.getThreadQueryKey(s.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function ce(e){const a=T(),{accessToken:r,keyFactory:n}=l();return h(t=>d.putThreadMessage(r,t),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getThreadQueryKey(s.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function ie(e){const a=T(),{accessToken:r,keyFactory:n}=l();return h(t=>d.postThread(r,t),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(t.forumId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function Me(e){const a=T(),{accessToken:r,keyFactory:n}=l();return h(t=>d.deleteThread(r,t.id),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(s.forumId)),await a.invalidateQueries(n.getThreadQueryKey(s.id)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function Fe(e){const a=T(),{accessToken:r,keyFactory:n}=l();return h(t=>d.restoreThread(r,t.id),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(s.forumId)),await a.invalidateQueries(n.getThreadQueryKey(s.id)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function oe(e){const a=T(),{accessToken:r,keyFactory:n}=l();return h(t=>d.pinThread(r,t.id),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(s.forumId)),await a.invalidateQueries(n.getThreadQueryKey(s.id)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function ue(e){const a=T(),{accessToken:r,keyFactory:n}=l();return h(t=>d.unPinThread(r,t.id),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(s.forumId)),await a.invalidateQueries(n.getThreadQueryKey(s.id)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}const K=({show:e,onClose:a,handleUserTag:r})=>{const n=f.useCallback((t,s)=>{t&&s&&r(s.userName),a()},[a,r]);return o(_,{children:o(Y,{open:e,onCancel:a,title:"Find User or Team",content:o(J,{placeholder:"Search for a user or team name",onChange:n,typeFilter:O.ALL,focusOnSelect:!0}),sx:{".MuiDialog-paperFullWidth":{overflowY:"visible",".MuiDialogContent-root":{overflowY:"visible"}}}})})};try{K.displayName="UserMentionModal",K.__docgenInfo={description:"",displayName:"UserMentionModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},handleUserTag:{defaultValue:null,description:"",name:"handleUserTag",required:!0,type:{name:"(user: string) => void"}}}}}catch{}var A=(e=>(e.WRITE="WRITE",e.PREVIEW="PREVIEW",e))(A||{});const L=({placeholder:e,text:a,setText:r})=>{const[n,t]=f.useState("WRITE"),[s,c]=f.useState(0),[S,y]=f.useState(!1),[M,p]=f.useState(!1),g=f.useRef(null);f.useEffect(()=>{const i=g.current;i&&i.setSelectionRange(s,s)},[g,s]),f.useEffect(()=>{var i;(i=g.current)==null||i.focus()},[S]);const q=i=>{const u=[],m=g.current;if(m){const w=m==null?void 0:m.selectionStart,C=a.substring(0,w),v=a.substring(w,a.length);c(w+i.length),u.push(C,`${M?"":"@"}${i.replace(/\s/g,"")}`,v)}r(u.join("")),p(!1)},x=i=>{const u=g.current&&g.current.selectionStart;u&&u>0&&i.charAt(u-1)==="@"&&(p(!0),y(!0))},E=i=>{const u=g.current;if(u){const m=u.selectionStart,w=u.selectionEnd,C=a.substring(m,w),v=a.substring(0,m),I=a.substring(w,a.length),R=W[i].openSyntax,F=W[i].closeSyntax;switch(i){case"code":{const k=[];k.push(v,R,C,F,I),r(k.join(`\r
`)),u.focus(),c(m+R.length+2);break}case"title":case"bold":case"italic":case"strikethrough":case"latex":case"subscript":case"superscript":case"link":case"image":{const k=`${v}${R}${C}${F}${I}`;u.focus(),c(m+R.length),r(k)}}}};return b("div",{className:"bootstrap-4-backport MarkdownEditor",children:[b("div",{className:"MarkdownEditorControls",children:[o("div",{className:"Tabs",children:Object.keys(A).map(i=>o("button",{className:"Tab",role:"tab","aria-selected":i===n,onClick:u=>{u.stopPropagation(),t(A[i])},children:i},i))}),n==="WRITE"&&b("div",{className:"MarkdownEditorControlsToolbar",children:[$.map(i=>o("button",{onClick:()=>E(i),children:o(j,{icon:i,label:X(i)})},i)),o("button",{onClick:()=>y(!0),children:o(j,{icon:"tag",label:"Mention"})})]})]}),o("div",{children:n==="WRITE"?o("textarea",{onChange:i=>{r(i.target.value),x(i.target.value)},style:{width:"100%"},rows:6,value:a,ref:g,placeholder:e}):a?o(z,{markdown:a}):"Nothing to preview"}),o(K,{show:S,onClose:()=>y(!1),handleUserTag:q})]})};try{L.displayName="MarkdownEditor",L.__docgenInfo={description:"",displayName:"MarkdownEditor",props:{placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}},setText:{defaultValue:null,description:"",name:"setText",required:!0,type:{name:"(text: string) => void"}}}}}catch{}const G=e=>{const{initialText:a,initialTitle:r,id:n,onClose:t,isReply:s,isDialog:c,openDialog:S}=e,[y,M]=f.useState(r??""),[p,g]=f.useState(a??""),{mutate:q,isLoading:x}=re({onSuccess:()=>t()}),{mutate:E,isLoading:i}=ce({onSuccess:()=>t()}),{mutate:u,isLoading:m}=ie({onSuccess:()=>t()}),{mutate:w,isLoading:C}=te({onSuccess:()=>t()}),{mutate:v,isLoading:I}=ae({onSuccess:()=>t()}),R=i||C||m||x||I,F=!s&&r,k=(Q,P)=>{s?a?v({replyId:n,messageMarkdown:Q}):w({threadId:n,messageMarkdown:Q}):F?(q({title:P,threadId:n}),E({messageMarkdown:Q,threadId:n})):u({forumId:n,title:P,messageMarkdown:Q})},N=b("div",{className:"bootstrap-4-backport",children:[!s&&o(ee,{type:"text",placeholder:"Title",value:y,onChange:Q=>M(Q.target.value)}),o(L,{text:p,setText:g})]}),V=R?"Saving":"Save";return o(_,{children:c?o(H,{maxWidth:"md",open:S,onCancel:t,title:s?"Edit Reply":F?"Edit Thread":"New Thread",content:N,onConfirm:()=>k(p,y),confirmButtonText:V}):b(_,{children:[N,o(Z,{display:"flex",justifyContent:"flex-end",children:o(D,{onCancel:t,onConfirm:()=>k(p,y),confirmButtonText:V})})]})})};try{G.displayName="ForumThreadEditor",G.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isReply:{defaultValue:null,description:"",name:"isReply",required:!0,type:{name:"boolean"}},isDialog:{defaultValue:null,description:"",name:"isDialog",required:!0,type:{name:"boolean"}},openDialog:{defaultValue:null,description:"",name:"openDialog",required:!1,type:{name:"boolean"}}}}}catch{}export{G as F,Re as a,Qe as b,Me as c,Fe as d,Ce as e,ve as u};
//# sourceMappingURL=ForumThreadEditor-324ab5f1.js.map
